<template>

    <template if:true={ScreenLoaded}>
        <c-dbu_page-loader></c-dbu_page-loader>
    </template>

    <div class="slds-grid slds-wrap myAdd">
        <div class="slds-col slds-size_1-of-1 slds-large-size_12-of-12  slds-small-size_12-of-12">
            <h1><strong> {label.dbu_Address_Book}</strong></h1>
            <div class="slds-grid slds-wrap addBookHeader">
                <div class="slds-col slds-size_8-of-12 slds-large-size_8-of-12 slds-small-size_8-of-12 ">
                    {label.dbu_myAddressBook_Address}
                </div>
                <!-- <div class="slds-col slds-size_2-of-12 ">

                </div> -->
                <div class="slds-col slds-size_4-of-12 slds-large-size_2-of-12 slds-small-size_2-of-12 ">
                    {label.dbu_myAddressBook_Type}
                </div>
                <div class="slds-col slds-size_12-of-12 slds-large-size_2-of-12 slds-small-size_2-of-12 ">
                    {label.dbu_myAddressBook_Actions}
                </div>
            </div>


            <template for:each={ccAddressDataShippingBilling} for:item="ccAddressShipping">

                <template for:each={ccAddressShipping.shippingWrapper} for:item="ccAddress">
                    <div key={ccAddress.sfid} class="slds-grid slds-wrap addBookCont ">

                        <div class="slds-col slds-size_8-of-12 slds-large-size_8-of-12 slds-small-size_8-of-12 ">



                            <div> {ccAddress.firstName}
                                {ccAddress.lastName}
                                <template if:true={ccAddress.dbuDefaultAddress}>
                                    <a class="default">{label.dbu_myAddressBook_Default}</a>
                                </template>

                            </div>
                            <div> {ccAddress.addressFirstline}</div>
                            <div>  {ccAddress.addressSecondline}</div>  
                            {ccAddress.city}
                            {ccAddress.state}
                            <div> {ccAddress.postalCode}
                                {ccAddress.country}</div>


                        </div>



                        <div class="slds-col slds-size_4-of-12 slds-large-size_2-of-12 slds-small-size_2-of-12  ">
                            <label>{shippingComments}</label>
                        </div>
                        <div class="slds-col slds-size_12-of-12 slds-large-size_2-of-12 slds-small-size_2-of-12">

                            <a for="form-element-id-05" onclick={handleModifyCCAddress}
                                data-addressline1={ccAddress.addressFirstline}
                                data-addressline2={ccAddress.addressSecondline} data-addresscity={ccAddress.city}
                                data-addressstate={ccAddress.state} data-addresspostalcode={ccAddress.postalCode}
                                data-addresscountry={ccAddress.country} data-addressfstname={ccAddress.firstName}
                                data-addresslstname={ccAddress.lastName} data-sfid={ccAddress.sfid}
                                data-shippingname={shippingComments} data-defaultaddress={ccAddress.dbuDefaultAddress}
                                data-cmnyname={ccAddress.companyName} data-email={ccAddress.email}
                                data-phn={ccAddress.homePhone}>
                                {label.dbu_myAddressBook_Edit}
                            </a>

                        </div>
                    </div>

                </template>
            </template>




            <template for:each={ccAddressDataShippingBilling} for:item="ccAddressBilling">

                <template for:each={ccAddressBilling.billingWrapper} for:item="ccAddressBil">
                    <div key={ccAddressBil.sfid} class="slds-grid slds-wrap addBookCont ">
                        <div class="slds-col slds-size_8-of-12 slds-large-size_8-of-12 slds-small-size_8-of-12 item ">


                            <div> {ccAddressBil.firstName}
                                {ccAddressBil.lastName}
                                <template if:true={ccAddressBil.dbuDefaultAddress}>
                                    <a class="default">{label.dbu_myAddressBook_Default}
                                    </a>
                                </template>
                            </div>
                            <div> {ccAddressBil.addressFirstline}</div>
                            <div>  {ccAddressBil.addressSecondline}</div>  
                            <div> {ccAddressBil.city}
                                {ccAddressBil.state}</div>
                            {ccAddressBil.postalCode}
                            {ccAddressBil.country}


                        </div>

                        <div class="slds-col slds-size_4-of-12 slds-large-size_2-of-12 slds-small-size_2-of-12">
                            <label>{billingComments}</label>
                        </div>

                        <div class="slds-col slds-size_12-of-12 slds-large-size_2-of-12 slds-small-size_2-of-12">

                            <a for="form-element-id-05" onclick={handleModifyccAddressBil}
                                data-addressline1bil={ccAddressBil.addressFirstline}
                                data-addressline2bil={ccAddressBil.addressSecondline}
                                data-addresscitybil={ccAddressBil.city} data-addressstatebil={ccAddressBil.state}
                                data-addresspostalcodebil={ccAddressBil.postalCode}
                                data-addresscountrybil={ccAddressBil.country}
                                data-addressfirstnamebil={ccAddressBil.firstName}
                                data-addresslstnamebil={ccAddressBil.lastName} data-sfidbil={ccAddressBil.sfid}
                                data-billingname={billingComments}
                                data-defaultaddressbil={ccAddressBil.dbuDefaultAddress}
                                data-cmnynamebil={ccAddressBil.companyName} data-emailbil={ccAddressBil.email}
                                data-phnbil={ccAddressBil.homePhone}>
                                {label.dbu_myAddressBook_Edit}
                            </a>

                        </div>
                    </div>

                </template>
            </template>
        </div>
    </div>


    <template if:true={showEditFormCCAddress}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open validatePopup">
            <div class="slds-modal__container myEditPopUp popUpForm">
                <header class="slds-modal__header">
                    <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate validateTit">
                        {label.dbu_myAddressBook_Edit_Address}</h1>
                </header>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <fieldset class="slds-form-element slds-form-element_compound myEditPopUpCont">

                        <div class="slds-form-element__control coForm">
                            <div class="slds-form-element__row">
                                <div class="slds-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-05">{label.dbu_myAddressBook_Company}
                                        </label>
                                        <div class="slds-form-element__control">
                                            <input name="cmnyName" type="text" value={cmpnameVal}
                                                class="slds-input input_align compNme"
                                                placeholder="Enter your company name"
                                                onchange={handleCCAddressChange} />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-size_6-of-12">
                                    <div>
                                        <lightning-combobox dropdown-alignment="auto" name="addTypeName" label="Address Type" value={addTypeVal}
                                            placeholder="" options={options} onchange={handleCCAddressChange}>
                                        </lightning-combobox>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-form-element__row">
                                <div class="slds-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-05">{label.dbu_checkoutPage_firstName} <span
                                                class="slds-required" title="required">* </span></label>
                                        <div class="slds-form-element__control">
                                            <input name="fname" type="text" value={firstnameVal} required
                                                class="slds-input input_align" onchange={handleCCAddressChange} />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-06">{label.dbu_checkoutPage_lastName} <span
                                                class="slds-required" title="required">* </span></label>
                                        <div class="slds-form-element__control">
                                            <input name="lname" type="text" value={lastnameVal} required=""
                                                class="slds-input input_align" onchange={handleCCAddressChange} />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="slds-form-element__row">
                                <div class="slds-size_6-of-12">
                                    <div class=""><!--slds-form-element-->
                                        <lightning-input name="add1name" type="text" value={add1Val} required="" label={label.dbu_checkoutPage_address1}
                                                class="add1ValEdit" onchange={handleCCAddressChange} onkeyup={addressAutoComp}></lightning-input>
                                        <!-- <label class="slds-form-element__label"
                                            for="form-element-id-05">{label.dbu_checkoutPage_address1}
                                            <span class="slds-required" title="required">* </span>
                                        </label>
                                        <div class="slds-form-element__control">
                                            <input name="add1name" type="text" value={add1Val} required=""
                                                class="slds-input input_align add1ValEdit" onchange={handleCCAddressChange} onkeyup={addressAutoComp}/>
                                        </div> -->
                                        <template if:true={addressResults}>
                                            <div class="addressList">
                                                <template for:each={addressResults} for:item="adResult">
                                                    <div class="slds-grid slds-wrap 
                                                                slds-dropdown_length-with-icon-7 
                                                                slds-dropdown_fluid" key={adResult.PlaceId}>
                                                        <div class="slds-col slds-size_4-of-4 ">
                                                            <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                                                <li role="presentation" class="slds-listbox__item">
                                                                    <div class="slds-media slds-listbox__option 
                                                                                slds-listbox__option_entity 
                                                                                slds-listbox__option_has-meta" 
                                                                                role="option"
                                                                                onclick={addressSelected} 
                                                                                data-plid={adResult.PlaceId}
                                                                                data-desc={adResult.Description}
                                                                                data-trg='editAdd'
                                                                                >
                                                                        <span class="slds-media__body">
                                                                            <span class="slds-listbox__option-text 
                                                                                        slds-listbox__option-text_entity">
                                                                                {adResult.Description}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                <div class="slds-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-06">{label.dbu_checkoutPage_address2}
                                            (optional)</label>
                                        <div class="slds-form-element__control">
                                            <input name="add2name" type="text" value={add2Val} required=""
                                                class="slds-input input_align add2ValEdit" onchange={handleCCAddressChange} onfocus={closeAddressResults} />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="slds-form-element__row">
                                <div class="slds-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-05">{label.dbu_checkoutPage_city}
                                            <span class="slds-required" title="required">* </span>
                                        </label>
                                        <div class="slds-form-element__control">
                                            <input name="cityname" type="text" value={cityVal}
                                                class="slds-input input_align" onchange={handleCCAddressChange} />
                                        </div>
                                    </div>
                                </div>

                                <div class="slds-size_6-of-12">
                                    <div>
                                        <lightning-combobox dropdown-alignment="auto" name="countryname" value={cntryVal} placeholder=""
                                            options={countryItem} onchange={handleCCAddressChange} label="Country"
                                            required>
                                        </lightning-combobox>
                                    </div>
                                </div>

                            </div>

                            <div class="slds-form-element__row">
                                <div class="slds-size_6-of-12">
                                    <div class="slds-form-element">
                                        <template if:true={labelUS}>
                                            <label class="slds-form-element__label"
                                                for="form-element-id-06">{label.dbu_checkoutPage_zipCode}
                                                <span class="slds-required" title="required">* </span>
                                            </label>
                                        </template>
                                        <template if:false={labelUS}>
                                            <label class="slds-form-element__label"
                                                for="form-element-id-06">{label.dbu_checkoutPage_postalCode}
                                                <span class="slds-required" title="required">* </span>
                                            </label>
                                        </template>
                                        <div class="slds-form-element__control">
                                            <input name="zipname" type="text" value={zipVal}
                                                class="slds-input input_align" onchange={handleCCAddressChange} />
                                        </div>
                                    </div>

                                </div>


                                <div class="slds-size_6-of-12">
                                    <div>
                                        <template if:true={labelUS}>
                                            <lightning-combobox dropdown-alignment="auto" name="statename" value={stateVal}
                                                placeholder={valueDrpdwn} options={statePicklistValuArray} 
                                                onchange={handleCCAddressChange} label="State" required>
                                            </lightning-combobox>
                                        </template>
                                        <template if:false={labelUS}>
                                            <lightning-combobox dropdown-alignment="auto" name="statename" value={stateVal}
                                                placeholder={valueDrpdwn} options={statePicklistValuArray}
                                                onchange={handleCCAddressChange} label="Province" required>
                                            </lightning-combobox>
                                        </template>
                                    </div>




                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <footer class="slds-modal__footer text-center ftrModal"> 
                        <div class="slds-form-element__row">
                            <div class="slds-size_12-of-12 t-left">
                    <div class="slds-checkbox chckBox">
                        <input type="checkbox" name="defaultChekbox" id="checkbox-unique-id-73"
                            value="defaultedEdit" checked={isChecked} onchange={handleDefaultAddress} />
                        <label class="slds-checkbox__label" for="checkbox-unique-id-73">
                            <span class="slds-checkbox_faux"></span>
                            <span class="slds-form-element__label">{label.dbu_myAddressBook_Default_address}</span>
                        </label>
                    </div>
                    <template if:true={mandateFlag}>
                        <div class="errorNotify">
                            {label.dbu_myAddressBook_MandatoryCheck}
                        </div>
                    </template>
                    </div>
                    </div> 


                    
                    <div class="editAddFtr">
                        <span class="slds-form-element__label slds-col slds-order_2 delAdd" for="form-element-id-05"
                            onclick={deleteCCaddress}>
                            <a>{label.dbu_myAddressBook_Delete_this_address} </a>
                        </span>
                        

<div class="btns">
                        <button class="slds-button slds-button_outline-brand"
                            onclick={closeCCAddressPopup}>{label.dbu_myAddressBook_Cancel}</button>
                        <button class="slds-button slds-button_brand"
                            onclick={handleSave}>{label.dbu_myAddressBook_Save}</button>
                        </div>
                    </div>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>


    <div class="newAddBtn">
        <button class="slds-button slds-button_outline-brand" onclick={handleNewAddressForm}><span>+</span>
            {label.dbu_myAddressBook_Add_new_address}
        </button>
    </div>

    <template if:true={showNewAddressForm}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-02" aria-modal="true"
            aria-describedby="modal-content-id-2" class="slds-modal slds-fade-in-open validatePopup">
            <div class="slds-modal__container popUpForm headerFooterModal">
                <header class="slds-modal__header slds-p-left_large slds-p-right_large">

                    <h3 id="modal-heading-02" class="slds-modal__title slds-hyphenate validateTit">
                        {label.dbu_myAddressBook_Add_a_new_address}</h3>

                </header>
                <div class="slds-modal__content slds-p-around_large" id="modal-content-id-2">
                    <fieldset class="slds-form-element slds-form-element_compound myAddPopUpCont">
                        <div class="slds-form-element__control ">
                            <div class="slds-form-element__row">

                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-05">{label.dbu_myAddressBook_Company}
                                        </label>
                                        <div class="slds-form-element__control">
                                            <input name="cmnyNameNewAdd" type="text" value={cmpnameValNewAdd}
                                                class="slds-input input_align compNme"
                                                placeholder="Enter your company name"
                                                onchange={handleAddNewCCAddress} />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div>
                                        <lightning-combobox dropdown-alignment="auto" name="addTypeNameNewAdd" label="Address Type"
                                            value={addTypeValNewAdd} placeholder="" options={options}
                                            onchange={handleAddNewCCAddress}>
                                        </lightning-combobox>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-form-element__row">
                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-05">{label.dbu_checkoutPage_firstName} <span
                                                class="slds-required" title="required">* </span></label>
                                        <div class="slds-form-element__control">
                                            <input name="fnameNewAdd" type="text" value={firstnameValNewAdd} required
                                                class="slds-input input_align" onchange={handleAddNewCCAddress} />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-06">{label.dbu_checkoutPage_lastName} <span
                                                class="slds-required" title="required">* </span></label>
                                        <div class="slds-form-element__control">
                                            <input name="lnameNewAdd" type="text" value={lastnameValNewAdd} required=""
                                                class="slds-input input_align" onchange={handleAddNewCCAddress} />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="slds-form-element__row">
                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div class="posrel" role="listbox"><!--slds-form-element -->
                                        <lightning-input name="add1nameNewAdd" type="text" value={add1ValNewAdd} required="" label={label.dbu_checkoutPage_address1}
                                                class="add1ValNewAddress" onkeyup={addressAutoComp} onchange={handleAddNewCCAddress}></lightning-input>
                                        <!-- <label class="slds-form-element__label"
                                            for="form-element-id-05">{label.dbu_checkoutPage_address1}
                                            <span class="slds-required" title="required">* </span>
                                        </label>
                                        <div class="slds-form-element__control">
                                            <input name="add1nameNewAdd" type="text" value={add1ValNewAdd} required=""
                                                class="slds-input input_align add1ValNewAddress" onkeyup={addressAutoComp} onchange={handleAddNewCCAddress}/>
                                        </div> -->
                                        <template if:true={addressResults}>
                                            <div class="addressList">
                                                <template for:each={addressResults} for:item="adResult">
                                                    <div class="slds-grid slds-wrap 
                                                                slds-dropdown_length-with-icon-7 
                                                                slds-dropdown_fluid" key={adResult.PlaceId}>
                                                        <div class="slds-col slds-size_4-of-4 ">
                                                            <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                                                <li role="presentation" class="slds-listbox__item">
                                                                    <div class="slds-media slds-listbox__option 
                                                                                slds-listbox__option_entity 
                                                                                slds-listbox__option_has-meta" 
                                                                                role="option"
                                                                                onclick={addressSelected} 
                                                                                data-plid={adResult.PlaceId}
                                                                                data-desc={adResult.Description}
                                                                                data-trg='newAdd'
                                                                                >
                                                                        <span class="slds-media__body">
                                                                            <span class="slds-listbox__option-text 
                                                                                        slds-listbox__option-text_entity">
                                                                                {adResult.Description}
                                                                            </span>
                                                                        </span>
                                                                    </div>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </template>         
                                    </div>
                                </div>
                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-06">{label.dbu_checkoutPage_address2}
                                            (optional)</label>
                                        <div class="slds-form-element__control">
                                            <input name="add2nameNewAdd" type="text" value={add2ValNewAdd} required=""
                                                class="slds-input input_align add2Val add2ValNewAdd" onchange={handleAddNewCCAddress} onfocus={closeAddressResults}/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="slds-form-element__row">
                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div class="slds-form-element">
                                        <label class="slds-form-element__label"
                                            for="form-element-id-05">{label.dbu_checkoutPage_city}
                                            <span class="slds-required" title="required">* </span>
                                        </label>
                                        <div class="slds-form-element__control">
                                            <input name="citynameNewAdd" type="text" value={cityValNewAdd}
                                                class="slds-input input_align" onchange={handleAddNewCCAddress} />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div>
                                        <lightning-combobox dropdown-alignment="auto"  name="countrynameNewAdd" value={cntryValNewAdd}
                                            placeholder="" options={countryItem} onchange={handleAddNewCCAddress}
                                            label="Country" required>
                                        </lightning-combobox>

                                    </div>
                                </div>

                            </div>

                            <div class="slds-form-element__row">
                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div class="slds-form-element">
                                        <template if:true={labelUS}>
                                            <label class="slds-form-element__label"
                                                for="form-element-id-06">{label.dbu_checkoutPage_zipCode}
                                                <span class="slds-required" title="required">* </span>
                                            </label>
                                        </template>
                                        <template if:false={labelUS}>
                                            <label class="slds-form-element__label"
                                                for="form-element-id-06">{label.dbu_checkoutPage_postalCode}
                                                <span class="slds-required" title="required">* </span>
                                            </label>
                                        </template>
                                        <div class="slds-form-element__control">
                                            <input name="zipnameNewAdd" type="text" value={zipValNewAdd}
                                                class="slds-input input_align" onchange={handleAddNewCCAddress} />
                                        </div>
                                    </div>
                                </div>

                                <div class="slds-size_1-of-1 slds-large-size_6-of-12">
                                    <div>
                                        <template if:false={labelUS}>
                                            <lightning-combobox  dropdown-alignment="auto"  name="statenameNewAdd" value={stateValNewAdd}
                                                placeholder={valueDrpdwnNew} options={statePicklistValuArray}
                                                onchange={handleAddNewCCAddress} label="Province" required>
                                            </lightning-combobox>
                                        </template>
                                        <template if:true={labelUS}>
                                            <lightning-combobox  dropdown-alignment="auto"  name="statenameNewAdd" value={stateValNewAdd}
                                                placeholder={valueDrpdwnNew} options={statePicklistValuArray}
                                                onchange={handleAddNewCCAddress} label="State" required>
                                            </lightning-combobox>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>
 
                <footer class="slds-modal__footer text-center ftrModal">

                    <div class="slds-form-element__row">
                        <div class="slds-size_12-of-12 t-left">
                            <template if:false={hideDefaultOption}>
                                <div class="slds-checkbox chckBox">
                                    <input type="checkbox" name="defaultChekbox" id="checkbox-unique-id-74" value="defaulted" checked=""
                                        onchange={handleDefaultAddress} />
                                    <label class="slds-checkbox__label" for="checkbox-unique-id-74">
                                        <span class="slds-checkbox_faux"></span>
                                        <span class="slds-form-element__label">{label.dbu_myAddressBook_Default_address}</span>
                                    </label>
                                </div>
                            </template>

                            <template if:true={mandateFlag}>
                                <div class="errorNotify">
                                    {label.dbu_myAddressBook_MandatoryCheck}
                                </div>
                            </template>

                        </div>
                    </div>
                    <div class="editAddFtr">
                        <div class="btns">
                            <button class="slds-button slds-button_outline-brand"
                                onclick={closeCCAddressPopup}>{label.dbu_myAddressBook_Cancel}</button>
                            <button class="slds-button slds-button_brand"
                                onclick={handleSaveNewAddress}>{label.dbu_myAddressBook_Save}</button>
                        </div>
                    </div>



                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

</template>