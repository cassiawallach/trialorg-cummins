var forcetk=window.forcetk;if(void 0===forcetk&&(forcetk={}),void 0===forcetk.Client){forcetk.Client=function(a,b,c){"use strict";this.clientId=a,this.loginUrl=b||"https://login.salesforce.com/",void 0===c||null===c?("file:"===location.protocol||"ms-appx:"===location.protocol?this.proxyUrl=null:this.proxyUrl=location.protocol+"//"+location.hostname+"/services/proxy",this.authzHeader="Authorization"):(this.proxyUrl=c,this.authzHeader="X-Authorization"),this.refreshToken=null,this.sessionId=null,this.apiVersion=null,this.visualforce=!1,this.instanceUrl=null,this.asyncAjax=!0},forcetk.Client.prototype.setRefreshToken=function(a){"use strict";this.refreshToken=a},forcetk.Client.prototype.refreshAccessToken=function(a,b){"use strict";var c=this,d=this.loginUrl+"/services/oauth2/token";return $.ajax({type:"POST",url:null===this.proxyUrl||this.visualforce?d:this.proxyUrl,cache:!1,processData:!1,data:"grant_type=refresh_token&client_id="+this.clientId+"&refresh_token="+this.refreshToken,success:a,error:b,dataType:"json",beforeSend:function(a){null===c.proxyUrl||this.visualforce||a.setRequestHeader("SalesforceProxy-Endpoint",d)}})},forcetk.Client.prototype.setSessionToken=function(a,b,c){"use strict";if(this.sessionId=a,this.apiVersion=void 0===b||null===b?"v29.0":b,void 0===c||null===c){this.visualforce=!0;var d=location.hostname.split("."),e=null;e=4===d.length&&"my"===d[1]?d[0]+"."+d[1]:3===d.length?d[0]:d[1],this.instanceUrl="https://"+e+".salesforce.com"}else this.instanceUrl=c},forcetk.Client.prototype.ajax=function(a,b,c,d,e,f){"use strict";var g=this,h=(this.visualforce?"":this.instanceUrl)+"/services/data"+a;return $.ajax({type:d||"GET",async:this.asyncAjax,url:null===this.proxyUrl||this.visualforce?h:this.proxyUrl,contentType:"DELETE"===d?null:"application/json",cache:!1,processData:!1,data:e,success:b,error:!this.refreshToken||f?c:function(f,h,i){401===f.status?g.refreshAccessToken(function(f){g.setSessionToken(f.access_token,null,f.instance_url),g.ajax(a,b,c,d,e,!0)},c):c(f,h,i)},dataType:"json",beforeSend:function(a){null===g.proxyUrl||g.visualforce||a.setRequestHeader("SalesforceProxy-Endpoint",h),a.setRequestHeader(g.authzHeader,"Bearer "+g.sessionId),a.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+g.apiVersion)}})},forcetk.Client.prototype.getChatterFile=function(a,b,c,d,e){"use strict";var f=this,g=(this.visualforce?"":this.instanceUrl)+a,h=new XMLHttpRequest;h.open("GET",null===this.proxyUrl||this.visualforce?g:this.proxyUrl,!0),h.responseType="arraybuffer",h.setRequestHeader(this.authzHeader,"Bearer "+this.sessionId),h.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+this.apiVersion),null===this.proxyUrl||this.visualforce||h.setRequestHeader("SalesforceProxy-Endpoint",g),h.onreadystatechange=function(){if(4===h.readyState)if(200===h.status)try{c(h.response)}catch(a){alert("Error reading the response: "+a.toString())}else 401!==h.status||e?d(h,h.statusText,h.response):f.refreshAccessToken(function(e){f.setSessionToken(e.access_token,null,e.instance_url),f.getChatterFile(a,b,c,d,!0)},d)},h.send()};var randomString=function(){"use strict";var b,a="";for(b=0;b<4;b+=1)a+=(Math.random().toString(16)+"000000000").substr(2,8);return a};forcetk.Client.prototype.blob=function(a,b,c,d,e,f,g,h){"use strict";var i=this,j=(this.visualforce?"":this.instanceUrl)+"/services/data"+a,k=randomString(),l=new Blob(["--boundary_"+k+'\nContent-Disposition: form-data; name="entity_content";\nContent-Type: application/json\n\n'+JSON.stringify(b)+"\n\n--boundary_"+k+'\nContent-Type: application/octet-stream\nContent-Disposition: form-data; name="'+d+'"; filename="'+c+'"\n\n',e,"\n--boundary_"+k+"--"],{type:'multipart/form-data; boundary="boundary_'+k+'"'}),m=new XMLHttpRequest;return m.open("POST",null===this.proxyUrl||this.visualforce?j:this.proxyUrl,this.asyncAjax),m.setRequestHeader("Accept","application/json"),m.setRequestHeader(this.authzHeader,"Bearer "+this.sessionId),m.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+this.apiVersion),m.setRequestHeader("Content-Type",'multipart/form-data; boundary="boundary_'+k+'"'),null===this.proxyUrl||this.visualforce||m.setRequestHeader("SalesforceProxy-Endpoint",j),this.asyncAjax&&(m.onreadystatechange=function(){4===m.readyState&&(m.status>=200&&m.status<300?f(m.response?JSON.parse(m.response):null):401!==m.status||h?g(m,m.statusText,m.response):i.refreshAccessToken(function(h){i.setSessionToken(h.access_token,null,h.instance_url),i.blob(a,b,c,d,e,f,g,!0)},g))}),m.send(l),this.asyncAjax?null:JSON.parse(m.response)},forcetk.Client.prototype.createBlob=function(a,b,c,d,e,f,g,h){"use strict";return this.blob("/"+this.apiVersion+"/sobjects/"+a+"/",b,c,d,e,f,g,h)},forcetk.Client.prototype.updateBlob=function(a,b,c,d,e,f,g,h,i){"use strict";return this.blob("/"+this.apiVersion+"/sobjects/"+a+"/"+b+"?_HttpMethod=PATCH",c,d,e,f,g,h,i)},forcetk.Client.prototype.apexrest=function(a,b,c,d,e,f,g){"use strict";var h=this,i=this.instanceUrl+"/services/apexrest"+a;return d=d||"GET","GET"===d?this.proxyUrl&&e&&("string"!=typeof e&&(e=$.param(e)),i+="?"+e,e=null):e&&"string"!=typeof e&&(e=JSON.stringify(e)),$.ajax({type:d,async:this.asyncAjax,url:this.proxyUrl||i,contentType:"application/json",cache:!1,processData:!1,data:e,success:b,error:!this.refreshToken||g?c:function(g,i,j){401===g.status?h.refreshAccessToken(function(g){h.setSessionToken(g.access_token,null,g.instance_url),h.apexrest(a,b,c,d,e,f,!0)},c):c(g,i,j)},dataType:"json",beforeSend:function(a){var b;null!==h.proxyUrl&&a.setRequestHeader("SalesforceProxy-Endpoint",i),null===f&&(f={});for(b in f)f.hasOwnProperty(b)&&a.setRequestHeader(b,f[b]);a.setRequestHeader(h.authzHeader,"Bearer "+h.sessionId),a.setRequestHeader("X-User-Agent","salesforce-toolkit-rest-javascript/"+h.apiVersion)}})},forcetk.Client.prototype.versions=function(a,b){"use strict";return this.ajax("/",a,b)},forcetk.Client.prototype.resources=function(a,b){"use strict";return this.ajax("/"+this.apiVersion+"/",a,b)},forcetk.Client.prototype.describeGlobal=function(a,b){"use strict";return this.ajax("/"+this.apiVersion+"/sobjects/",a,b)},forcetk.Client.prototype.metadata=function(a,b,c){"use strict";return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/",b,c)},forcetk.Client.prototype.describe=function(a,b,c){"use strict";return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/describe/",b,c)},forcetk.Client.prototype.create=function(a,b,c,d){"use strict";return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/",c,d,"POST",JSON.stringify(b))},forcetk.Client.prototype.retrieve=function(a,b,c,d,e){"use strict";4===arguments.length&&(e=d,d=c,c=null);var f=c?"?fields="+c:"";return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+b+f,d,e)},forcetk.Client.prototype.upsert=function(a,b,c,d,e,f){"use strict";return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+b+"/"+c+"?_HttpMethod=PATCH",e,f,"POST",JSON.stringify(d))},forcetk.Client.prototype.update=function(a,b,c,d,e){"use strict";return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+b+"?_HttpMethod=PATCH",d,e,"POST",JSON.stringify(c))},forcetk.Client.prototype.del=function(a,b,c,d){"use strict";return this.ajax("/"+this.apiVersion+"/sobjects/"+a+"/"+b,c,d,"DELETE")},forcetk.Client.prototype.query=function(a,b,c){"use strict";return this.ajax("/"+this.apiVersion+"/query?q="+encodeURIComponent(a),b,c)},forcetk.Client.prototype.queryMore=function(a,b,c){"use strict";var d="services/data",e=a.indexOf(d);return e>-1&&(a=a.substr(e+d.length)),this.ajax(a,b,c)},forcetk.Client.prototype.search=function(a,b,c){"use strict";return this.ajax("/"+this.apiVersion+"/search?q="+encodeURIComponent(a),b,c)}}