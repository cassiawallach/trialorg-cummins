@isTest
public class CG_CL_PartsfromERPController_Test
{
    static testMethod void CG_CL_PartsfromERPController_Test()
    {
      list<CSS_Parts_Options__c> customPartlstUIList = new List<CSS_Parts_Options__c>();
        list<CSS_Parts_Options__c> existPartList = new List<CSS_Parts_Options__c>();
        CSS_Job_Order__c JO = NEW CSS_Job_Order__c();
        JO.Customer_Name__c = 'CumminsTnD';
        JO.Status__c = 'Repair Complete';
        JO.Make__c = 'test1234';
        JO.Model__c = 'test1234';
        JO.DSID__c = 'test1234';
        JO.Equipment_ID__c = 'test1234';
        JO.Service_Model__c = 'test1234';
        JO.Shop_Work_Order__c = 'test1234';
        JO.Failure_Date__c=date.today();
        JO.ESN__c = '79464646';
    
        insert(JO);
        List<CSS_Solutions__c>solu = new List<CSS_Solutions__c>();
        CSS_Solutions__c solRef = new CSS_Solutions__c();
        solRef.Diagnostic_Response__c='Most likely the solution';
        solRef.Service_Job__c=JO.Id;
        solRef.Solution_title__c='TestData';
        //solRef.Account_Code__c ='A';
        insert solRef;
        //CSS_Solution_Component__c solComRef = CSS_TestData.createSRT(true,JO.Id,solRef.Id);
          css_solution_component__c solcomp1 = new css_solution_component__c();
    solcomp1.Service_Job__c=jo.id;
    solcomp1.Solutions__c=solRef.id;
    solcomp1.Fail_Code_Editable__c='WEQPZ';
    //solcomp1.AccountCode__c = 'Select';
//solcomp1.AccountCodeType__c = 'One';
solcomp1.AccountCodeEdit__c = 'CMP-Campaign / Recalls 65';
//solcomp1.System_Code__c = 'Select';
//solcomp1.Component_Code__c = 'One';
solcomp1.CoveredPartsQty__c = '123';
solcomp1.CoveredOCAmount__c = '123';
insert solcomp1;
  map<id,list<CSS_Parts_Options__c>> mapSolCompToParts=new map<id,list<CSS_Parts_Options__c>>();
        list<CSS_Parts_Options__c> lstpo =new list<CSS_Parts_Options__c>();
         Id recTypeIdpart = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'Parts');
         CSS_Parts_Options__c po =new CSS_Parts_Options__c();
        po.Notes__c='123';
        po.RecordTypeId = recTypeIdpart;
        po.Service_Job__c = JO.id;
        po.OEM__c ='123';
        po.Quantity__c =1;
        po.Selected_part__c =true;
        po.Part_Name__c ='123';
        po.Service_partnumber__c ='123';
        po.Parts_Type__c ='Custom';
        po.Service_Job__c = JO.id;
        po.PartOC__c='OC';
        //po.Account_Code__c ='A'; 
        po.Solutions__c=solRef.id;
        po.FailurepartId__c =solcomp1.Id; 
        po.PartOC__c='PART';
        po.Quantity_Used__c='2';
        po.ReturnToFactory__c='1';
        po.Quantity_Used__c = null;
        po.Sell_Price__c=123.00;
        po.Warranty_Allocation__c=1.0;
        po.Comments__c='Repair';
        po.Quantity__c=1;
        po.Covered__c=1;
        
        lstpo.add(po);
        insert lstpo;
        mapSolCompToParts.put(po.FailurepartId__c, lstpo);
        
        existPartList.add(po);
        system.debug('existPartListis'+existPartList);
        list<CSS_JobEventTemporary__c> lstjobevTemRef = new list<CSS_JobEventTemporary__c>();
        CSS_JobEventTemporary__c jobevTemRef = new CSS_JobEventTemporary__c();
        jobevTemRef.Type__c='testData';
        jobevTemRef.File_Name__c='TestData';
        jobevTemRef.Key__c='AccountCodes';
        jobevTemRef.Attribute1__c='OTH';
        jobevTemRef.Attribute2__c='OTH2';
        jobevTemRef.Attribute3__c='OTH3';
        jobevTemRef.Attribute5__c='OTH5';
        
        insert jobevTemRef;
        lstjobevTemRef.add(jobevTemRef);
        CSS_JobEventTemporary__c jobevTemRef1 = new CSS_JobEventTemporary__c();
        jobevTemRef1.Type__c='testData';
        jobevTemRef1.File_Name__c='TestData';
        jobevTemRef1.Key__c='AccountCodes';
        jobevTemRef1.Attribute1__c='POL';
        jobevTemRef1.Attribute2__c='POL2';
        jobevTemRef1.Attribute3__c='POL3';
        jobevTemRef1.Attribute5__c='POL5';
        
        insert jobevTemRef1;
        lstjobevTemRef.add(jobevTemRef1);
        customPartlstUIList = existPartList.clone();
        customPartlstUIList[0].Selected_part__c= false;
        
        system.debug('customPartlstUIList'+customPartlstUIList);
        
        PageReference pageRef = new PageReference('/apex/JobPlan?id=');
        test.setCurrentPage(pageRef);        
        pageRef.getParameters().put('id',JO.id);
           User u = css_utility.getUserAttributes(userinfo.getUserId()); 
                string lang = u.LanguageLocaleKey;
        
       // ApexPages.CurrentPage().getParameters().put('id',servicejob.Id);
        id partRecTypeId2 = Schema.SObjectType.CSS_Parts_Options__c.getRecordTypeInfosByName().get('BMS Parts').getRecordTypeId();
        CSS_Parts_Options__c po2 =new CSS_Parts_Options__c();
        po2.Notes__c='123';
        po2.RecordTypeId = partRecTypeId2;
        //po.Service_Job__c = JO.id;
        po2.OEM__c ='123';
        po2.Quantity__c =1;
        po2.Selected_part__c =true;
        po2.Part_Name__c ='123';
        po2.Service_partnumber__c ='123';
        po2.Parts_Type__c ='Custom';
        po2.Service_Job__c = JO.id;
        po2.Solutions__c=solRef.id;
        po2.FailurepartId__c =solcomp1.Id;
        po2.PartOC__c='PART';
        po2.Quantity_Used__c='2';
        po2.ReturnToFactory__c='1';
        po2.Sell_Price__c=123.00;
        po2.Warranty_Allocation__c=1.0;
        po2.Comments__c='Repair';
        po2.Quantity__c=1;
        po2.Covered__c=1;
        insert po2;
        CG_CL_PartsfromERPController srtParts1 =new CG_CL_PartsfromERPController();
        CG_CL_PartsFromERPController.PartWrapper testWrap=new CG_CL_PartsFromERPController.PartWrapper(po2.id,'','',0,'',0,0,0,'Select One','Select One','',True,'',0,0,null);
      List< CG_CL_PartsFromERPController.PartWrapper> testWrap1=new List<CG_CL_PartsFromERPController.PartWrapper>();
      testWrap1.add(testWrap);
      //  CSS_SRTParts.srtsolWrapper wrapRef = new CSS_SRTParts.srtsolWrapper();
        Test.startTest();
       // srtParts1.customPartlstUI=customPartlstUIList;
        //srtParts1.saveCustomParts();
         //CSS_srtParts srtParts1 = new CSS_srtParts();
        //repreason = srtParts1.getreplacementReasonOptions();
       
        
        
        //srtParts1.partdispjbp = lstpo;
        //srtParts1.capturesol = solu;
        
        List<string> lstAccountCodes1 = new List<string>();
        lstAccountCodes1.add('element');
        lstAccountCodes1.add('eeelement');
        List<SelectOption> accCodes1 = new List<SelectOption>();
                 
         accCodes1.add(new SelectOption('01', 'Jan'));
            accCodes1.add(new SelectOption('02', 'Feb'));
        //insert accCodes1;
        srtParts1.accCodes = accCodes1;
        srtParts1.lstAccountCodes = lstAccountCodes1;
        //accCodes = srtParts1.accountCodelistN('ReCon Policy','9','wer');
            //srtParts1.accountCodelistN('ReCon Policy','9','wer');
            //srtParts1.getPartsList();
        //srtParts1.saveUserAddedParts();
        srtParts1.getAccountCodes();
                srtParts1.getfailcodes();
        srtParts1.GetPartsfromERP();
        system.debug('srtParts1==='+srtParts1);
        //    srtParts1.saveParts();
         srtParts1.failcodeSelected='WEQPZ';
        srtParts1.acccodeSelected='CMP-Campaign / Recalls 65';
        id pgid1 = apexpages.currentPage().getparameters().put('id',JO.Id);
        srtParts1.pgid=pgid1;
        srtParts1.partIdSelected=po2.id;
        srtParts1.onaccCodechange();
        system.debug('srtParts2==='+srtParts1);
              
        Test.stopTest();   
    }
    static testmethod void testmethod2()
    {
        CG_CL_PartsFromERPController partserp = new CG_CL_PartsFromERPController();
        system.assert(partserp.acccodeSelected==null);
        system.assert(partserp.failcodeSelected==null);
        system.assert(partserp.jobEventTemp==null);
        system.assert(partserp.partIdSelected==null);
    }
    static testmethod void testmethod3()
    {
         CSS_Job_Order__c JO = NEW CSS_Job_Order__c();
        JO.Customer_Name__c = 'CumminsTnD';
        JO.Status__c = 'Repair Complete';
        JO.Make__c = 'test1234';
        JO.Model__c = 'test1234';
        JO.DSID__c = 'test1234';
        JO.Equipment_ID__c = 'test1234';
        JO.Service_Model__c = 'test1234';
        JO.Shop_Work_Order__c = 'test1234';
        JO.Failure_Date__c=date.today();
        JO.ESN__c = '79464646';
        insert(JO);
        CSS_Solutions__c solRef = new CSS_Solutions__c();
        solRef.Diagnostic_Response__c='Most likely the solution';
        solRef.Service_Job__c=JO.Id;
        solRef.Solution_title__c='TestData';
        insert solRef;
        CSS_Solution_Component__c solComRef = CSS_TestData.createSRT(false,JO.Id,solRef.Id);
        //solComRef.System_Code__c='WE';
        solComRef.Service_Job__c=JO.Id;
        //solComRef.Component_Code__c='QPEZ';
        solComRef.Fail_Code_Editable__c='WEQPEZ';
        solcomref.Selected_Component__c=true;
        //solComRef.CSS_Account_Formula__c='testing';
        solComRef.CoveredPartsQty__c='testing';
        solComRef.CoveredOCAmount__c='testing';
        //solComRef.AccountCodeEdit__c='testing';
        //solComRef.AccountCodeType__c='xyzabc';
        //solComRef.AccountCode__c='testing';
        solComRef.AccountCodeEdit__c='CMP-Campaign / Recalls 65';
        insert solComRef;
         CSS_Solution_Component__c solComRef12 =new CSS_Solution_Component__c();
        //solComRef12.System_Code__c='WE';
        solComRef.Service_Job__c=JO.Id;
        //solComRef.Component_Code__c='QPEZ';
        solComRef.Fail_Code_Editable__c='WEQPEZ';
        solcomref12.Selected_Component__c=true;
        //solComRef.CSS_Account_Formula__c='testing';
        solComRef12.CoveredPartsQty__c='testing';
        solComRef12.CoveredOCAmount__c='testing';
        solComRef12.AccountCodeEdit__c='CMP-Campaign / Recalls 65';
        //solComRef12.AccountCodeType__c='xyzabc';
        //solComRef12.AccountCode__c='testing';
        //solComRef12.AccountCodeEdit__c='asdf';
        insert solComRef12;
        list<CSS_Solution_Component__c> lstSolComp = new list<CSS_Solution_Component__c>();
            lstSolComp.add(solComRef);
            lstSolComp.add(solComRef12);
        CSS_Solution_Component__c solComRef1 =[select name,action__c,FailCode_Formula__c,Component_Id__c,Failure_Date__c,Failure_Point__c,Customer_Take_Possession__c,Part_Warranty_Start_Date__c,Failure_Measure__c,CSS_Account_Formula__c,Selected_Component__c,Solutions__c,Quantity__c,Service_Job__c,Fail_Code__c ,Fail_Code_Editable__c,AccountCodeEdit__c,AccountCode__c,AccountCodeType__c,Authorization_Number__C,Approval_Code__c,Pay_Code__c,CSS_CoverageType__c,
                           Claim_Type__c,Failure_Mode__c,CoveredPartsQty__c,System_Code__c,Component_Code__c,Solutions__r.Diagnostic_Response__c
                           from CSS_Solution_Component__c limit 1];
        system.debug('solComRef1==='+solComRef1);
        system.debug('lstSolComp==='+lstSolComp);
         system.debug('lstSolComp.size()==='+lstSolComp.size());
       
       Id recTypeIdpart = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'TTML');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po =new CSS_Parts_Options__c();
        po.Notes__c='123';
        po.RecordTypeId = recTypeIdpart;
        //po.Service_Job__c = JO.id;
        po.OEM__c ='123';
        po.Quantity__c =1;
        po.Selected_part__c =true;
        po.Part_Name__c ='123';
        po.Service_partnumber__c ='123';
        po.Parts_Type__c ='Custom';
        po.Service_Job__c = JO.id;
        po.Solutions__c=solRef.id;
        po.FailurepartId__c =solComRef1.Id;
        po.PartOC__c='PART';
        po.Quantity_Used__c='2';
        po.ReturnToFactory__c='1';
        po.Sell_Price__c=123.00;
        po.Warranty_Allocation__c=1.0;
        po.Comments__c='Repair';
        po.Quantity__c=1;
        po.Covered__c=1;
        insert po;
        Id recTypeIdpart1 = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po1 =new CSS_Parts_Options__c();
        po1.Notes__c='123';
        po1.RecordTypeId = recTypeIdpart1;
        po1.Service_Job__c = JO.id;
        po1.OEM__c ='123';
        po1.Quantity__c =1;
        po1.Selected_part__c =true;
        po1.Part_Name__c ='123';
        po1.Service_partnumber__c ='123';
        po1.Parts_Type__c ='Custom';
        po1.Service_Job__c = JO.id;
        po1.Solutions__c=solRef.id;
        po1.FailurepartId__c =solComRef.Id;
        po1.PartOC__c='PART';
        po1.Quantity_Used__c='2';
        po1.ReturnToFactory__c='1';
        po1.Sell_Price__c=123.00;
        po1.Warranty_Allocation__c=1.0;
        po1.Comments__c='Repair';
        po1.Quantity__c=1;
        po1.Covered__c=1;
        
        insert po1;
        CSS_JobEventTemporary__c jobevTemRef = new CSS_JobEventTemporary__c();
        jobevTemRef.Type__c='testData';
        jobevTemRef.File_Name__c='TestData';
        jobevTemRef.Key__c='AccountCodes';
        jobevTemRef.Attribute1__c='OTH';
        jobevTemRef.Attribute2__c='OTH2';
        jobevTemRef.Attribute3__c='OTH3';
        jobevTemRef.Attribute5__c='OTH5';
        insert jobevTemRef;
        CSS_JobEventTemporary__c jobevTemRef1 = new CSS_JobEventTemporary__c();
        jobevTemRef1.Type__c='testData';
        jobevTemRef1.File_Name__c='TestData';
        jobevTemRef1.Key__c='AccountCodes';
        jobevTemRef1.Attribute1__c='POL';
        jobevTemRef1.Attribute2__c='POL2';
        jobevTemRef1.Attribute3__c='POL3';
        jobevTemRef1.Attribute5__c='POL5';
        insert jobevTemRef1;
         PageReference pageRef = new PageReference('/apex/JobPlan?id=');
        test.setCurrentPage(pageRef);        
        pageRef.getParameters().put('id',JO.id);
        id pgid = apexpages.currentPage().getparameters().get('id');
        id partRecTypeId2 = Schema.SObjectType.CSS_Parts_Options__c.getRecordTypeInfosByName().get('BMS Parts').getRecordTypeId();
        CSS_Parts_Options__c po2 =new CSS_Parts_Options__c();
        po2.Notes__c='123';
        po2.RecordTypeId = partRecTypeId2;
        //po.Service_Job__c = JO.id;
        po2.OEM__c ='123';
        po2.Quantity__c =1;
        po2.Selected_part__c =true;
        po2.Part_Name__c ='123';
        po2.Service_partnumber__c ='123';
        po2.Parts_Type__c ='Custom';
        po2.Service_Job__c = JO.id;
        po2.Solutions__c=solRef.id;
        po2.FailurepartId__c =solComRef1.Id;
        po2.PartOC__c='PART';
        po2.Quantity_Used__c='2';
        po2.ReturnToFactory__c='1';
        po2.Sell_Price__c=123.00;
        po2.Warranty_Allocation__c=1.0;
        po2.Comments__c='Repair';
        po2.Quantity__c=1;
        po2.Covered__c=1;
        insert po2;
        system.assert(pgid!=null);
         list<CSS_Parts_Options__c> partsList = [select Id, Name, Quantity__c, Quantity_Used__c,Part_Description__c,Part_Name__c,Sell_Price__c, Service_partnumber__c, Account_Code__c, Fail_Code__c, Service_Job__c, ReturnToFactory__c,Parts_Return__c,Covered__c,Comments__c,Warranty_Allocation__c from CSS_Parts_Options__c where Service_Job__c =: pgId AND RecordTypeId=:partRecTypeId2 AND PartOC__c IN ('PART','OC','TOW')];
             system.assert(partsList!=null);
        CG_CL_PartsFromERPController partserp = new CG_CL_PartsFromERPController();
        CG_CL_PartsFromERPController.PartWrapper testWrap=new CG_CL_PartsFromERPController.PartWrapper(po2.id,'','',0,'',0,0,0,'Select One','Select One','',True,'',0,0,null);
      List< CG_CL_PartsFromERPController.PartWrapper> testWrap1=new List<CG_CL_PartsFromERPController.PartWrapper>();
      testWrap1.add(testWrap);
       // partserp.EprReturnedPartlist=partsList;
        partserp.GetPartsfromERP();
        //partserp.saveParts();
        partserp.getAccountCodes();
        partserp.getfailcodes();
        partserp.failcodeSelected='WEQPEZ';
        id pgid1 = apexpages.currentPage().getparameters().put('id',JO.Id);
        partserp.pgid=pgid1;
        partserp.partIdSelected=po2.id;
        partserp.FailCodeChange();
        //partserp.onaccCodechange();
    }
 static testmethod void testmethod4()
    {
        user u = css_testdata.createTestUser(false);
        u.Username='gopal.ra@cummins.com';
        u.User_Location__c='57630-57630';
        insert u;
        system.runAs(u)
        {
            Account a = new account();
            a.Name='Gopal';
            a.IAM_Service_Provider_Code__c='57630';
            a.CSS_DistributorCode__c='57630';
            a.Region__c='NORTH AMERICA';
            a.Territory__c='UNITED STATES';
            a.IAM_Service_Provider_Code__c = '56270';
           a.Type = 'Customer';
           a.IAM_Service_Provider_Code__c = '56270';
           a.CMI_Account_Status__c = 'Active';
            insert a;
         CSS_Job_Order__c JO = NEW CSS_Job_Order__c();
        JO.Customer_Name__c = 'CumminsTnD';
        JO.Status__c = 'Repair Complete';
        JO.Make__c = 'test1234';
        JO.Model__c = 'test1234';
        JO.DSID__c = 'test1234';
        JO.Equipment_ID__c = 'test1234';
        JO.Service_Model__c = 'test1234';
        JO.Shop_Work_Order__c = 'test1234';
        JO.Failure_Date__c=date.today();
        JO.ESN__c = '79464646';
        jo.CSS_Job_Location_Code__c='57630-57630';
        insert(JO);
            css_job_order__c jo1 = [select Customer_Name__c,Creator_Location__c,Status__c,Make__c,Model__c,Equipment_ID__c,ESN__c,name from css_job_order__c limit 1];
        CSS_Solutions__c solRef = new CSS_Solutions__c();
        solRef.Diagnostic_Response__c='Most likely the solution';
        solRef.Service_Job__c=JO.Id;
        solRef.Solution_title__c='TestData';
        insert solRef;
        CSS_Solution_Component__c solComRef = CSS_TestData.createSRT(false,JO.Id,solRef.Id);
        solComRef.Fail_Code_Editable__c='1856-Testing';
        solcomref.Selected_Component__c=true;
        insert solComRef;
        list<CSS_Solution_Component__c> lstSolComp = new list<CSS_Solution_Component__c>();
            lstSolComp.add(solComRef);
           // lstSolComp.add(solRef);
            
        CSS_Solution_Component__c solComRef1 =[select name,action__c,FailCode_Formula__c,Component_Id__c,Failure_Date__c,Failure_Point__c,Customer_Take_Possession__c,Part_Warranty_Start_Date__c,Failure_Measure__c,CSS_Account_Formula__c,Selected_Component__c,Solutions__c,Quantity__c,Service_Job__c,Fail_Code__c ,Fail_Code_Editable__c,AccountCodeEdit__c,AccountCode__c,AccountCodeType__c,Authorization_Number__C,Approval_Code__c,Pay_Code__c,CSS_CoverageType__c,
                           Claim_Type__c,Failure_Mode__c,CoveredPartsQty__c,System_Code__c,Component_Code__c,Solutions__r.Diagnostic_Response__c
                           from CSS_Solution_Component__c limit 1];
        system.assert(solComRef1.FailCode_Formula__c!=null);
        system.assert(solComRef1.Selected_Component__c==true);
        system.assert(solcomref1.Service_Job__c==jo.id);
       Id recTypeIdpart = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'BMS Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po =new CSS_Parts_Options__c();
        po.Notes__c='123';
        po.RecordTypeId = recTypeIdpart;
        //po.Service_Job__c = JO.id;
        po.OEM__c ='123';
        po.Quantity__c =1;
        po.Selected_part__c =true;
        po.Part_Name__c ='123';
        po.Service_partnumber__c ='123';
        po.Parts_Type__c ='Custom';
        po.Service_Job__c = JO.id;
        po.Solutions__c=solRef.id;
        po.FailurepartId__c =solComRef1.Id;
        po.PartOC__c='PART';
        po.Quantity_Used__c='2';
        po.ReturnToFactory__c='1';
        po.Sell_Price__c=123.00;
        po.Warranty_Allocation__c=1.0;
        po.Comments__c='Repair';
        po.Quantity__c=1;
        po.Covered__c=1;
        insert po;
        Id recTypeIdpart1 = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po1 =new CSS_Parts_Options__c();
        po1.Notes__c='123';
        po1.RecordTypeId = recTypeIdpart1;
        po1.Service_Job__c = JO.id;
        po1.OEM__c ='123';
        po1.Quantity__c =1;
        po1.Selected_part__c =true;
        po1.Part_Name__c ='123';
        po1.Service_partnumber__c ='123';
        po1.Parts_Type__c ='Custom';
        po1.Service_Job__c = JO.id;
        po1.Solutions__c=solRef.id;
        po1.FailurepartId__c =solComRef.Id;
        po1.PartOC__c='PART';
        po1.Quantity_Used__c='2';
        po1.ReturnToFactory__c='1';
        po1.Sell_Price__c=123.00;
        po1.Warranty_Allocation__c=1.0;
        po1.Comments__c='Repair';
        po1.Quantity__c=1;
        po1.Covered__c=1;
        
        insert po1;
        CSS_JobEventTemporary__c jobevTemRef = new CSS_JobEventTemporary__c();
        jobevTemRef.Type__c='testData';
        jobevTemRef.File_Name__c='TestData';
        jobevTemRef.Key__c='AccountCodes';
        jobevTemRef.Attribute1__c='OTH';
        jobevTemRef.Attribute2__c='OTH2';
        jobevTemRef.Attribute3__c='OTH3';
        jobevTemRef.Attribute5__c='OTH5';
        insert jobevTemRef;
        CSS_JobEventTemporary__c jobevTemRef1 = new CSS_JobEventTemporary__c();
        jobevTemRef1.Type__c='testData';
        jobevTemRef1.File_Name__c='TestData';
        jobevTemRef1.Key__c='AccountCodes';
        jobevTemRef1.Attribute1__c='POL';
        jobevTemRef1.Attribute2__c='POL2';
        jobevTemRef1.Attribute3__c='POL3';
        jobevTemRef1.Attribute5__c='POL5';
        insert jobevTemRef1;
         PageReference pageRef = new PageReference('/apex/JobPlan?id=');
        test.setCurrentPage(pageRef);        
        pageRef.getParameters().put('id',JO.id);
        id pgid = apexpages.currentPage().getparameters().get('id');
        id partRecTypeId = Schema.SObjectType.CSS_Parts_Options__c.getRecordTypeInfosByName().get('BMS Parts').getRecordTypeId();
        system.assert(pgid!=null);
         list<CSS_Parts_Options__c> partsList = [select Id, Name, Quantity__c, Quantity_Used__c,Part_Description__c,Part_Name__c,Sell_Price__c, Service_partnumber__c, Account_Code__c, Fail_Code__c, Service_Job__c, ReturnToFactory__c,Parts_Return__c,Covered__c,Comments__c,Warranty_Allocation__c from CSS_Parts_Options__c where Service_Job__c =: pgId AND RecordTypeId=:partRecTypeId AND PartOC__c IN ('PART','OC','TOW')];
             system.assert(partsList!=null);
        test.startTest();
        CG_CL_PartsFromERPController partserp = new CG_CL_PartsFromERPController();
        partserp.isDealer=True;
        partserp.lstpartWrapper=null;
        //partserp.saveParts();
            partserp.workJob=jo1;
         partserp.getAccountCodes();
        partserp.getfailcodes();
        test.stopTest();
    }
   }
static Testmethod void Save_Test(){
     user u = css_testdata.createTestUser(false);
        u.Username='gopal.ra@cummins.com';
        u.User_Location__c='57630-57630';
        insert u;
        system.runAs(u)
        {
            Account a = new account();
            a.Name='Gopal';
            a.IAM_Service_Provider_Code__c='57630';
            a.CSS_DistributorCode__c='57630';
            a.Region__c='NORTH AMERICA';
            a.Territory__c='UNITED STATES';
            a.IAM_Service_Provider_Code__c = '56270';
           a.Type = 'Customer';
           a.IAM_Service_Provider_Code__c = '56270';
           a.CMI_Account_Status__c = 'Active';
            insert a;
         CSS_Job_Order__c JO = NEW CSS_Job_Order__c();
        JO.Customer_Name__c = 'CumminsTnD';
        JO.Status__c = 'Repair Complete';
        JO.Make__c = 'test1234';
        JO.Model__c = 'test1234';
        JO.DSID__c = 'test1234';
        JO.Equipment_ID__c = 'test1234';
        JO.Service_Model__c = 'test1234';
        JO.Shop_Work_Order__c = 'test1234';
        JO.Failure_Date__c=date.today();
        JO.ESN__c = '79464646';
        jo.CSS_Job_Location_Code__c='57630-57630';
        insert(JO);
            css_job_order__c jo1 = [select Customer_Name__c,Creator_Location__c,Status__c,Make__c,Model__c,Equipment_ID__c,ESN__c,name from css_job_order__c limit 1];
        CSS_Solutions__c solRef = new CSS_Solutions__c();
        solRef.Diagnostic_Response__c='Most likely the solution';
        solRef.Service_Job__c=JO.Id;
        solRef.Solution_title__c='TestData';
        insert solRef;
        CSS_Solution_Component__c solComRef = CSS_TestData.createSRT(false,JO.Id,solRef.Id);
        solComRef.Fail_Code_Editable__c='1856-Testing';
        solcomref.Selected_Component__c=true;
        insert solComRef;
        list<CSS_Solution_Component__c> lstSolComp = new list<CSS_Solution_Component__c>();
            lstSolComp.add(solComRef);
           // lstSolComp.add(solRef);
            
        CSS_Solution_Component__c solComRef1 =[select name,action__c,FailCode_Formula__c,Component_Id__c,Failure_Date__c,Failure_Point__c,Customer_Take_Possession__c,Part_Warranty_Start_Date__c,Failure_Measure__c,CSS_Account_Formula__c,Selected_Component__c,Solutions__c,Quantity__c,Service_Job__c,Fail_Code__c ,Fail_Code_Editable__c,AccountCodeEdit__c,AccountCode__c,AccountCodeType__c,Authorization_Number__C,Approval_Code__c,Pay_Code__c,CSS_CoverageType__c,
                           Claim_Type__c,Failure_Mode__c,CoveredPartsQty__c,System_Code__c,Component_Code__c,Solutions__r.Diagnostic_Response__c
                           from CSS_Solution_Component__c limit 1];
        system.assert(solComRef1.FailCode_Formula__c!=null);
        system.assert(solComRef1.Selected_Component__c==true);
        system.assert(solcomref1.Service_Job__c==jo.id);
       Id recTypeIdpart = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'BMS Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po =new CSS_Parts_Options__c();
        po.Notes__c='123';
        po.RecordTypeId = recTypeIdpart;
        //po.Service_Job__c = JO.id;
        po.OEM__c ='123';
        po.Quantity__c =1;
        po.Selected_part__c =true;
        po.Part_Name__c ='123';
        po.Service_partnumber__c ='123';
        po.Parts_Type__c ='Custom';
        po.Service_Job__c = JO.id;
        po.Solutions__c=solRef.id;
        po.FailurepartId__c =solComRef1.Id;
        po.PartOC__c='PART';
        po.Quantity_Used__c='2';
        po.ReturnToFactory__c='1';
        po.Sell_Price__c=123.00;
        po.Warranty_Allocation__c=1.0;
        po.Comments__c='Repair';
        po.Quantity__c=1;
        po.Covered__c=1;
        insert po;
        Id recTypeIdpart1 = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po1 =new CSS_Parts_Options__c();
        po1.Notes__c='123';
        po1.RecordTypeId = recTypeIdpart1;
        po1.Service_Job__c = JO.id;
        po1.OEM__c ='123';
        po1.Quantity__c =1;
        po1.Selected_part__c =true;
        po1.Part_Name__c ='123';
        po1.Service_partnumber__c ='123';
        po1.Parts_Type__c ='Custom';
        po1.Service_Job__c = JO.id;
        po1.Solutions__c=solRef.id;
        po1.FailurepartId__c =solComRef.Id;
        po1.PartOC__c='PART';
        po1.Quantity_Used__c='2';
        po1.ReturnToFactory__c='1';
        po1.Sell_Price__c=123.00;
        po1.Warranty_Allocation__c=1.0;
        po1.Comments__c='Repair';
        po1.Quantity__c=1;
        po1.Covered__c=1;
        po1.Fail_Code__c='Select One';
        po1.Account_Code__c='Select One';
        insert po1;
        CSS_JobEventTemporary__c jobevTemRef = new CSS_JobEventTemporary__c();
        jobevTemRef.Type__c='testData';
        jobevTemRef.File_Name__c='TestData';
        jobevTemRef.Key__c='AccountCodes';
        jobevTemRef.Attribute1__c='OTH';
        jobevTemRef.Attribute2__c='OTH2';
        jobevTemRef.Attribute3__c='OTH3';
        jobevTemRef.Attribute5__c='OTH5';
        insert jobevTemRef;
        CSS_JobEventTemporary__c jobevTemRef1 = new CSS_JobEventTemporary__c();
        jobevTemRef1.Type__c='testData';
        jobevTemRef1.File_Name__c='TestData';
        jobevTemRef1.Key__c='AccountCodes';
        jobevTemRef1.Attribute1__c='POL';
        jobevTemRef1.Attribute2__c='POL2';
        jobevTemRef1.Attribute3__c='POL3';
        jobevTemRef1.Attribute5__c='POL5';
        insert jobevTemRef1;
         PageReference pageRef = new PageReference('/apex/JobPlan?id=');
        test.setCurrentPage(pageRef);        
        pageRef.getParameters().put('id',JO.id);
        id pgid = apexpages.currentPage().getparameters().get('id');
        id partRecTypeId = Schema.SObjectType.CSS_Parts_Options__c.getRecordTypeInfosByName().get('BMS Parts').getRecordTypeId();
        system.assert(pgid!=null);
         list<CSS_Parts_Options__c> partsList = [select Id, Name, Quantity__c, Quantity_Used__c,Part_Description__c,Part_Name__c,Sell_Price__c, Service_partnumber__c, Account_Code__c, Fail_Code__c, Service_Job__c, ReturnToFactory__c,Parts_Return__c,Covered__c,Comments__c,Warranty_Allocation__c from CSS_Parts_Options__c where Service_Job__c =: pgId AND RecordTypeId=:partRecTypeId AND PartOC__c IN ('PART','OC','TOW')];
             system.assert(partsList!=null);
        test.startTest();
            
      CG_CL_PartsFromERPController.PartWrapper testWrap=new CG_CL_PartsFromERPController.PartWrapper(po1.id,'','',0,'',0,0,0,'Select One','Select One','',True,'',0,0,null);
      List< CG_CL_PartsFromERPController.PartWrapper> testWrap1=new List<CG_CL_PartsFromERPController.PartWrapper>();
      testWrap1.add(testWrap);
      CG_CL_PartsFromERPController testWrap2=new CG_CL_PartsFromERPController();
      testWrap2.lstpartWrapper=testWrap1;
      //testWrap2.GetPartsfromERP();
      // Test.setMock(HttpCalloutMock.class, new Cg_Cl_getPartsReturnMock_Test());

      testWrap2.saveParts();   
    }
 }
 static Testmethod void Save_Test1(){
     user u = css_testdata.createTestUser(false);
        u.Username='gopal.ra@cummins.com';
        u.User_Location__c='57630-57630';
        insert u;
        system.runAs(u)
        {
            Account a = new account();
            a.Name='Gopal';
            a.IAM_Service_Provider_Code__c='57630';
            a.CSS_DistributorCode__c='57630';
            a.Region__c='NORTH AMERICA';
            a.Territory__c='UNITED STATES';
            a.IAM_Service_Provider_Code__c = '56270';
           a.Type = 'Customer';
           a.IAM_Service_Provider_Code__c = '56270';
           a.CMI_Account_Status__c = 'Active';
            insert a;
         CSS_Job_Order__c JO = NEW CSS_Job_Order__c();
        JO.Customer_Name__c = 'CumminsTnD';
        JO.Status__c = 'Repair Complete';
        JO.Make__c = 'test1234';
        JO.Model__c = 'test1234';
        JO.DSID__c = 'test1234';
        JO.Equipment_ID__c = 'test1234';
        JO.Service_Model__c = 'test1234';
        JO.Shop_Work_Order__c = 'test1234';
        JO.Failure_Date__c=date.today();
        JO.ESN__c = '79464646';
        jo.CSS_Job_Location_Code__c='57630-57630';
        insert(JO);
            css_job_order__c jo1 = [select Customer_Name__c,Creator_Location__c,Status__c,Make__c,Model__c,Equipment_ID__c,ESN__c,name from css_job_order__c limit 1];
        CSS_Solutions__c solRef = new CSS_Solutions__c();
        solRef.Diagnostic_Response__c='Most likely the solution';
        solRef.Service_Job__c=JO.Id;
        solRef.Solution_title__c='TestData';
        insert solRef;
        //CSS_Solution_Component__c solComRef = CSS_TestData.createSRT(false,JO.Id,solRef.Id);
        CSS_Solution_Component__c solComRef = new CSS_Solution_Component__c();
          solComRef.Service_Job__c=jo.id;
    solComRef.Solutions__c=solRef.id;
    solComRef.AccountCode__c = 'Select';
solComRef.AccountCodeType__c = 'One';
solComRef.AccountCodeEdit__c = '';
solComRef.System_Code__c = 'Select';
solComRef.Component_Code__c = 'One';
solComRef.CoveredPartsQty__c = '123';
solComRef.CoveredOCAmount__c = '123';

        solComRef.Fail_Code_Editable__c='1856-Testing';
        solcomref.Selected_Component__c=true;
        insert solComRef;
        list<CSS_Solution_Component__c> lstSolComp = new list<CSS_Solution_Component__c>();
            lstSolComp.add(solComRef);
           // lstSolComp.add(solRef);
            
        CSS_Solution_Component__c solComRef1 =[select name,action__c,FailCode_Formula__c,Component_Id__c,Failure_Date__c,Failure_Point__c,Customer_Take_Possession__c,Part_Warranty_Start_Date__c,Failure_Measure__c,CSS_Account_Formula__c,Selected_Component__c,Solutions__c,Quantity__c,Service_Job__c,Fail_Code__c ,Fail_Code_Editable__c,AccountCodeEdit__c,AccountCode__c,AccountCodeType__c,Authorization_Number__C,Approval_Code__c,Pay_Code__c,CSS_CoverageType__c,
                           Claim_Type__c,Failure_Mode__c,CoveredPartsQty__c,System_Code__c,Component_Code__c,Solutions__r.Diagnostic_Response__c
                           from CSS_Solution_Component__c limit 1];
        system.assert(solComRef1.FailCode_Formula__c!=null);
        system.assert(solComRef1.Selected_Component__c==true);
        system.assert(solcomref1.Service_Job__c==jo.id);
       Id recTypeIdpart = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'BMS Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po =new CSS_Parts_Options__c();
        po.Notes__c='123';
        po.RecordTypeId = recTypeIdpart;
        //po.Service_Job__c = JO.id;
        po.OEM__c ='123';
        po.Quantity__c =1;
        po.Selected_part__c =true;
        po.Part_Name__c ='123';
        po.Service_partnumber__c ='123';
        po.Parts_Type__c ='Custom';
        po.Service_Job__c = JO.id;
        po.Solutions__c=solRef.id;
        po.FailurepartId__c =solComRef1.Id;
        po.PartOC__c='PART';
        po.Quantity_Used__c='2';
        po.ReturnToFactory__c='1';
        po.Sell_Price__c=123.00;
        po.Warranty_Allocation__c=1.0;
        po.Comments__c='Repair';
        po.Quantity__c=1;
        po.Covered__c=1;
        insert po;
        Id recTypeIdpart1 = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po1 =new CSS_Parts_Options__c();
        po1.Notes__c='123';
        po1.RecordTypeId = recTypeIdpart1;
        po1.Service_Job__c = JO.id;
        po1.OEM__c ='123';
        po1.Quantity__c =1;
        po1.Selected_part__c =true;
        po1.Part_Name__c ='123';
        po1.Service_partnumber__c ='123';
        po1.Parts_Type__c ='Custom';
        po1.Service_Job__c = JO.id;
        po1.Solutions__c=solRef.id;
        po1.FailurepartId__c =solComRef.Id;
        po1.PartOC__c='PART';
        po1.Quantity_Used__c='2';
        po1.ReturnToFactory__c='1';
        po1.Sell_Price__c=123.00;
        po1.Warranty_Allocation__c=1.0;
        po1.Comments__c='Repair';
        po1.Quantity__c=1;
        po1.Covered__c=1;
        po1.Fail_Code__c='Overlap';
        po1.Account_Code__c='Select One';
        insert po1;
        CSS_JobEventTemporary__c jobevTemRef = new CSS_JobEventTemporary__c();
        jobevTemRef.Type__c='testData';
        jobevTemRef.File_Name__c='TestData';
        jobevTemRef.Key__c='AccountCodes';
        jobevTemRef.Attribute1__c='OTH';
        jobevTemRef.Attribute2__c='OTH2';
        jobevTemRef.Attribute3__c='OTH3';
        jobevTemRef.Attribute5__c='OTH5';
        insert jobevTemRef;
        CSS_JobEventTemporary__c jobevTemRef1 = new CSS_JobEventTemporary__c();
        jobevTemRef1.Type__c='testData';
        jobevTemRef1.File_Name__c='TestData';
        jobevTemRef1.Key__c='AccountCodes';
        jobevTemRef1.Attribute1__c='POL';
        jobevTemRef1.Attribute2__c='POL2';
        jobevTemRef1.Attribute3__c='POL3';
        jobevTemRef1.Attribute5__c='POL5';
        insert jobevTemRef1;
         PageReference pageRef = new PageReference('/apex/JobPlan?id=');
        test.setCurrentPage(pageRef);        
        pageRef.getParameters().put('id',JO.id);
        id pgid = apexpages.currentPage().getparameters().get('id');
        id partRecTypeId = Schema.SObjectType.CSS_Parts_Options__c.getRecordTypeInfosByName().get('BMS Parts').getRecordTypeId();
        system.assert(pgid!=null);
         list<CSS_Parts_Options__c> partsList = [select Id, Name, Quantity__c, Quantity_Used__c,Part_Description__c,Part_Name__c,Sell_Price__c, Service_partnumber__c, Account_Code__c, Fail_Code__c, Service_Job__c, ReturnToFactory__c,Parts_Return__c,Covered__c,Comments__c,Warranty_Allocation__c from CSS_Parts_Options__c where Service_Job__c =: pgId AND RecordTypeId=:partRecTypeId AND PartOC__c IN ('PART','OC','TOW')];
             system.assert(partsList!=null);
        test.startTest();
            
      CG_CL_PartsFromERPController.PartWrapper testWrap=new CG_CL_PartsFromERPController.PartWrapper(po1.id,'','',0,'',0,0,0,'Select One','Select One','',True,'',0,0,null);
      List< CG_CL_PartsFromERPController.PartWrapper> testWrap1=new List<CG_CL_PartsFromERPController.PartWrapper>();
      testWrap1.add(testWrap);
      CG_CL_PartsFromERPController testWrap2=new CG_CL_PartsFromERPController();
      testWrap2.lstpartWrapper=testWrap1;
      testWrap2.GetPartsfromERP();
           //  Test.setMock(HttpCalloutMock.class, new Cg_Cl_getPartsReturnMock_Test());
      testWrap2.saveParts();   
    }
 }
  static testMethod void m1_Test()
    {
        test.startTest();
        id recordtyid=Schema.SObjectType.CSS_Parts_Options__c.getRecordTypeInfosByName().get('BMS Parts').getRecordTypeId();
           CSS_Job_Order__c JO = NEW CSS_Job_Order__c();
        JO.Customer_Name__c = 'CumminsTnD';
        JO.Status__c = 'Repair Complete';
        JO.Make__c = 'test1234';
        JO.Model__c = 'test1234';
        JO.DSID__c = 'test1234';
        JO.Equipment_ID__c = 'test1234';
        JO.Service_Model__c = 'test1234';
        JO.Shop_Work_Order__c = 'test1234';
        JO.Failure_Date__c=date.today();
        JO.ESN__c = '79464646';
        jo.CSS_Job_Location_Code__c='57630-57630';
        insert(JO);
        CSS_Parts_Options__c partop = new CSS_Parts_Options__c();
        partop.Service_Job__c=JO.Id;
        partop.RecordTypeId=recordtyid;
        partop.Quantity__c=2.0;
        partop.Service_partnumber__c='540571400';
        partop.Part_Name__c='KIT,SERVICE';
        partop.Sell_Price__c=1.0;
        partop.Replacement_Reason__c='';
        partop.Notes__c='';
        partop.OEM__c='';
        partop.selected_part__c=true;
        partop.ReturnToFactory__c='';
        partop.Covered__c=2.0;
        partop.Fail_Code__c='';
        partop.Account_Code__c='';
        
        insert partop;
                 CSS_Solution_Component__c solComRef =new CSS_Solution_Component__c();
       solComRef.Service_Job__c=JO.Id;
        solComRef.Fail_Code_Editable__c='Select One';
        solComRef.Selected_Component__c=true;
        solComRef.CoveredPartsQty__c='testing';
        solComRef.CoveredOCAmount__c='testing';
        solComRef.AccountCodeEdit__c='';
         insert solComRef;
                id partRecTypeId2 = Schema.SObjectType.CSS_Parts_Options__c.getRecordTypeInfosByName().get('BMS Parts').getRecordTypeId();
        CSS_Parts_Options__c po2 =new CSS_Parts_Options__c();
        po2.Notes__c='123';
        po2.RecordTypeId = partRecTypeId2;
         po2.OEM__c ='123';
        po2.Quantity__c =1;
        po2.Selected_part__c =true;
        po2.Part_Name__c ='123';
        po2.Service_partnumber__c ='123';
        po2.Parts_Type__c ='Custom';
        po2.Service_Job__c = JO.id;
        //po2.Solutions__c=solRef.id;
        po2.FailurepartId__c =solComRef.Id;
        po2.PartOC__c='PART';
        po2.Quantity_Used__c='2';
        po2.ReturnToFactory__c='1';
        po2.Sell_Price__c=123.00;
        po2.Warranty_Allocation__c=1.0;
        po2.Comments__c='Repair';
        po2.Quantity__c=1;
        po2.Covered__c=1;
        insert po2;
        apexpages.currentPage().getparameters().put('id',JO.Id);
        CG_CL_PartsFromERPController obj = new CG_CL_PartsFromERPController();
        
           
      CG_CL_PartsFromERPController.PartWrapper testWrap=new CG_CL_PartsFromERPController.PartWrapper(po2.id,'','',0,'',0,0,0,'Select One','Select One','',True,'',0,0,null);
      List< CG_CL_PartsFromERPController.PartWrapper> testWrap1=new List<CG_CL_PartsFromERPController.PartWrapper>();
      testWrap1.add(testWrap);
       obj.GetPartsfromERP();
       // Test.setMock(HttpCalloutMock.class, new Cg_Cl_getPartsReturnMock_Test());
       obj.saveParts();
         obj.getfailcodes();
       obj.getAccountCodes();
        obj.failcodeSelected='Select One';
        id pgid1 = apexpages.currentPage().getparameters().put('id',JO.Id);
        obj.pgid=pgid1;
        obj.partIdSelected=po2.id;
        
       obj.FailCodeChange();
        obj.acccodeSelected='CMP-Campaign / Recalls 65';
        obj.onaccCodechange(); 
   
    }
    static testmethod void sendERPmethod(){
     
CSS_Job_Order__c JO = new CSS_Job_Order__c();
      JO.Customer_Name__c = 'Roopa';
      JO.Application__c = 'Recreational Vehicle';
      JO.Model__c = 'RoopaTest';
      JO.Make__c = 'CSSTest';
      JO.Notes__c = 'CAMPCOMMENTS';
      JO.Failure_Point__c = 122;
      JO.Failure_Point_Measure__c = 'Miles';
      JO.VIN__c = '12345677890';
      JO.Failure_Date__c = date.today() - 20;
      JO.Warranty_Start_Date__c = date.today() - 365;
      JO.Location_Certification__c = 'abc';
      JO.jobLocation__c = 'abc';
      JO.Before_In_Service__c = True;
      //JO.lo = 10;
      //JO.Shop_s_Work_Order__c = 120;
      JO.Status__c = 'Repair Complete';
      JO.Unit_Number__c = 'test123';
      Jo.Assigned_To__c = UserInfo.getUserId();
      Jo.esn__c = '79464646';
      JO.Unit_Type__c = 'type';
      Jo.Country__c = 'United States';
      Jo.CSS_State__c = 'Indiana';
      Jo.City__c = 'Columbus';
      Jo.Customer_Code__c = '23456';
      Jo.EditComplaint__c = 'complaint';
      Jo.EditCoverage__c = 'coverage';
      Jo.EditCause__c = 'cause';
      Jo.EditCorrection__c = 'correction';
      JO.chevron_page__c = 'prt';
      JO.CSS_Resolution__c = 'Test';
      JO.DSID__c = 'VFD23';
      JO.Quote_ID__c=null;

         insert JO;
     
        PageReference pref;
        pref = new PageReference('/'+JO.id);
        pref.getParameters().put('id',JO.id);
        //pref.getParameters().put('partsUr','Parts');
        Test.setCurrentPage(pref);
        CSS_JobEventTemporary__c je = CSS_TestData.createJobEventTempObj(false);
        String json = '{'+
            '  \"Details\": {'+
            '    \"ApplicationCode\": \"12345\",'+
            '    \"Description\": \"testing\",'+
            '    \"BusinessUnit\": \"GetAssessData\",'+
            '    \"AutomotiveFlag\": \"Fault Details Data sent successfully\",'+
            '    \"MarineFlag\": \"Fault Details Data sent successfully\",'+   
            '    \"ActiveFlag\": \"Y\",'+    
            '    \"DefaultUom\": \"Fault Details Data sent successfully\"'+     
            '  },'+
            '  \"Header\": {'+   
            '        \"ReturnCodeDescription\": \"Test\",'+
            '        \"Status\": \"completed\"'+
            '      }'+
            '}'; 
        String jsonCategory = '{"DataArea": {"Details": [{"ComplaintCode": "123","Description": "abc","BusinessUnit": "EBU","ActiveFlag": "Y","Category": "aaa"},{"ComplaintCode": "345","Description": "tavdg","BusinessUnit": "PSBU","ActiveFlag": "N","Category": "bbb"}]},"Header": {"ReturnCodeDescription": "","Status": "Success"}}';
        string jsonResponse='{"DataArea": {"Details": [{"ApplicationCode": "123","Description": "abc","BusinessUnit": "EBU","AutomotiveFlag": "Y","MarineFlag": "","ActiveFlag": "N","DefaultUom": "miles"},{"ApplicationCode": "555","Description": "zxcv","BusinessUnit": "PSBU","AutomotiveFlag": "","MarineFlag": "N","ActiveFlag": "Y","DefaultUom": "miles"}]},"Header": {"ReturnCodeDescription": "","Status": "Success"}}';
        je.Reason__c =  json;
        je.attribute1__c = 'ApplicationCodes';      
        insert je;
        
        Test.startTest();
        ApexPages.currentPage().getParameters().put('id',JO.id);
        Id Wid=ApexPages.CurrentPage().getParameters().get('id');
        
css_parts_options__c poc1=new css_parts_options__c();
        poc1.Service_Job__c =JO.id;
        Id recTyIdpart = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType, 'TTML'); 
        poc1.RecordTypeId=recTyIdpart;
        poc1.Service_partnumber__c=null;
        poc1.selected_part__c=true;
        poc1.Item__c='Test';
        poc1.Siebel_Value__c='Test1';
        poc1.Type__c='Commercial-Travel';
        poc1.Type__c='Non Commercial-Travel';
        poc1.Type__c='Lodging';
        poc1.Type__c='Meals';
        poc1.Type__c='Towing';
        poc1.Quantity__c=null;
     
             insert poc1; 
       css_parts_options__c poc = [select ID,Service_Job__c,RecordType.name,Service_partnumber__c,selected_part__c from css_parts_options__c limit 1 ];
         System.debug('parts options' +poc);
         
  CG_CL_PartsFromERPController obj = new CG_CL_PartsFromERPController();
                            //obj.Wid =Wid;
                   obj.GetPartsfromERP();
       //obj.saveParts();
       obj.getfailcodes();
       obj.getAccountCodes();
       //obj.FailCodeChange();
              
                    Test.stopTest();
    }
    static Testmethod void Save_Test2(){
     user u = css_testdata.createTestUser(false);
        u.Username='gopal.ra@cummins.com';
        u.User_Location__c='57630-57630';
        insert u;
        system.runAs(u)
        {
            Account a = new account();
            a.Name='Gopal';
            a.IAM_Service_Provider_Code__c='57630';
            a.CSS_DistributorCode__c='57630';
            a.Region__c='NORTH AMERICA';
            a.Territory__c='UNITED STATES';
            a.IAM_Service_Provider_Code__c = '56270';
           a.Type = 'Customer';
           a.IAM_Service_Provider_Code__c = '56270';
           a.CMI_Account_Status__c = 'Active';
            insert a;
         CSS_Job_Order__c JO = NEW CSS_Job_Order__c();
        JO.Customer_Name__c = 'CumminsTnD';
        JO.Status__c = 'Repair Complete';
        JO.Make__c = 'test1234';
        JO.Model__c = 'test1234';
        JO.DSID__c = 'test1234';
        JO.Equipment_ID__c = 'test1234';
        JO.Service_Model__c = 'test1234';
        JO.Shop_Work_Order__c = 'test1234';
        JO.Failure_Date__c=date.today();
        JO.ESN__c = '79464646';
        jo.CSS_Job_Location_Code__c='57630-57630';
        insert(JO);
            css_job_order__c jo1 = [select Customer_Name__c,Creator_Location__c,Status__c,Make__c,Model__c,Equipment_ID__c,ESN__c,name from css_job_order__c limit 1];
        CSS_Solutions__c solRef = new CSS_Solutions__c();
        solRef.Diagnostic_Response__c='Most likely the solution';
        solRef.Service_Job__c=JO.Id;
        solRef.Solution_title__c='TestData';
        insert solRef;
        CSS_Solution_Component__c solComRef = CSS_TestData.createSRT(false,JO.Id,solRef.Id);
        solComRef.Fail_Code_Editable__c='1856-Testing';
        solcomref.Selected_Component__c=true;
        insert solComRef;
        list<CSS_Solution_Component__c> lstSolComp = new list<CSS_Solution_Component__c>();
            lstSolComp.add(solComRef);
           // lstSolComp.add(solRef);
            
        CSS_Solution_Component__c solComRef1 =[select name,action__c,FailCode_Formula__c,Component_Id__c,Failure_Date__c,Failure_Point__c,Customer_Take_Possession__c,Part_Warranty_Start_Date__c,Failure_Measure__c,CSS_Account_Formula__c,Selected_Component__c,Solutions__c,Quantity__c,Service_Job__c,Fail_Code__c ,Fail_Code_Editable__c,AccountCodeEdit__c,AccountCode__c,AccountCodeType__c,Authorization_Number__C,Approval_Code__c,Pay_Code__c,CSS_CoverageType__c,
                           Claim_Type__c,Failure_Mode__c,CoveredPartsQty__c,System_Code__c,Component_Code__c,Solutions__r.Diagnostic_Response__c
                           from CSS_Solution_Component__c limit 1];
        system.assert(solComRef1.FailCode_Formula__c!=null);
        system.assert(solComRef1.Selected_Component__c==true);
        system.assert(solcomref1.Service_Job__c==jo.id);
       Id recTypeIdpart = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'BMS Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po =new CSS_Parts_Options__c();
        po.Notes__c='123';
        po.RecordTypeId = recTypeIdpart;
        //po.Service_Job__c = JO.id;
        po.OEM__c ='123';
        po.Quantity__c =1;
        po.Selected_part__c =true;
        po.Part_Name__c ='123';
        po.Service_partnumber__c ='123';
        po.Parts_Type__c ='Custom';
        po.Service_Job__c = JO.id;
        po.Solutions__c=solRef.id;
        po.FailurepartId__c =solComRef1.Id;
        po.PartOC__c='PART';
        po.Quantity_Used__c='2';
        po.ReturnToFactory__c='1';
        po.Sell_Price__c=123.00;
        po.Warranty_Allocation__c=1.0;
        po.Comments__c='Repair';
        po.Quantity__c=1;
        po.Covered__c=1;
        insert po;
        Id recTypeIdpart1 = css_utility.getRecordTypeId(CSS_Parts_Options__c.sObjectType,'Parts');
        system.assert(recTypeIdpart!=null);
        CSS_Parts_Options__c po1 =new CSS_Parts_Options__c();
        po1.Notes__c='123';
        po1.RecordTypeId = recTypeIdpart1;
        po1.Service_Job__c = JO.id;
        po1.OEM__c ='123';
        po1.Quantity__c =1;
        po1.Selected_part__c =true;
        po1.Part_Name__c ='123';
        po1.Service_partnumber__c ='123';
        po1.Parts_Type__c ='Custom';
        po1.Service_Job__c = JO.id;
        po1.Solutions__c=solRef.id;
        po1.FailurepartId__c =solComRef.Id;
        po1.PartOC__c='PART';
        po1.Quantity_Used__c='2';
        po1.ReturnToFactory__c='1';
        po1.Sell_Price__c=123.00;
        po1.Warranty_Allocation__c=1.0;
        po1.Comments__c='Repair';
        po1.Quantity__c=1;
        po1.Covered__c=1;
        po1.Fail_Code__c='Select One';
        po1.Account_Code__c='Select One';
        insert po1;
        CSS_JobEventTemporary__c jobevTemRef = new CSS_JobEventTemporary__c();
        jobevTemRef.Type__c='testData';
        jobevTemRef.File_Name__c='TestData';
        jobevTemRef.Key__c='AccountCodes';
        jobevTemRef.Attribute1__c='OTH';
        jobevTemRef.Attribute2__c='OTH2';
        jobevTemRef.Attribute3__c='OTH3';
        jobevTemRef.Attribute5__c='OTH5';
        insert jobevTemRef;
        CSS_JobEventTemporary__c jobevTemRef1 = new CSS_JobEventTemporary__c();
        jobevTemRef1.Type__c='testData';
        jobevTemRef1.File_Name__c='TestData';
        jobevTemRef1.Key__c='AccountCodes';
        jobevTemRef1.Attribute1__c='POL';
        jobevTemRef1.Attribute2__c='POL2';
        jobevTemRef1.Attribute3__c='POL3';
        jobevTemRef1.Attribute5__c='POL5';
        insert jobevTemRef1;
         PageReference pageRef = new PageReference('/apex/JobPlan?id=');
        test.setCurrentPage(pageRef);        
        pageRef.getParameters().put('id',JO.id);
        id pgid = apexpages.currentPage().getparameters().get('id');
        id partRecTypeId = Schema.SObjectType.CSS_Parts_Options__c.getRecordTypeInfosByName().get('BMS Parts').getRecordTypeId();
        system.assert(pgid!=null);
         list<CSS_Parts_Options__c> partsList = [select Id, Name, Quantity__c, Quantity_Used__c,Part_Description__c,Part_Name__c,Sell_Price__c, Service_partnumber__c, Account_Code__c, Fail_Code__c, Service_Job__c, ReturnToFactory__c,Parts_Return__c,Covered__c,Comments__c,Warranty_Allocation__c from CSS_Parts_Options__c where Service_Job__c =: pgId AND RecordTypeId=:partRecTypeId AND PartOC__c IN ('PART','OC','TOW')];
             system.assert(partsList!=null);
        test.startTest();
            
      CG_CL_PartsFromERPController.PartWrapper testWrap3=new CG_CL_PartsFromERPController.PartWrapper(po1.id,'','',0,'',0,0,0,'Select One','Select One','',False,'',0,0,null);
      List< CG_CL_PartsFromERPController.PartWrapper> testWrap2=new List<CG_CL_PartsFromERPController.PartWrapper>();
      testWrap2.add(testWrap3);
      CG_CL_PartsFromERPController testWrap4=new CG_CL_PartsFromERPController();
      testWrap4.lstpartWrapper=testWrap2;
      //testWrap2.GetPartsfromERP();  
      testWrap4.saveParts();   
    }
 }
     static testmethod void getPartReturnTestMethod(){
        //Creating Test Data
        CSS_Integration_Details__c cid = CSS_TestData.createIntegrationDetails(false);
        cid.name = 'CSS_SBL_GetPartReturns';
        cid.ApplicationName__c = 'CSS_SBL_getpartreturn';
        cid.End_Point__c = 'https://services-stg.cummins.com/csswarranty/getpartreturn';
        insert cid;
        Test.setMock(HttpCalloutMock.class , new CSS_WS_SBL_getPartReturnDetailsMock_Test());
      
        List<CSS_Parts_Options__c> lstparts = new List<CSS_Parts_Options__c>();
        CSS_Parts_Options__c parts = new CSS_Parts_Options__c();
        parts.Covered__c =0.0;
        parts.Fail_Code__c ='test';
        parts.Service_partnumber__c='test';
        parts.Account_Code__c = 'test1';
        CSS_Job_Order__c JO = CSS_TestData.createJobOrder(FALSE);
        JO.CSS_Channel_Code__c ='101';
        JO.Qsol_Engine_Family_Code__c ='122';
        JO.Territory_Class__c = '22';
        INSERT jO;
        parts.Service_Job__c = jo.id;   // Karthik added to pass testMethod
        lstparts.add(parts);
        insert lstparts;


        date d1 = date.parse('10/10/17');

         CSS_FN_SIEBEL.getPartsReturn(lstparts);
         CG_CL_PartsFromERPController testWrap6=new CG_CL_PartsFromERPController();
         testWrap6.lstpartWrapper=null;
         //testWrap6.saveParts();
    }
    
  
}