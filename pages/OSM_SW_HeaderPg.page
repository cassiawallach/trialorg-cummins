<apex:page sidebar="false" showHeader="false" standardStylesheets="false" applyHtmlTag="true" controller="OSM_SW_Header_Ctrl" >
    
<link href="https://cdn.jsdelivr.net/gh/xxjapp/xdialog@3/xdialog.min.css" rel="stylesheet"/>
  
<script src="https://cdn.jsdelivr.net/gh/xxjapp/xdialog@3/xdialog.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
 

<style>

.dropdown-menu>li>a:hover,
.dropdown-menu>li>a:focus {
    color: white !important;
    text-decoration: none;
    background-color: teal !important;
}

.navbar-default .navbar-nav>li>a:hover, 
.navbar-default .navbar-nav>li>a:focus {
    color: white !important;
    text-decoration: none;
    background-color: #840909 !important;
}
    
.OSM_topHeader>li> a:hover,
.OSM_topHeader>li>a:focus, .OSM_topHeader>li>a.selectedCountry {
    color: white !important;
    text-decoration: none;
    background-color: #840909 !important;
}

.CMI-Product-Name>img:hover{
    //background-color: teal !important;
}

.CMI-Catalogue-hover:hover{
background-color: #dce1e1;

} 
#sessExpirDiv {
      border-color: #FEC539;
      border-style: solid;
      background-color: #FFEFC7;
      color: #000000;
      font-family: 'Proxima Nova Semibold', Arial;
      margin: 0px;
      font-size: 18px;
      line-height: 18px;
      position: fixed;
      width: 100%;
      height: 54px;
      text-align: left;
      z-index: -999999;
      top: 0;
      left: 0;
      padding-left:10px;
      opacity: 0;
      -webkit-transition: all 1s ease;
      transition: all 1s ease;
      margin-top: 100px;  /* added for Mar-742 */
    }
    #sessExpirP {
      margin-top: 16px;
      padding: 0px;
    }       

    .OSM_topHeader>ul>a>img.logoa 
    {
        display: none; <!-- IF "display: block" then Checkbox Image is showing but it is STATIC -->
    }
    
    .OSM_topHeader>ul>li>a:hover>img.logoa 
    {
        display: block; <!-- IF "display: none" then Checkbox Image  is not showing -->
    }
    li>a:hover>img.logoc
    {display: block;}
    li>a>img.logoc
    {display: none;}
    
    li>a:hover>i.checkicon
    {display: block;}
    li>a>i.checkicon
    {display: none;}
    
    .DisplayClass li
    {
        display: none;  
    }
    .countryDrop{
    
    padding: 5px;
    }
    .countryDrop img {
        width: 20px;
    }
    .countryDrop > a > img {
        margin-top: 5px;
    }
    .countryDrop > ul > li {
    margin-bottom: 5px;
}
    .countryDrop > ul > li:last-child {
    margin-bottom: 0px;
}
    .countryDrop > ul > li > a { 
        width: 100%;
        
     padding: 3px 5px 3px 10px;
    transition: all 0.4s;
    position: relative;
    min-height: 26px;
    }
    .countryDrop > ul > li > a > i {
        padding: 0 6px 0 4px;
    opacity: 0;
    position: absolute;
    left: 4px;
    transition: all 0.4s;
    top: 6px;
    }
    .countryDrop > ul > li > a:hover, .countryDrop > ul > li > a.selectedCountry { 
        padding: 1px 5px 3px 30px;
    }
    .countryDrop > ul > li > a:hover > i, .countryDrop > ul > li > a.selectedCountry > i { 
        opacity: 1;
    }
    
    <!-- For Modal PopUp -->
        
        
        /* The Modal (background) */
        .modalstore {
          display: none; /* Hidden by default */
          position: fixed; /* Stay in place */
          z-index: 1; /* Sit on top */
          padding-top: 100px; /* Location of the box */
          left: 0;
          top: 0;
          width: 100%; /* Full width */
          height: 100%; /* Full height */
          overflow: auto; /* Enable scroll if needed */
          background-color: rgb(0,0,0); /* Fallback color */
          background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
    /* Modal Content */
        .storemodal-content {
          position: relative;
          background-color: #fefefe;
          margin: auto;
          padding: 0;
          border: 1px solid #888;
          width: 41%;
          box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
          
        }
    /* The Close Button */
        .storeclose {
          color: balck;
          float: right;
          font-size: 2px;
          font-weight: bold;
        }
        .storeclose:hover,
        .storeclose:focus {
          color: #000;
          text-decoration: none;
          cursor: pointer;
        }
   
        .modalstore-header {
          padding: 10px 16px;
          background-color: Black;
          color: white;
        }
        
        .modalstore-body {padding: 2px 16px;}
        
        .modalstore-footer {
          padding: 12px 16px;
          background-color: white;
          color: white;
        }
     /* The Yes Button */
        .yes {
          color: Black;
        
          padding: 12px 16px;
        }
     <!-- Code Ended For Modal PopUp -->
        
</style>

<!--Below Code Added BY Dhiraj -->
    <script type="text/javascript">
        
        var nav = $('#nav');
            var selection = $('.select');
            //var select = selection.find('li');

            nav.click(function(event) 
            {
                if (nav.hasClass('active')) 
                {
                    nav.removeClass('active');
                    selection.stop().slideUp(200);
                } 
                else 
                {
                    nav.addClass('active');
                    selection.stop().slideDown(200);
                }
                event.preventDefault();
            });
        
        
        //var usFlag = '{!$Resource.Flag_US}';
        var storelocationflag;
        var countryflag;
        var u;
        storelocationflag = localStorage.getItem('storelocationflagKey'); 
        //alert('storelocationflag ' + storelocationflag);
        
        if(storelocationflag == null)
        {
            countryflag = 'us';
            //alert('inside IF');
        }
        else
        {
            countryflag = storelocationflag;
            //alert('inside IF ELSE');
        }
        //alert('countryflag++++' + countryflag); 

        function getRemoteContact() 
        {
            var location = 'us';
            
            Visualforce.remoting.Manager.invokeAction
            (
                //Invoking controller action getcon
                '{!$RemoteAction.OSM_SW_Header_Ctrl.goToUSStore}',location,
                
                function(result, event)
                {
                   //We can access the records through the parameter result 
                   if(event.status)
                   {    
                       //window.location.href = '/{!$Label.OSMStoreName}/?store=US' + '&Language=EN'; 
                       if(CCRZ.pagevars.portalUserId !='' && "{!$User.Id}" != CCRZ.pagevars.portalUserId)
                       {
                           window.location.href= '/apex/ccrz__HomePage?store=US&Language=EN?cartId='+CCRZ.pagevars.currentCartID+getCSRQueryString();
                           //window.location.href= "{!$Page.ccrz__HomePage}?store=US'+'&Language=EN'+cartId="+CCRZ.pagevars.currentCartID+getCSRQueryString();
                           //window.location.href= "{!$Page.ccrz__HomePage}?cartId="+CCRZ.pagevars.currentCartID+getCSRQueryString()+'&store=US'+'&Language=EN';
                           //window.location.href='/apex/ccrz__HomePage?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+view+getCSRQueryString() ;
                       }
                       else
                       {
                           window.location.href = '/{!$Label.OSMStoreName}/?store=CA' + '&Language=EN';  
                       }
                   }               
                },
                {escape: true}
            );
        }
     
        function getRemoteContactCA() 
            {
               var location = 'canada';
                
                Visualforce.remoting.Manager.invokeAction
                (
                    //Invoking controller action getcon
                    '{!$RemoteAction.OSM_SW_Header_Ctrl.goToUSStore}',location,
                    
                    function(result, event)
                    {
                       //We can access the records through the parameter result 
                       if(event.status)
                       {  
                           //window.location.href = '/{!$Label.OSMStoreName}/?store=CA' + '&Language=EN';  
                           if(CCRZ.pagevars.portalUserId !='' && "{!$User.Id}" != CCRZ.pagevars.portalUserId)
                           {
                               window.location.href= '/apex/ccrz__HomePage?store=CA&Language=EN?cartId='+CCRZ.pagevars.currentCartID+getCSRQueryString();
                               //window.location.href= "{!$Page.ccrz__HomePage}?store=CA'+'&Language=EN'+cartId="+CCRZ.pagevars.currentCartID+getCSRQueryString();
                               //window.location.href= "{!$Page.ccrz__HomePage}?cartId="+CCRZ.pagevars.currentCartID+getCSRQueryString();
                               //window.location.href='/apex/ccrz__HomePage?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+view+getCSRQueryString() ;
                           }    
                           else
                           {  
                               window.location.href = '/{!$Label.OSMStoreName}/?store=CA' + '&Language=EN'; 
                           }  
                       }               
                    },
                    {escape: true}
                );
            }
    </script>
    
<!--Code Ended --> 
    
  
    <!--  Trigger/Open The Modal -->
        
        <!-- The Modal -->
        <div id="myModal" class="modalstore" tabindex="-1" role="dialog" >
        
          <!-- Modal content -->
              <div class="storemodal-content cc_modal_content" style="border-radius:1px;border:1px black;">
                     
          <!-- Modal HEADER -->        
                <div class="modalstore-header" style="color: #fff;background-color: black;border-color: black;">
                    <span class="close">&times;</span>
                  <h4 class="modal-title">Global Store</h4>
                </div>
           <!-- Modal BODY -->
                <div class="modalstore-body modalstore-body">
                    <h4 class="modal-title">You are currently in Canada store and will be redirected to United States store. </h4> 
                    <h4 class="modal-title">Are you sure you want to proceed ?</h4>
                </div>
           <!-- Modal FOOTER -->       
                <div class="modal-footer" >
                  <button id="myyesBtn" type="button" class="btn btn-default CMI-DA-Packages" style="float:left;" onclick="getRemoteContact()">Yes</button>
                  <button id="nobtn" type="button" class="closeModal btn btn-default cc_add_coupon" style="background-color: #0f4f77;" onclick="document.getElementById('myModal').style.display='none'">No</button>
                </div>
              </div>
         </div>
 
    
    <!-- Trigger/Open The Modal -->
        
        <!-- The Modal modalstore -->
        <div id="myModalCA" class="modalstore" tabindex="-1" role="dialog" >
        
          <!-- Modal content -->
              <div class="storemodal-content cc_modal_content" style="border-radius:1px;border:1px black;">
                  
          <!-- Modal HEADER -->        
                <div class="modalstore-header" style="color: #fff;background-color: black;border-color: black;">
                    <span class="storeclose">&times;</span>
                  <h4 class="modal-title">Global Store</h4>
                </div>
           <!-- Modal BODY -->
                <div lass="modal-body">
                    <h4 class="modal-title cc_cancel_prompt">&nbsp;&nbsp;&nbsp;&nbsp;You are currently in United States store and will be redirected to Canada store. </h4> 
                    <h4 class="modal-title cc_cancel_prompt">&nbsp;&nbsp;&nbsp;&nbsp;Are you sure you want to proceed ?</h4>
                </div>
           <!-- Modal FOOTER -->       
                <div class="modal-footer" >
                  <button id="myyesBtnCA" type="button" class="btn btn-default CMI-DA-Packages" style="float:left;" onclick="getRemoteContactCA()">Yes</button>
                  <button id="nobtnCA" type="button" class="closeModal btn btn-default cc_add_coupon" style="background-color: #0f4f77;" onclick="document.getElementById('myModalCA').style.display='none'">No</button>
                </div>
              </div>
         </div>
    
<script type="text/javascript">
 function sessionExpiration(idleMinInput, warningMinInput, logoutUrl, serverRefresh = 'none') {
   
  var t;
  var activeTime;
  var oldActiveTime; /* Only used if serverRefresh URL is provided. */
  var serverInterval = 3600; /* Seconds. If serverRefresh URL is provided, at what interval to you want to contact server? */
  var warningCountdown;
  var sessExpirDiv = document.getElementById('sessExpirDiv');
  window.onload = resetTimer; /* Window is refreshed. */
  window.onmousemove = resetTimer; /* Mouse is moved. */
  window.onkeypress = resetTimer; /* Key is pressed. */
  window.onmousedown = resetTimer; /* Touchscreen is pressed. */
  window.onclick = resetTimer; /* Touchpad clicks. */
  window.onscroll = resetTimer; /* Scrolling with arrow keys. */
  if(serverRefresh !== 'none') {
    refreshServer();
  }
  function warning(idleSeconds, warningSeconds) {
    bannerDisplay = setTimeout(function(){
      sessExpirDiv.style.display = 'inline-block';
    }, 100); /* In Firefox opacity isn't taken into account before the page and div load. Without this the banner would flicker upon page load. */
    warningStart = setTimeout(function(){
      sessExpirDiv.style.opacity = '1';
      sessExpirDiv.style.zIndex = '999999';
    }, 1100); /* Wtihout this, warning div would appear before the text. */
    remaining = idleSeconds - warningSeconds;
    warningCountdown = setInterval(function() { /* Update every 1 second. */
      if(remaining <= 0) {
        /* Now we check that no other tab has been active after us. */
        var browserActive = localStorage.getItem('activeTime');
        if(activeTime != browserActive) { /* Then another tab has been active more recently than this tab. */
          // alert("Not the same. User has been active in another tab. browserActive: " + browserActive + " and activeTime: " + activeTime);
          /* We want to keep going, because user might close the other tab - and if this script is broken, the sessionExpiration is broken. */
          sessionExpiration(idleMinInput, warningMinInput, logoutUrl);
        } else {
          // alert("The same. User has not been active in another tab. browserActive: " + browserActive + " and activeTime: " + activeTime);
          logout();
        }
      } else {
        remaining -= 1;
        var remSec = parseInt(remaining%60);
        var temp = remaining - remSec;
        var remMin = parseInt(temp/60);
        document.getElementById('sessExpirDiv').innerHTML =
        '<p id="sessExpirP"><span style="color:#FEC539;">&#9432;</span> Your session will close due to inactivity in <B>' + remMin+':'+remSec + '</B>. Click here to continue or sign out now.</p>';
      }
    }, 1000);
  }
  function recordTime() {
    activeTime = Date.now(); /* Milliseconds since 1970/01/01. */
    localStorage.setItem('activeTime', activeTime);
  }
  function clearEverything() {
    clearTimeout(t);
    clearInterval(warningCountdown);
    clearWarning();
  }
  function clearWarning() {
    sessExpirDiv.style.opacity = '0';
    sessExpirDiv.innerHTML = ' ';
    sessExpirDiv.style.zIndex = '-999999';
  }
  function logout() {
    //window.location.href =logoutUrl;
  }
  function resetTimer() {
    clearEverything();
    recordTime(); /* Records across all tabs in browser. */
    var idleMinutes = idleMinInput; /* After how long idle time do we log out user? */
    var warningMinutes = warningMinInput; /* After how long idle time do we start the warning countdown? */
    var idleSeconds = parseInt(idleMinutes * 60);
    var warningSeconds = parseInt(warningMinutes * 60);
    var wMilliSeconds = warningSeconds * 1000;
    /* When user has been idle warningSeconds number of seconds, we display warning and countdown. */
    t = setTimeout(function(){ warning(idleSeconds, warningSeconds); }, wMilliSeconds);
   }
  /* Optional. This is used only if you have a server end session timer too, and provide the URL serverRefresh. */
  function refreshServer() {
    setInterval(function() {
      if(activeTime !== oldActiveTime) { /* Then user has been active in the last 50 seconds. */
        var xhr = new XMLHttpRequest();
        xhr.open('GET', serverRefresh);
        xhr.send(null);
        oldActiveTime = activeTime;
      }
    }, serverInterval * 1000);
  }
};
 </script> 
    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id={!googeAnalyticId}{!googleAdditionalSrc}"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<!-- Components of Header -->
<c:OSM_SW_EffectiveAccountModal />
<c:OSM_SW_AccountPermissionMatrix />
 <!-- END Components of Header   -->

    
   <script>
    document.title = '{!$Label.BrowserTabTitle}' ;
    
    jQuery(function($){
             CCRZ.subsc = CCRZ.subsc||{};
                    //CCRZ.rfq= CCRZ.rfq||{};
                     
                    CCRZ.views.DefCartItem = CCRZ.CloudCrazeView.extend({
                    viewName :'DefCartItem',
                    className : "OSM_SW_Header_Ctrl",
                    templateDesktop : CCRZ.util.template('CMI_DefCartItem'),
                    templatePhone : CCRZ.util.template('CMI_DefCartItem'),
                    firstRender : false,
                    //partials: {rfqModal: '#rfqModalTemplate'},
                    init : function(){
                            console.log("init function on header");
                         this.invokeContainerLoadingCtx($('body'),"invalidateCartItem",
                        function(response){
                            alert(CCRZ.pagevars.currentCartID);
                        if(response && response.success){ alert(CCRZ.pagevars.currentCartID);}
                        
                        console.log("init function on header2");
                        },{buffer:false,escape:false,nmsp:false} );          
                    }
                    });
        });
    </script>
 <div id="sessExpirDiv">
  </div>
  <script id="SW_HeaderDesktop" type="text/template">
    
    
  <div class="navbar-inverse cc_navbar-inverse">
       <div class="container cc_container">
    <div class="row cc_navbar_row">
     <small>
          <!-- <div class="col-md-5 col-sm-4 cc_navbar_col_misc">
           <p class="header-spacer visible-md-* cc_header_spacer"></p>

          </div> -->
      <div class="col-md-12 col-sm-12 cc_navbar_col_acct">
         
       <div class="navbar-header pull-right cc_navbar-header">


  
                      

            
        <ul class="list-inline navbar-nav cc_list-inline">
            <li  style="margin-top:5px">        
                <!-- <p class="header-spacer visible-md-* cc_header_spacer"></p> -->
                <!-- {{#ifEquals '{!$Profile.Name}' 'IAM_Distributor_Admin_Platform'}}  -->
                {{#if {!showEffectiveAccount}}}
                <span class="misc-function cc_misc_function" id="effectiveAccount_misc_function"/>
                {{/if}}
                <!-- {{/ifEquals}} -->
                <span class="lssec cc_lssec"></span>
                <span class="CMI-customer-business"></span> 
           </li>
                 
           <!--Below Code Added BY Dhiraj -->        
   
      <li class="{!IF(CONTAINS($Label.OSM_Store, 'true'),'dropdown CMI-other-cummins OSM_topHeader countryDrop','DisplayClass')}">
            {{#if {!$Label.OSM_Store}}}
           <a href="{{linkURL}}" class="dropdown-toggle cc_dropdown_toggle cc_OtherSites" data-toggle="dropdown" 
     data-menuid="{{menuId}}" {{linkTarget openInNewWindow}} role="button" aria-haspopup="true" aria-expanded="false">
    <!--<span class="CMI-Icons CMI-global-nav-icon-margins">6</span>-->
                
               
               <image src="{!IF(CONTAINS(storelocationflag, 'canada'),$Resource.Flag_CA, $Resource.Flag_US)}"
        class="CMI-Icons CMI-global-nav-icon-margins" length= "1px" width="1px" align = "left"></image>
                
               <span class="CMI-Sites"> {!IF(CONTAINS(storelocationflag, 'canada'),'Canada', 'US')} <span class="caret"></span></span>
             
            </a>
                {{/if}}
            <ul id='myid' class="dropdown-menu cc_dropdown-menu OSM_topHeader" >
                  <li id='1' data-value="en">
                      <a href="#" id="myBtn" data-toggle="modal" class="{!IF(CONTAINS(storelocationflag, 'us'),'','')}" onclick="{!IF(CONTAINS(storelocationflag, 'us'),'',"document.getElementById('myModal').style.display='block'")}"> 
                        <i class="fa fa-check"  align = "left" ></i> 
                        <image src="{!$Resource.Flag_US}" class="CMI-global-nav-icon-margins"></image> 
                        <span>{{pageLabelMap 'US'}}</span>
                      </a> 
                  </li>
                        
                  <li id='2' data-value="de" > 
                       <a href="#" id="goToCAStoreLocation" class="{!IF(CONTAINS(storelocationflag, 'canada'),'','')}"  onclick="{!IF(CONTAINS(storelocationflag, 'canada'),'',"document.getElementById('myModalCA').style.display='block'")}")}">  
                        <i class="fa fa-check"  align = "left" ></i> 
                        <image src="{!$Resource.Flag_CA}" class="CMI-global-nav-icon-margins"></image> 
                        <span>{{pageLabelMap 'Canada'}}</span>
                       </a>
                        
                        
                  </li> 
            </ul>
          </li>
                       
                        
                        
          <!--Code Ended -->      
            
           <li id="logoutSecOnlyId"  class="cc_customer " ><a href="{!loginUrl}"><span class="CMI-Icons CMI-global-nav-icon-margins">U</span>{{pageLabelMap 'Header_Login'}}</a></li><!-- loginoutsec cc_loginoutsec -->
            <li id="userMyAccountSecId" class="dropdown cc_my_account hide_on_guest ">
                <a href="#" id="goToUser" ></a><span class="caret"></span>
                <ul class="dropdown-menu cc_dropdown-menu OSM_topHeader">
                    
                    <li>
                        <a href="#" id="goToUser" onclick="return fetchMyAccount();" style="text-transform: none;"  class="CMI-UserDropDown">{{pageLabelMap 'Header_MyAccount'}}</a>
                    </li>
                    <!--
                    <li>
                        <a href="#" id="goToUser" onclick="changePassword()" style="text-transform: none;" class="CMI-UserDropDown">{{pageLabelMap 'Header_ChangePassword'}}</a>
                    </li>
                    -->
                    <li>
                        <a href="#" id="goToUser" onclick="goToMyAccount('myAddressBook')" style="text-transform: none;" class="CMI-UserDropDown">{{pageLabelMap 'Header_Manage_Address_Book'}}</a>
                    </li>
                    <li>
                        <a href="#" onclick="goToMyAccount('myOrders')" style="text-transform: none;" class="CMI-UserDropDown">{{pageLabelMap 'Header_MyOrder'}}</a>
                    </li>
                    <li>
                        <a href="#"  onclick="goToMyAccount('mySubscriptionsNew')" style="text-transform: none;" class="CMI-UserDropDown">{{pageLabelMap 'Header_MySubscriptions'}}</a>
                    </li>
                    <li>
                        <a href="#"  onclick="goToMyAccount('myInvoices')" style="text-transform: none;" class="CMI-UserDropDown">{{pageLabelMap 'Header_MyInvoices'}}</a>
                    </li>
                    <!-- MAR-300 Code Start-->
                    <li>
                        <a href="{!$Label.OSM_TnC_Footer_VFPage_Link}#exactline" style="text-transform: none;" class="CMI-UserDropDown" target="_blank">{{pageLabelMap 'Cancellation_Reorder_Policy'}}</a>
                    </li>
                    <!-- MAR-300 Code End -->
                    <li id="logoutInDropDown" style="text-transform: none;" class="CMI-UserDropDown"><a href="#"></a></li><!-- Header_Logout -->
                </ul>
            </li>
            <!-- Added by Swetha mp-777-->
              <li class="dropdown CMI-other-cummins OSM_topHeader">
              <a href="{{linkURL}}" class="dropdown-toggle cc_dropdown_toggle" data-toggle="dropdown" data-menuid="{{menuId}}" {{linkTarget openInNewWindow}} role="button" aria-haspopup="true" aria-expanded="false"><span class="CMI-Icons CMI-global-nav-icon-margins">8</span><span class="CMI-Contact Us">Contact US<span class="caret"></span></span></a>
              <ul class="dropdown-menu cc_dropdown-menu OSM_topHeader">
                  <li><a href="#" onclick="contactUSPage()" style="text-transform: none;" class="CMI-UserDropDown">{{pageLabelMap 'Header_Contact US'}}</a></li>
                 <li><a href={{pageLabelMap 'Header_CustomerAssist'}} target="_blank" id="customer">{{pageLabelMap 'Header_customerassistance'}}</a></li> 
          </ul>
          </li>        
            <!-- ended by Swetha mp-777-->
         <!-- Start : Juhi Changes : Making Support link open in another tab --> 
      <!-- swetha <li class="cc_customer "><a href={{pageLabelMap 'Header_CustomerAssist'}} target="_blank" id="customer"><span class="CMI-Icons CMI-global-nav-icon-margins" style="padding: 2px">8</span><span class="CMI-Support">{{pageLabelMap 'Header_Support'}}</span></a></li> -->
           <!-- End : Juhi Changes : Making Support link open in another tab -->  
           <!-- <li class="cc_language"><a href="#" id="language"><span class="CMI-Icons CMI-global-nav-icon-margins">7</span> <span class="CMI-Language">Languages </span></a></li> -->
          <li class="dropdown CMI-other-cummins OSM_topHeader">
              <a href="{{linkURL}}" class="dropdown-toggle cc_dropdown_toggle cc_OtherSites" data-toggle="dropdown" data-menuid="{{menuId}}" {{linkTarget openInNewWindow}} role="button" aria-haspopup="true" aria-expanded="false"><span class="CMI-Icons CMI-global-nav-icon-margins">6</span><span class="CMI-Sites">{{pageLabelMap 'Header_OtherCumminsSites'}}<span class="caret"></span></span></a>
              <ul class="dropdown-menu cc_dropdown-menu OSM_topHeader">
                  <li><a href={{pageLabelMap 'Header_CumminsComUrl'}} target="_blank">{{pageLabelMap 'Header_CumminsCom'}}</a></li>
                  <li><a href={{pageLabelMap 'Header_CustomerLoginPage'}} target="_blank">{{pageLabelMap 'Header_ConnectedSolutions'}}</a></li>
                  <li><a href={{pageLabelMap 'Header_QuickService'}} target="_blank">{{pageLabelMap 'Header_QuickServeOnline'}}</a></li>
                  <li><a href={{pageLabelMap 'Header_CumminsSupport'}} target="_blank">{{pageLabelMap 'Header_ServiceToolsSupport'}}</a></li>
                  
              </ul>
          </li>        
                
                 <li class="cc_my_chead hide_on_guest" style="display:inline-block;">
                      <a href="#" id="cartHeader" class="chead cartHeaderLink"><span class="CMI-Icons CMI-global-nav-icon-margins">9</span></a></li>
               
        </ul>
       </div>
    <!--  <div class="pull-right cc_col_search">
       <ul class="nav cc_nav">
        <li><div class="search_form cc_search_form" /></li>
       </ul>
      </div> -->
     </small>
    </div>
   </div>
  </div>
  <a href="#" id="logoUrl"><div id="cc_store_logo_img" class="cc_store_logo_img center-block"></div></a>
 </script>
 
    <script type="text/javascript">
            var nav = $('#nav');
            var selection = $('.select');
            var select = selection.find('li');

            nav.click(function(event) 
            {
                if (nav.hasClass('active')) 
                {
                    nav.removeClass('active');
                    selection.stop().slideUp(200);
                } 
                else 
                {
                    nav.addClass('active');
                    selection.stop().slideDown(200);
                }
                event.preventDefault();
            });

            select.click(function(event) 
            {
                // updated code to select the current language
                select.removeClass('active');
                $(this).addClass('active');

                 
            });
        </script>
    
    
    
    <script id="CartHeaderBrowser" type="text/template">
 
</script>
    
    <script id="menu-desktop-template" type="text/template">
  <div id="secnav cc_secnav" >
   <nav class="navbar navbar-default navbar-static-top CMI-navbar" id="mast-bkground-clr">
    <div class="container cc_container">
      <div class="CMI-Logo">
         <a href="#" id="goToHome" onclick="return goToHomePage();"><image src="{!$Resource.Cumminslogo}" length= "42" width="42" align = "left" id="logo"></image></a>
         <a href="#" id="goToHome" onclick="return goToHomePage();" style="text-decoration:none;"><span class="SiteId">{{pageLabelMap 'Header_Marketplace'}}</span></a>
    </div>       
      <div class = "CMI-Main-Menu">
         <div class="navbar-header CMI-navbar-header">
            <button type="button" class="navbar-toggle collapsed CMI-navbartoggle" data-toggle="collapse" data-target="#navbar"
              aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">{{pageLabelMap 'Menu_ToggleNavigation'}}</span>
                <!--***********-->
                <span class="icon-bar cc_icon-bar"></span>
                <span class="icon-bar cc_icon-bar"></span>
                <span class="icon-bar cc_icon-bar"></span>
            </button>
         </div>
         <div id="navbar" class="navbar-collapse collapse CMI-navbar-collapse"> 
            <ul class="nav navbar-nav CMI-navbar-nav">
                <li><a href="#" id="phoneLogo" class="cc_phone_logo" style="display:none"><span class="sr-only">{{pageLabelMap 'Menu_Home'}}</span></a></li>
                  {{#each .}}
                  {{#if children}}
                <li class="dropdown cc_dropdown">
                    <a href="{{linkURL}}" class="dropdown-toggle cc_dropdown_toggle" data-toggle="dropdown" data-menuid="{{menuId}}" {{linkTarget openInNewWindow}} role="button" aria-haspopup="true" aria-expanded="false">{{displayName}}<span class="caret"></span></a>
                    <ul class="dropdown-menu cc_dropdown-menu">
                        {{> subMenuItem}}
                    </ul>
                </li>
                
                    {{else}}
                    {{#ifEquals mType 'Category'}}
                <li class="dropdown cc_dropdown" >{{categoryLink this 'cc_category' text=displayName}}</li>
                    {{/ifEquals}}
                    {{#ifEquals mType 'Product'}}
                <li class="dropdown cc_dropdown">{{productLink this 'cc_product' text=displayName}}</li>
                    {{/ifEquals}}
                    {{#ifEquals mType 'URL'}}
                <li class="dropdown cc_dropdown"><a class="menuTypeURL cc_menu_type_url" href="javascript:void(0);" data-href="{{linkURL}}" data-menuid="{{menuId}}" {{linkTarget openInNewWindow}}>{{displayName}}</a></li>
                    {{/ifEquals}}
                    {{#ifEquals mType 'None'}}
                <li class="dropdown cc_dropdown"><a href="javascript:void(0);" class="cc_display_name" style="display:none" data-menuid="{{menuId}}">{{displayName}}</a></li>
                    {{/ifEquals}}
                    {{/if}}
                    {{/each}}
                     <!--**********-->
          <li>  <div class="navbar-form cc_navbar_form" role="search">
             <div class="input-group cc_input-group" id="block1" style="display: none;">
              <input id="searchText" type="text" class="form-control search_input cc_search_input" placeholder="{{pageLabelMap 'ProductSearch'}}" title="{{pageLabelMap 'ProductSearch_Tooltip'}}" data-trigger="focus" autocomplete="on">                  
              <button id="searchDefault" class="btn btn-default search_button" onclick="showonlyone('block2');"></button>      
              <span class="input-group-btn">
               <button id="doSearch" class="btn btn-default search_button" type="Submit"><span class="CMI-Icons" style="margin-top: -10px">S</span></button>
              </span>
             </div>
      <!-- <div class="input-group cc_input-group" id="block2">
                 <a href="javascript:showonlyone('block1');" id="searchBox">
                    <span class="CMI-Icons">S</span>
                    <label>{{pageLabelMap 'Search'}}/label>
                 </a>
             </div> -->
            <span id="cc_search_error" data-trigger="manual" data-placement="bottom" data-content="{{pageLabelMap 'ProductSearch_Tooltip'}}"></span>
            <div class="searchTopBarErrorMessage searchBoxWidgetError" ></div>
               
                     </div></li> 
            </ul>
            </div>
            
     
            
     </div>
     
    </div>
   </nav>
 </div>  
                     </script>
   
<script id="SW_menu-desktop-template" type="text/template">
  <div id="secnav cc_secnav" >
   <nav class="navbar navbar-default navbar-static-top CMI-navbar " style="z-index:10" id="mast-bkground-clr">
    <div class="container cc_container">
      <div  class="CMI-Logo">
         <a href="#" id="goToHome" onclick="return goToHomePage();"><image src="{!$Resource.Cumminslogo}" length= "42" width="42" align = "left" id="logo"></image></a>
      <a href="#" id="goToHome" onclick="return goToHomePage();" style="text-decoration:none;"><span class="SiteId" >Marketplace</span></a>
    </div>       
      <div class = "CMI-Main-Menu">
         <div class="navbar-header CMI-navbar-header">
            <button type="button" class="navbar-toggle collapsed CMI-navbartoggle" data-toggle="collapse" data-target="#navbar"
              aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <!--***********-->
                <span class="icon-bar cc_icon-bar"></span>
                <span class="icon-bar cc_icon-bar"></span>
                <span class="icon-bar cc_icon-bar"></span>
            </button>
         </div>
         <div id="navbar" class="navbar-collapse collapse CMI-navbar-collapse"> 
            <ul class="nav navbar-nav CMI-navbar-nav">
                <li><a href="#" id="phoneLogo" class="cc_phone_logo" style="display:none"><span class="sr-only">Home</span></a></li>
                  {{#each .}}
                  {{#if children}}
                <li class="dropdown cc_dropdown">
                    <a href="{{linkURL}}" class="dropdown-toggle cc_dropdown_toggle" data-toggle="dropdown" data-menuid="{{menuId}}" {{linkTarget openInNewWindow}} role="button" aria-haspopup="true" aria-expanded="false">{{displayName}}<span class="caret"></span></a>
                    <ul class="dropdown-menu cc_dropdown-menu">
                        {{> subMenuItem}}
                    </ul>
                </li>
                
                    {{else}}
                    {{#ifEquals mType 'Category'}}
                <li class="dropdown cc_dropdown Cate_{{linkURL}}">{{categoryLink this 'cc_category' text=displayName}}</li>
                    {{/ifEquals}}
                    
                    {{#ifEquals mType 'Product'}}
                <li class="dropdown cc_dropdown Cate_{{linkURL}}">{{productLink this 'cc_product' text=displayName}}</li>
                    {{/ifEquals}}
                    {{#ifEquals mType 'URL'}}
                <li class="dropdown cc_dropdown Cate_{{linkURL}}"><a class="menuTypeURL cc_menu_type_url" href="javascript:void(0);" data-href="{{linkURL}}" data-menuid="{{menuId}}" {{linkTarget openInNewWindow}}>{{displayName}}</a></li>
                    {{/ifEquals}}
                    {{#ifEquals mType 'None'}}
                <li class="dropdown cc_dropdown Cate_{{linkURL}}"><a href="javascript:void(0);" class="cc_display_name" style="display:none" data-menuid="{{menuId}}">{{displayName}}</a></li>
                    {{/ifEquals}}
                    {{/if}}
                    {{/each}}
                     <!--for search-->
            <!--        <li>  <div class="navbar-form cc_navbar_form" role="search" >
             <div class="input-group cc_input-group" id="block1" style="display: none; ">
              <input id="searchText" type="text" class="form-control search_input cc_search_input" placeholder="{{pageLabelMap 'ProductSearch'}}" title="{{pageLabelMap 'ProductSearch_Tooltip'}}" data-trigger="focus" autocomplete="on">                  
              <button id="searchDefault" class="btn btn-default search_button" onclick="showonlyone('block2');"></button>      
              <span class="input-group-btn">
               <button id="doSearch" class="btn btn-default search_button" type="Submit"><span class="CMI-Icons">S</span></button>
              </span>
             </div>
             <div class="input-group cc_input-group" id="block2" style="display: block; margin-top: -6px;" >
                 <a href="javascript:showonlyone('block1');" id="searchBox" >
                    <span class="CMI-Icons">S</span>
                    <label style="padding-top: 4px;">Search</label>
                 </a>
             </div>
            <span id="cc_search_error" data-trigger="manual" data-placement="bottom" data-content="{{pageLabelMap 'ProductSearch_Tooltip'}}"></span>
            <div class="searchTopBarErrorMessage searchBoxWidgetError" ></div>
                <!--End of search-->
                     </div><!--***************--></li> 
            </ul>
            </div>
            
     </div>
     
    </div>
   </nav>
 </div>   
          
 </script>
    
    <script id="SW_CartHeaderBrowser" type="text/template">  
    <span class="CMI-Icons CMI-global-nav-icon-margins" style="padding: 2px">9</span>   
    <span>     
        {{#compare this.cartCount '<=' 1 }}
    {{price this.cartTotal}} &#160;({{this.cartCount}} {{pageLabelMap 'Component_MiniCart_Item'}})
      {{else}}
      {{price this.cartTotal}} &#160;({{this.cartCount}} {{pageLabelMap 'Component_MiniCart_Items'}})
      {{/compare}}  
    </span>  
    </script>

      <script id="HeaderDesktop" type="text/template">
  <div class="navbar-inverse cc_navbar-inverse">
       <div class="container cc_container">
    <div class="row cc_navbar_row">
     <small>
          <div class="col-md-2 cc_navbar_col_misc">
           <p class="header-spacer visible-md-* cc_header_spacer"></p>
           <div class="navbar-header pull-left cc_navbar-header">
            <span class="misc-function cc_misc_function" />
            <span class="lssec cc_lssec"></span>
              <span class="CMI-customer-business"></span>   
           </div>
          </div>
      <div class=" col-md-10 cc_navbar_col_acct">
         
       <div class="navbar-header pull-right cc_navbar-header">
        <ul class="list-inline navbar-nav cc_list-inline">
        <li class="loginoutsec cc_loginoutsec" ><a href="#" class="goToLogin1 cc_goto_login" onclick="return doLogin();"><span class="CMI-Icons CMI-global-nav-icon-margins" style="padding: 2px">U</span>&#160;{{pageLabelMap 'Component_SiteHeader_Login'}}</a></li>
         <li class="cc_customer "><a href="https://www.cummins.com/customer-assistance" id="customer"><span class="CMI-Icons CMI-global-nav-icon-margins" style="padding: 2px">8</span>Support</a></li>      
         <!--<li class="cc_language"><a href="#" id="language"><span class="CMI-Icons CMI-global-nav-icon-margins" style="padding: 2px"> 7 </span> Languages</a></li>-->
          <li class="dropdown CMI-other-cummins OSM_topHeader">
              <a href="{{linkURL}}" class="dropdown-toggle cc_dropdown_toggle" data-toggle="dropdown" data-menuid="{{menuId}}" {{linkTarget openInNewWindow}} role="button" aria-haspopup="true" aria-expanded="false"><span class="CMI-Icons CMI-global-nav-icon-margins">6</span>Other Cummins Sites<span class="caret"></span></a>
              <ul class="dropdown-menu cc_dropdown-menu OSM_topHeader">
                  <li><a href="https://quickserve.cummins.com/info/index.html" target="_blank">{{pageLabelMap 'Header_QSOL'}}</a></li>
                  <li><a href=" https://www.cummins.com/support/electronic-service-tools-support" target="_blank">{{pageLabelMap 'Header_ServiceToolsSupport'}}</a></li>
                  <li><a href={{pageLabelMap 'Header_OtherCumminsSites'}} target="_blank">{{pageLabelMap 'Header_GenuineParts'}}</a></li>
              </ul>
          </li>        
                
                
        </ul>
       </div>
      <div class="pull-right cc_col_search">
       <ul class="nav cc_nav">
        <li><div class="search_form cc_search_form" /></li>
       </ul>
      </div>
     </small>
    </div>
   </div>
  </div>
  <a href="#" id="logoUrl"><div id="cc_store_logo_img" class="cc_store_logo_img center-block"></div></a>
 </script>
    <script id="SW_Account-Desktop" type="text/template">
  {{#if this}}
   {{#ifEquals this.UserType 'Guest'}}
    <a href="#" class="goToLogin1 cc_goto_login" onclick="return doLogin();"><span class="CMI-Icons CMI-global-nav-icon-margins" style="padding: 2px;">U</span>&#160;{{pageLabelMap 'Component_SiteHeader_Login'}}</a>
   {{else}}
    <a href="#logout" class="doLogout cc_do_logout">&#160;{{pageLabelMap 'Component_SiteHeader_Logout'}}</a>
   {{/ifEquals}}
  {{else}}
   <a href="#" class="cc_login" onclick="return doLogin();"><span class="CMI-Icons CMI-global-nav-icon-margins" style="padding: 2px;">U</span>&#160;{{pageLabelMap 'Component_SiteHeader_Login'}}</a>
  {{/if}}
</script>
    
    <script type='text/javascript'>
    

    function loginTo()
    {
        
        var cartParam;
        if (CCRZ.pagevars.currentCartID){
            cartParam = CCRZ.pagevars.currentCartID;
        }
        else{
            cartParam = "";
        }
            var urlArgument = '';
            
            if(CCRZ.pagevars.currentPageURL.search("\\?refURL") >= 0)
                urlArgument = CCRZ.pagevars.currentPageURL.split("?refURL")[0];
            if(CCRZ.pagevars.currentPageURL.search("&refURL") >= 0)
                urlArgument = CCRZ.pagevars.currentPageURL.split("&refURL")[0];
        //alert("{!$Label.OSM_Login_Include_https}");
            //urlArgument = urlArgument.replace(/&/g,"|");
            if("{!$Label.OSM_Login_Include_https}" == 'true' && !urlArgument.includes('https://')){
                    urlArgument = 'https://'+urlArgument;
                }
                    
                if("{!$Label.OSM_Login_Include_https}" != 'true' && urlArgument.includes('https://')){
                        urlArgument = urlArgument.replace('https://','');                    
                    }
            window.location.href =  "{!$Label.OSM_Login_App_Url}" + "&retURL="+urlArgument;
                    
    }
   
    console.log('test');
     
   $(window).load(function() { 
     //insert all your ajax callback code here. 
     //Which will run only after page is fully loaded in background.
        console.log('test==>'+CCRZ.pagevars.remoteContext.queryParams.categoryId);
        if(CCRZ.pagevars.remoteContext.queryParams.categoryId != undefined){
                var toActive = ".Cate_"+CCRZ.pagevars.remoteContext.queryParams.categoryId;
            console.log('toActive==>'+toActive);
                $(toActive).css("background-color", "yellow");
            }
         });  
    
    $(document).ready(function() {
          
        if(CCRZ.pagevars.isGuest)
        {
            $("#logoutSecOnlyId").show();
            //$("#logoutSecOnlyId").addClass("loginoutsec");
            //$("#logoutSecOnlyId").addClass("cc_loginoutsec");
            
            $("#userMyAccountSecId").hide();
        }
        else
        {
            $("#logoutSecOnlyId").hide();
            $("#userMyAccountSecId").show();
           $("#logoutInDropDown").addClass("loginoutsec");
        }
        
    })
    function showonlyone(thechosenone) {
     $('.input-group').each(function(index) {
          if ($(this).attr("id") == thechosenone) {
               $(this).show(200);
          }
          else {
               $(this).hide(200);
          }
     });
    }
    //window.onload = carticon();
    
   function carticon()
    {
        
         var guestvar = {!Isguest};
        if(guestvar == true ){
            
            //document.getElementsByClassName('cc_my_chead').style.display = 'inline-block';
           
            }
       
    
    }
    
    
    function doLogin(){
        console.log('doLogin');
     if (CCRZ.pagevars.currentCartID){
      cartParam = CCRZ.pagevars.currentCartID;
     }else{
      cartParam = "";
     }
     //window.location.href = "/DefaultStore/ccrz__CCSiteLogin?cartID=" +cartParam+getCSRQueryString()+'&sku='+CCRZ.detailData.jsonProductData.product.prodBean.sku;
        //window.location.href =  "{!$Label.OSM_Login_App_Url}" + "&cartID=" +cartParam+getCSRQueryString();
        var url = "{!$Label.OSM_Login_App_Url}" + "&cartID=" +cartParam+getCSRQueryString();
        //window.location.href =  encodeURI(url)
    }
    
    function goToHomePage(){
        window.location.href= "{!$Page.ccrz__HomePage}?cartId="+CCRZ.pagevars.currentCartID+getCSRQueryString();
    //  var currentHost = window.location.protocol + "//" + window.location.host + "/";
    //  var pathName = "{!$Label.OSMStoreName}?store=";
    //  //var pathName = "DefaultStore?store=";
    //  var homePageUrl = currentHost + pathName+ CCRZ.pagevars.queryParams.store;
    //     //window.location.href = '/DefaultStore/ccrz__MyAccount?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+view+getCSRQueryString() ;
    //         if(CCRZ.pagevars.portalUserId !='' && "{!$User.Id}" != CCRZ.pagevars.portalUserId){
    //             pathName = "apex/ccrz__homepage?isCSRFlow="+CCRZ.pagevars.queryParams.isCSRFlow+'&portalUser='+CCRZ.pagevars.queryParams.portalUser+'&store='+CCRZ.pagevars.queryParams.store;//?isCSRFlow=true&portalUser=0054C0000016Lt4QAE&store=SoftwareStore
    //             homePageUrl = currentHost + pathName;//+ CCRZ.pagevars.queryParams;
    //             window.location.href=homePageUrl;
    //     }else{
    //             window.location.href=homePageUrl;
    //         }
    //     //window.location.href = homePageUrl;       
    }
    
    Handlebars.registerHelper('if_eq', function(a, b, opts) {
    if (a == b) {
        return opts.fn(this);
    } else {
        return opts.inverse(this);
    }
});
    
    Handlebars.registerHelper('compare', function (lvalue, operator, rvalue, options) {

    var operators, result;
    
    if (arguments.length < 3) {
        throw new Error("Handlerbars Helper 'compare' needs 2 parameters");
    }
    
    if (options === undefined) {
        options = rvalue;
        rvalue = operator;
        operator = "===";
    }
    
    operators = {
        '==': function (l, r) { return l == r; },
        '===': function (l, r) { return l === r; },
        '!=': function (l, r) { return l != r; },
        '!==': function (l, r) { return l !== r; },
        '<': function (l, r) { return l < r; },
        '>': function (l, r) { return l > r; },
        '<=': function (l, r) { return l <= r; },
        '>=': function (l, r) { return l >= r; },
        '&&': function (l, r) { return l && r; },
        'typeof': function (l, r) { return typeof l == r; }
    };
    
    if (!operators[operator]) {
        throw new Error("Handlerbars Helper 'compare' doesn't know the operator " + operator);
    }
    
    result = operators[operator](lvalue, rvalue);
    
    if (result) {
        return options.fn(this);
    } else {
        return options.inverse(this);
    }

});
    
    function goToMyAccount(view)
    {
        
        window.location.href = '/{!$Label.OSMStoreName}/ccrz__MyAccount?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+view+getCSRQueryString() ;
        //window.location.href = '/DefaultStore/ccrz__MyAccount?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+view+getCSRQueryString() ;
            if(CCRZ.pagevars.portalUserId !='' && "{!$User.Id}" != CCRZ.pagevars.portalUserId){
        window.location.href='/apex/ccrz__MyAccount?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+view+getCSRQueryString() ;
        }
        
    }
    //MP-778 Code Start
    function contactUSPage()
    {
        
            if(CCRZ.pagevars.portalUserId !='' && "{!$User.Id}" != CCRZ.pagevars.portalUserId){
                window.location.href='/apex/ccrz__CCPage?pagekey=contactUS';
            }else{
                window.location.href = '/{!$Label.OSMStoreName}/ccrz__CCPage?pagekey=contactUS';
            }
    }
    //MP-778 Code End
    function changePassword()
    {
        
        var cartParam;
        if (CCRZ.pagevars.currentCartID){
            cartParam = CCRZ.pagevars.currentCartID;
        }
        else{
            cartParam = "";
        }
              var urlArgument = '';
            
            if(CCRZ.pagevars.currentPageURL.search("\\?refURL") >= 0)
                urlArgument = CCRZ.pagevars.currentPageURL.split("?refURL")[0];
            if(CCRZ.pagevars.currentPageURL.search("&refURL") >= 0)
                urlArgument = CCRZ.pagevars.currentPageURL.split("&refURL")[0];

            //urlArgument = urlArgument.replace(/&/g,"|");
                
            window.location.href =  "{!$Label.OSM_SW_ChangPassword_App_Url}" + "&retURL="+urlArgument;          
            
                    
    }
    
    function fetchMyAccount(){
        //CCRZ.pagevars.remoteContext.portalUserId
        if (CCRZ.pagevars.linkOverrideMap['HeaderMyAccount']) {
             window.location.href = CCRZ.pagevars.linkOverrideMap['HeaderMyAccount'];
        } else {
             var vs = 'viewAccount';
            console.log('{!$User.Id}'+'=='+CCRZ.pagevars.portalUserId );
            window.location.href = '/{!$Label.OSMStoreName}/ccrz__MyAccount?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+vs+getCSRQueryString() ;
            //window.location.href = '/DefaultStore/ccrz__MyAccount?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+vs+getCSRQueryString() ;
            if(CCRZ.pagevars.portalUserId !='' && "{!$User.Id}" != CCRZ.pagevars.portalUserId){
                window.location.href='/apex/ccrz__MyAccount?cartId=' + CCRZ.pagevars.currentCartID + '&viewState='+vs+getCSRQueryString() ;
              }
           }
    }
    
    $(function() {   
        //setup default options, then use ui properties, if they exist...
       var uiprops = {};
       //only use the correct ui properties if they properly defined, else use component defaults.
       if(CCRZ.uiProperties && CCRZ.uiProperties.autoComplete && CCRZ.uiProperties.autoComplete.PRODUCT_SEARCH && CCRZ.uiProperties.autoComplete.PRODUCT_SEARCH.search_input){
        uiprops = CCRZ.uiProperties.autoComplete.PRODUCT_SEARCH.search_input;
       }
       var options = _.extend( {minLength:3}, {delay:300}, {resultLimit:10}, {position: {collision:'none flip'}}, uiprops);
      
       CCRZ.pubSub.on('view:Menu:refresh',function(){
        $('.search_input').autocomplete({
         source: function( request, response ) {
     
              
         },
         
         open: function(){
                setTimeout(function () {
                    $('.ui-autocomplete').css('z-index', 99999999999999);
                }, 0);
         },
         minLength: options.minLength,
         delay: options.delay,
         position: options.position
      
        });
       });
        
        /**
         * Models
         */
        CCRZ.models.productSearchModel = Backbone.Model.extend();
       /**
        * Views
        */
        //Search functionality
        CCRZ.views.Menu = CCRZ.CloudCrazeView.extend({
            templateDesktop : CCRZ.util.template(CCRZ.uiProperties.Menu.desktop.tmpl),
            templatePhone : CCRZ.util.template(CCRZ.uiProperties.Menu.phone.tmpl),
            className : "OSM_SW_Header_Ctrl",
            viewName : "Menu",
            events:{
             "click #doSearch" : "doSearch",
             "keyup #searchText" : "enterPress"
            },
            init : function(){

                 this.invokeContainerLoadingCtx($('body'),"invalidateCartItem",
                        function(response){
                            //alert(CCRZ.pagevars.currentCartID);
                        if(response && response.success){ 
                            CCRZ.pubSub.trigger('cartChange', CCRZ.pagevars.currentCartID);
                            // CCRZ.pubSub.trigger("action:CartDetailView:refresh",cartDetailView);
                            }
                         CCRZ.pubSub.trigger('cartChange', CCRZ.pagevars.currentCartID);   
                        console.log("init function on header2");
                        },{buffer:false,escape:false,nmsp:false} );
             this.render();
             console.log('current user Id' + '{!currentUserId}');
            },
            renderDesktop : function(){
             this.$el.html('');
             this.setElement($(CCRZ.uiProperties.Menu.desktop.selector));
             var modeljson = this.model.toJSON();
             var searchhtml = this.templateDesktop(modeljson);
             this.$el.html(searchhtml);


             if(CCRZ.disableAdaptive) {
              // initialize popover/tooltip
              $('#doSearch').popover();
             }
            },
            renderPhone : function(){
             this.$el.html('');
             this.setElement($(CCRZ.uiProperties.Menu.phone.selector));
             this.$el.html(this.templatePhone(this.model.toJSON()));
            },
            enterPress : function(e){
             var code = e.which; // recommended to use e.which, it's normalized across browsers
             if(code==13)e.preventDefault();
             if(CCRZ.disableAdaptive) {
              $('#cc_search_error').popover('hide');
             }
             if(code==13||code==186){
              this.doSearch(e);
             }
            },
            doSearch : function(event){
             
             if(this.validateSearchInput()){
              var searchText = $("#searchText").val();
        
                 /*var URL = this.model.get("defaults").page + '?viewState=DetailView&cartID='+ CCRZ.pagevars.currentCartID;
              URL += getCSRQueryString();
              alert("url is : "+URL);
              window.location.href = URL;*/
             var ccid = CCRZ.pagevars.currentCartID || '';
             var storeName = CCRZ.pagevars.storefrontName || '';
             window.location = "/{!$Label.OSMStoreName}/ccrz__Products?cartID="+ccid+getCSRQueryString()+"&operation=quickSearch&searchText="+encodeURIComponent(searchText);
             //window.location = "/DefaultStore/ccrz__Products?cartID="+ccid+getCSRQueryString()+"&operation=quickSearch&searchText="+encodeURIComponent(searchText);
             }
            },
            validateSearchInput : function(){
             var v = this;
             var srchInput = $('#searchText');
        
             var srchVal = false || (srchInput.val()?srchInput.val().trim():false);
        
             if(srchVal && srchVal.length > 1 ){
              $('.searchBoxWidgetError').toggle(false);
              return true;
             } else {
              if(CCRZ.disableAdaptive) {
               $('#cc_search_error').popover('show');
              } else {
               $('.searchBoxWidgetError').text(CCRZ.pagevars.pageLabels['ProductSearch_Tooltip']);
               $('.searchBoxWidgetError').toggle(true);
              }
              return false;
             }
            }
        });
        
         CCRZ.productSearchModel = new CCRZ.models.productSearchModel({
            defaults : {
                //page : "/DefaultStore/ccrz__ProductDetails",
                page : "/{!$Label.OSMStoreName}/ccrz__Products",
                //page : "/DefaultStore/ccrz__Products",
             currentCartId: CCRZ.pagevars.currentCartID
            }
        });

       CCRZ.Menu = new CCRZ.views.Menu({
        model : CCRZ.productSearchModel
       });
        
        //console.log('==============================Showing User Name=========='+CCRZ.currentUser.FirstName);
         CCRZ.uiProperties.headerView.desktop.tmpl = 'SW_HeaderDesktop';
        CCRZ.pubSub.on('view:headerView:refresh', function(theView) {
              //$('.page-title-text').text($('.page-title-label-map').text());
              //alert('After rendering the Header');
              var name = "Hello, {!$User.FirstName}";
            //console.log('CCRZ.currentUser.FirstName--->'+CCRZ.currentUser.FirstName);
            //console.log(CCRZ.pagevars.isGuest+'====User Name============'+name +'====>'+CCRZ.currentUser.FirstName);
         
    var firstName = '{!FirstName}';
            //alert(firstName); 
            
            var location = '{!storelocationflag}';
            
            
            
            
            countryflag = location;
            //alert(location);
            //alert('new countryflag+++ '+ countryflag);
            
            var finalName='<span class="CMI-Icons CMI-global-nav-icon-margins">U</span>&#160;'+firstName+'</span>';
              
              
            $("#goToUser").html(finalName);
             $(".hide_on_guest").css('display','block');
             if(CCRZ.pagevars.isGuest){
                console.log('inside if');
                $(".hide_on_guest").css('display','none');
             }
            
            if(CCRZ.pagevars.isGuest)
            {
                $("#logoutSecOnlyId").show();
                //$("#logoutSecOnlyId").addClass("loginoutsec");
                //$("#logoutSecOnlyId").addClass("cc_loginoutsec");
                
                $("#userMyAccountSecId").hide();
            }
            else
            {
                $("#logoutSecOnlyId").hide();
                $("#userMyAccountSecId").show();
                $("#logoutInDropDown").addClass("loginoutsec");
            }
        
      }); 
      CCRZ.pubSub.once('view:cartHeaderView:refresh', function(cartHeaderView) {
        var nonUSCustomer = "{!nonUSCustomer}";
        var isOnBehalfLogin = "{!isOnBehalfLogin}";
        var showMaintMessage="{!showMaintainMessage}";
        console.log('start here');
        console.log(window.location.pathname);
        console.log(nonUSCustomer);
        console.log(CCRZ.subsc.perms.isDistAdmin);
        console.log(CCRZ.subsc.perms.isSupportAdmin);
        console.log("{!isOnBehalfLogin}");
        console.log('end here');
        if(isOnBehalfLogin == "true")
        {
            if(window.location.pathname != "/apex/CMIStore/ccrz__CCPage" && nonUSCustomer == "true" && CCRZ.subsc.perms.isDistAdmin == false && CCRZ.subsc.perms.isSupportAdmin == false && CCRZ.subsc.perms.isSalesAdmin == false){
            console.log('nonCustomer %o',nonUSCustomer);
            //window.location = "/{!$Label.OSMStoreName}/ccrz__CCPage?pageKey=nonUSCustomer"+getCSRQueryString();
            window.location = CCRZ.pagevars.currentPageURL.split(".com",1)[0]+".com"+"/apex/{!$Label.OSMStoreName}/ccrz__CCPage?pageKey=nonUSCustomer"+getCSRQueryString();
            }
        }
        else
        {
            if(window.location.pathname != "/CMIStore/ccrz__CCPage" && nonUSCustomer == "true" && CCRZ.subsc.perms.isDistAdmin == false && CCRZ.subsc.perms.isSupportAdmin == false && CCRZ.subsc.perms.isSalesAdmin == false){
                console.log('nonCustomer %o',nonUSCustomer);
                window.location = "/{!$Label.OSMStoreName}/ccrz__CCPage?pageKey=nonUSCustomer"+getCSRQueryString();
            }
        }
        if(showMaintMessage=="true")
        {
            $("#MaintMessageDiv").css("display", "block");
        }
        _.extend(Object.getPrototypeOf(cartHeaderView), 
                 {
                    render : function(){
                        this.setElement($(CCRZ.uiProperties.cartHeaderView.desktop.selector));
                        var hdrModel = CCRZ.headerModel.get("header");
                        // hdrModel.cartTotal = '11228933';
                        var source = ''||CCRZ.pagevars.pageLabels["CartHeader_Loading"];
                        if(hdrModel.get("cartTotal")){
                            var json = hdrModel.toJSON();
                            OSM_SW_Header_Ctrl.getCurrProratedTotal(CCRZ.pagevars.remoteContext, function(response){
                                console.log('header response %o',response);
                                json.cartTotal = response.data.outputData[0].sumProratedPriceAfterDiscount;
                                CCRZ.headerModel.attributes.ECartItems = response.data.outputData[0].ECartItemsS;
                                CCRZ.headerModel.attributes.accountId = response.data.outputData[0].account;
                                source = (CCRZ.display.isPhone()) ? cartHeaderView.templateCartHeaderPhone(json) : cartHeaderView.templateCartHeaderDesktop(json);
                                // console.log('json %o',json);
                                sessionStorage['renderProrated'] = true;
                                $(cartHeaderView.el).html(source);
                                // CCRZ.pubSub.trigger("view:"+cartHeaderView.viewName+":refresh", cartHeaderView);
                            });
                            // json.cartTotal = "111111";

                        }

                    },
                    update : function(){
                        var view = this;
                        CCRZ.headerModel.getCartHeader(function(response){
                            if(!response) {
                                console.log('response %o',response);
                             view.render();
                             
                            }
                        });
                    }
                 });
      });
        
         CCRZ.uiProperties.headerView.desktop.tmpl = 'SW_HeaderDesktop';
          
        CCRZ.uiProperties.Menu.desktop.tmpl='SW_menu-desktop-template' ;
        
        CCRZ.uiProperties.cartHeaderView.desktop.tmpl = "SW_CartHeaderBrowser";
        
         CCRZ.uiProperties.myAccountHeaderView.desktop.tmpl="SW_Account-Desktop";
  });
</script>
<script type="text/javascript">
 sessionExpiration(idleMinutes = {!$Label.OSMidleMinutes}, warningMinutes = {!$Label.OSMWarningMinutes}, logoutUrl = 'https://access.cummins.com/RC_OnlineLogin/cola/logoutend.jsp');
</script>
</apex:page>