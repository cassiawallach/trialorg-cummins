<apex:page sidebar="false" controller="OSM_SW_CartPg_Ctrl" showHeader="false" standardStylesheets="false" applyHtmlTag="false" >

<script type="text/javascript">
                CCRZ.uiProperties.CartDetailView.desktop.tmpl='CMI-SW-ShoppingCartDetail-View-Desktop'; 
                CCRZ.uiProperties.CartDetailView.partials.cartItemsDesktop = '#CMI-SW-CartItemDetail-View-Desktop';
                CCRZ.uiProperties.CartDetailView.partials.headerSection = '#CMI-SW-CartDetail-Header-View';
                CCRZ.uiProperties.CartDetailView.partials.actionsTotals = '#CMI-SW-CartDetail-ActionTotals-View';
                // CCRZ.uiProperties.CartDetailView.partials.includedDisplay = '#OMS-Cart-IncludedItems';


</script> 
  
<!-- Handlebar Template for showing Actions to customer-->
<script id="CMI-SW-CartDetail-ActionTotals-View" type="text/template">



   <div class="row col-md-12">    
       <div class="row">
                          <hr>
                        <div class="col-md-4">
                      </div>
                      <div class="col-md-12" style="padding-right:36px"> 
                         <div class="col-md-7" style=" padding-left: 4px; margin-left: 67px; margin-top: 29px;">
                         <!--<i>If you are tax exempt, please go to <a href="#" onclick="return fetchMyAccount();" style="color:teal">My Account</a> to upload your tax exemption certificate. Tax exemption certificate approvals require 72 hours upon submission. Any purchases made prior to approval will be taxed and tax will not be refunded.</i>-->
                      </div>
                       
              
              
                
              
                    </div>
                   </div>
        <!-- adding for coupon Start --> 
            <!-- Demo - Juhi - Feb 12, 2019 - Setting display as None for Demo Purpose, until Discount Coupon Logic is taken up again -->
      
            <div >
            
         {{#ifStoreSetting 'Display_Cart_Coupon__c'}}
          <div class="panel panel-default cc_panel cc_shopping_cart_discount_panel">
           <div class="panel-heading cc_heading" >
            <!-- <h3 class="panel-title cc_title">{{pageLabelMap 'CartInc_discountCodes'}}</h3> -->
           </div>
           
           <div class="cc_myaccount_content panel-body cc_body">
              <!-- remove this below by Yubo from multi-coupon -->
            {{#if this.hasCoupon}}
<!--              <form id="couponClearForm" class="cc_coupon_clear_form">
              <div class="discount_code cc_discount_code">

               <p class="cc_applied_coupon">{{pageLabelMap 'CartInc_AppliedCoupon'}} {{this.couponName}}</p>
               <p class="cc_clear_coupon_code"><button id="clearCouponBtn" type="button" class="btn btn-default btn-sm cc_clear_coupon">{{pageLabelMap 'CartInc_ClearCoupon'}}</button></p>
              </div>
             </form> -->
            {{/if}}
<!--             {{else}} -->
             <form id="couponAddForm" class="cc_coupon_add_form">
                <div class="col-md-8">
               <p id="couponAddError" class="cc_coupon_add_error"></p>
              

            </div>
              
                <div class="discount_code cc_discount_code col-md-4">
                   
                  <div> 
                    <div><output id="coupon_code" style="color:red;padding-top:5px;display: inline-block;"></output></div>
                    <div><output id="coupon_code_INSITE" style="color:red;padding-top:5px;display: inline-block;"></output></div>
                    <div><output id="coupon_code_QSOL" style="color:red;padding-top:5px;display: inline-block;"></output></div>
                    <p  style="padding-left:15px;" class="cc_enter_coupon_code" >{{pageLabelMap 'CartInc_EntercouponCode'}} </p>
                  </div>
                  <div class="form-group">
                     <label  for="addCouponId" class="sr-only">{{pageLabelMap 'CartInc_AddCoupon'}}</label>
                     <div style="float:left;padding-right:0px;" class="col-sm-8">
               <input type="text" id="addCouponId" name="couponId" class="form-control cc_add_coupon_id"  style="width:100%;"/>
                 
             </div>
                     <div style="float:right;padding-left:3px;" class="col-sm-4">
                       <button id="addCouponBtn" type="button" class="btn btn-default btn-sm cc_add_coupon"    >{{pageLabelMap 'CartInc_ApplyCoupon'}}</button>
                     </div>
                      <br/>
                     <!--
                     <div class="couponMessagingSection-Error col-sm-12 " style="padding-top:15px;padding-left:15px;"></div>
                     
                     -->
               </div>
                </div>
                  
             </form>

           </div>
          </div>
         {{/ifStoreSetting}}
        </div>
      
        <!--do not move below div, it is requested by Janani and changed by Yubo -->
        <div class=" cc_action_totals pull-right col-md-5" ><!--style="margin-right: 23px;margin-top: 15px;"-->
            {{#if false }}
            {{ else }}
            {{#ifStoreSetting 'AutoCalcPriceAdjust__c'}}
            {{else}}
            {{/ifStoreSetting}}
            {{#ifDisplay 'WL.PkrOn'}}
            {{/ifDisplay}}
            {{/if}}
  
            
            {{#if false }}
            {{#ifDisplay 'C.EmailAnon'}}
              <a href="#emailModal" id="emailCartLink" class="cc_email_cart_link" data-toggle="modal"><button class="btn btn-default btn-sm remove cc_email_cart_link_button" type="button" >{{pageLabelMap 'CartOrderEmailer_Header'}}</button></a>
              &nbsp   
            
            
              
            {{/ifDisplay}}
            {{else}}
            {{#ifDisplay 'C.EnableEmailCart'}}
              <a href="#emailModal" id="emailCartLink" class="cc_email_cart_link" data-toggle="modal">
                  <!-- Juhi Changes - Sept 24 - to hide email cart link in cart page -->
                    <button type="button" class="btn-link btn-sm remove cc_email_cart_link_button" style="display:none; color: teal"><span class="CMI-text-icons" style="color: teal">m</span>{{pageLabelMap 'CartOrderEmailer_Header'}}</button></a>
            {{/ifDisplay}}
            {{/if}}
            {{#ifGreater sumProratedTotalDiscount 0}}
            <div style="text-align:right;">
              <span class="cc_label CMI-cart-subtotal-label" id="totalPriceLabel">{{pageLabelMap 'CartInc_OriginalPrice'}}</span>
              <span class="" id="totalPriceValue">{{price sumOriginalProratedSubtotal}}</span>
            </div>
              <div style="text-align:right;">
              <span class="cc_label CMI-cart-subtotal-label" id="totalDiscountLabel">{{pageLabelMap 'CartInc_TotalDiscount'}}</span>
              <span class="" id="totalDiscountValue"><font color="red">-{{price sumProratedTotalDiscount}}</font></span>
            </div>
            {{/ifGreater}}
            <div style="text-align:right;margin-bottom: 20px">
              <button class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" style="color: teal"><span class="CMI-text-icons"style="color: teal">R</span>{{pageLabelMap 'CartInc_Update'}}</button>
              <span class="cc_label CMI-cart-subtotal-label">{{pageLabelMap 'CartInc_Subtotal'}}:</span>
              <span class="cc_value CMI-cart-subtotal">{{{price sumProratedPriceAfterDiscount}}}</span>
            </div>
           
          <!--************-->
          {{#if false }}
           {{#ifDisplay 'rfq.GuestUser'}}
           {{/ifDisplay}}
          {{else}}
           {{#ifDisplay 'rfq.LoggedIn'}}
            
           {{/ifDisplay}}
          {{/if}}
          <!--************-->
         </div>
        <div class="col-md-12">
          <div class="row">
            <hr>
          <div class="col-md-4">
        </div>
        <div class="col-md-12" style="padding-right:36px"> 
           <div class="col-md-7" style=" padding-left: 4px; margin-left: 67px; margin-top: 29px;">
           <i>{!$Label.Upload_Tax_Exempt_Certificate}</i>
        </div>
         


  

      </div>
     </div>
            <div class="row pull-right" style="/*padding-right:46px*/">
      <div class="col-md-12" style="margin-top:-25px">
       <ul class="checkout list-unstyled cc_checkout">
        
        <li class="totalsmessagingSection cc_total_messaging_section"></li>
        {{#if this.cartItems}}
         {{#ifNotEquals this.cartItems.length 0}}
          {{#if this.allowCheckout}}
           {{#ifEquals this.preventCheckout false}}
            <li>
            <button class="btn btn-default btn-sm continueShoppingButton cc_continue_shopping_button" name="" type="button" >{{pageLabelMap 'CartInc_ContinueShopping'}}</button>
            
            &nbsp;            
             
                <button type="button" id="ChectOutBtn2" class="btn btn-default btn-sm  cc_checkout_btn">{{pageLabelMap 'CartInc_Checkout'}}</button>
            <!-- checkOutBtn -->
            </li>
            
           {{/ifEquals}}
          {{/if}}
         {{/ifNotEquals}}
        {{/if}}
       </ul>
      </div>
     </div>
    </div>
   </div>
  </script>

       <script id="CMI-SW-CartDetail-Header-View" type="text/template">
         <div class="row">
            <div class="col-md-12">
                    <div class="cart-messagingSection-Error" style="display: none;margin-bottom:15px;"><div class="cart-messagingSection-Error-text"></div></div>

                    <!-- <div class="messagingAction-Error alert alert-danger" role="alert" style="display: none"></div>

                    <div class="messagingSection-Warning" role="alert" style="display: none"></div>
                    <div class="messagingAction-Warning alert alert-warning" role="alert" style="display: none"></div>

                    <div class="messagingSection-Info" role="alert" style="display: none"></div>
                    <div class="messagingAction-Info alert alert-info" role="alert" style="display: none"></div> -->
            </div>
        </div>
          

          <div class="row">
           <div class="col-md-12">
            <p class="cart_sort" >
             <span class="cc_cart_sort_text">{{pageLabelMap 'Sort'}}</span>
             <a href="#" class="cart_sort_item cc_cart_sort_item" data-sort="name"><span class="label label-default cc_cart_sort_text">{{pageLabelMap 'Name'}}</span></a>
             <a href="#" class="cart_sort_item cc_cart_sort_item" data-sort="sku"><span class="label label-default cc_cart_sort_text">{{pageLabelMap 'SKU'}}</span></a>
             <a href="#" class="cart_sort_item cc_cart_sort_item" data-sort="dateAdded"><span class="label label-default cc_cart_sort_text">{{pageLabelMap 'Date_Added'}}</span></a>
            
            <div id="GOMSPriceMsg" style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;display:none">      
             <span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span> &nbsp; Prices shown here are for illustration purposes only. Please refer to the Global Order Management System (GOMS) and your local ERP to view accurate pricing and invoices.
            </div>
            </p>
           
           </div>
            
           
          </div>
            
        </div>  
        
        <div class="row CMI-Cart-table-header">
             <div class="col-md-5">
                 <div class="col-md-3" style="text-align:right; padding-left:50%">  
                          <B>Product</B>    
                 </div>
             </div>
             <div class="col-md-7">
                   <div class="col-md-2"></div>
                   
                     <div class="col-md-2" >
                          <B>{{pageLabelMap 'CartInc_Quantity'}}</B>
                     </div>
                     <div class="col-md-2" >
                       <B>{{pageLabelMap 'Subscription1'}}<br/>{{pageLabelMap 'End date'}}</B><!-- Mp_430 Code Added -->
                     </div> 
                              
                     <div class="col-md-2" style="padding-left:14.5px;">
                          <B>{{pageLabelMap 'CartInc_UnitPrice'}}</B>
                     </div>
                     <div class="col-md-2">
                          <B>{{pageLabelMap 'CartInc_BillingFrequency'}}</B>
                     </div>
                     <div class="col-md-2" style="padding-left:25.5px;">
                          <B>{{pageLabelMap 'CartInc_Subtotal'}}</B>
                     </div>
             </div>
        </div> 
    
       </script>
       
       <script id="CMI-SW-ShoppingCartDetail-View-Desktop" type="text/template">
          <div class="panel panel-default cc_panel cc_panel_shopping_cart">
           <div class="panel-body cc_body">
           <!-- Added for MAR-1196  -->           
            
            {{#ifHasPermission 'OSMSupportAdmin'}}
              {{else}}
            <div id="50sg" style="background-color: #FEEEED;padding: 10px;border: solid 2px red;display:none;">
                <span class="icon-Warning" style="color:red; font-size:18px; vertical-align: middle;"></span>&nbsp; Please contact customer support at 1-800-Cummins to purchase this quantity OR reduce quantity to less than <span id="qty2"></span> &nbsp;for {{this.prodname1}}<span id="productname1"></span> to proceed with the purchase.
            </div>
            
            <div id="25sg" style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;display:none">      
             <span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span> &nbsp;Please re-check the quantity attempted to purchase for {{this.prodname2}}<span id="productname2"></span>
            </div>
          {{/ifHasPermission}} 
             <!--MP-573 start-->
            <div class="quaPopup">  
            </div>
            <div class="couponMessagingSection-Error col-sm-12 " style="background-color: #FEEEED;padding: 10px;border: solid 2px red;display:none;"></div>
            <div class="couponInfoSection-Error col-sm-12 " style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;display:none;"></div>
            <!-- End: MAR-1196  -->
            <div class="row">
             <div class="col-xs-12">
              <h2 class="title cc_title">{{pageLabelMap 'CartInc_ShoppingCart'}}</h2>
             </div>
             
            </div>

            <div class="row">
            
             <div class="col-xs-12">
              <div id="cart_items_container" class="cc_cart_item_container">
               {{> headerSection}}
              
               </div>
               <div class="cart_item_list cc_cart_item_list">
                {{#if this.cartItems}}
                 {{#each this.cartItems.models}}
                  
                  <div class="cart_item wishFinder {{this.attributes.itemID}} cc_cart_item" data-sku="{{this.prodBean.sku}}">
                   {{> cartItemsDesktop}}
                  </div>
                  
                 {{/each}}
                {{/if}}
               </div>
              </div>
              {{> emailModal}}
              {{> rfqModal}}
              {{> wishModal}}
              {{> actionsTotals}}
             </div>
            </div>

           <div class="row">
                <div class="col-xs-12">
                    <div class="CMI-QuoteList-Div"> </div> 
                </div>
               </div>
            
           </div>
            <hr>
            <div class="row">
            <div class="col-xs-12">
            </div>
           </div>
           
           <div id="modalSec"></div>
           
           
          </div>
 
       </script>
     
  <script id="CMI-SW-CartItemDetail-View-Desktop" type="text/template">
        
    
   {{#with this.attributes}}
    {{#ifEquals itemStatus 'Invalid'}}
     <div class="row">
      <div class="col-md-12">
       <div class="cc_invalid">
        <p class="item_title cc_item_title">
         {{#if displayProductBean.sku}}
          {{#ifEquals pricingType 'external'}}
                   {{#if extName}}
                    <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{displayProductName 'Aggregate_Display' displayProductBean.name extName }}</a>
                   {{else}}
                    <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{displayProductName 'Aggregate_Display' displayProductBean.name mockProduct.name }}</a>
                   {{/if}}
          {{else}}
           <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{displayProductName 'Aggregate_Display' displayProductBean.name mockProduct.name }}</a>
          {{/ifEquals}}
          {{else}}
          {{#ifEquals pricingType 'external'}}
           {{#if extName}}
            <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{displayProductName 'Aggregate_Display' displayProductBean.name extName }}</a>
           {{else}}
            <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{displayProductName 'Aggregate_Display' displayProductBean.name mockProduct.name }}</a>
           {{/if}}
          {{else}}
           <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{displayProductName 'Aggregate_Display' displayProductBean.name mockProduct.name }}</a>
          {{/ifEquals}}
         {{/if}}
         
        </p>       
       
        
        {{#if showSubProdTerm}}
         <p class="subscriptionSummary cc_subscription_summary">
          {{insertTokens cartDisplayName displayName (price price) (price SubAmount) (price recurringPrice) (price recurringPriceSubAmount) (pageLabelPrefixMap 'Subscriptions_Frequency_' orderFrequencyUOM) (pageLabelPrefixMap 'Subscriptions_Frequency_' installmentFrequencyUOM) orderFrequency installmentFrequency installmentCount orderCount recurringPricePercentage upfrontPricePercentage}}
         </p>
        {{/if}}
        <!--
        {{#if showIAMMsg}}
            Your existing users will lose access since your purchase is less than your active count - Please re-provison the users at your location
        {{/if}}
        -->
        
        {{#if isRenew}}
            {{#ifEquals isRenew true}}
                <p>Renewed until {{date OSMRenewSubscriptionEndDate}}</p>
            {{/ifEquals}}
        {{/if}}
        
        
        <button type="button" class="btn btn-default btn-sm removeItemButton cc_remove_item_button" data-dismiss="modal" aria-hidden="true" data-id="{{itemID}}" >{{pageLabelMap 'Action_Delete'}}</button>
        
                        
                
       </div>
      </div>
     </div>
     <hr>
     
    {{else}}
    
    <!-- Code for Showing Cart Item starts if product is valid-->
  
     
     <div class="row">
      {{#ifEquals cartItemType 'Coupon'}}
       <div class="col-md-12">
        <p class="item_title coupon_title cc_coupon_title">
         <span class="cc_label">{{pageLabelMap 'CartInc_AppliedCoupon'}}</span>
         <span class="cc_value">{{mockProduct.name}}</span>
        </p>
       </div>
      {{else}}
      </div>
      <hr>
      
      {{#ifEquals mockProduct.groupName 'DA'}}
       <div class="col-md-5">
       <div class="col-md-4">
        <div>
        
         <div class="col-xs-12">
          <div class="cc_cart_product_image">
           <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{{displayImage mediaWrapper 'cart img-responsive'}}}</a>
          </div>
         </div>
        </div>
       </div>
       <div class="col-md-8">
        <p class="item_title cc_item_title">
         <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{displayProductBean.name}}  </a>
        </p>
        <p class="item_desc">
         {{displayProductBean.shortDesc}}
        </p>
        
        
        {{else}}
        
        <div class="col-md-2">
        <div class="row">
        
         <div class="col-xs-12">
          <div class="cc_cart_product_image">
           <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{{displayImage mediaWrapper 'cart img-responsive'}}}</a>
          </div>
         </div>
        </div>
       </div>
       <div class="col-md-3">
        
        {{#if ChildItem}}
        <p class="item_title cc_item_title">
         <span style="color:Gray;font-size:14px;"><B>{{mockProduct.name}}</B></span>
         
        </p>
        {{else}}
        <p class="item_title cc_item_title">
        <a href="#" class="prodLink cc_prod_link" data-id="{{OSMSWProductLinkR.SKU}}">{{mockProduct.name}}</a>
        
        </p>
        {{/if}}
        
        
        {{#if isRenew}}
                        {{#ifEquals isRenew true}}
                            <div style="color: black; font-style:italic;">Renewed until {{date OSMRenewSubscriptionEndDate}}</div>
                        {{/ifEquals}}
                    {{/if}}
                    
                    
         
        <p class="item_desc">
         {{mockProduct.shortDesc}} 
         {{#if this.minorLines}}
            {{#ifNotEquals this.pricingType "attrGroup"}}
            {{#ifNotEquals this.mockProduct.groupName 'FluidWatch'}}
            <p class="cc_included_items">
                <a href="#included_items{{this.itemID}}" id="includedItemsLink" data-toggle="modal" data-id="{{this.itemID}}"><span class="icon-ViewBound"></span> &nbsp;{{pageLabelMap 'CheckOut_IncludedItems'}}</a>
            </p>
            {{> includedDisplay}}
            {{/ifNotEquals}}
            {{/ifNotEquals}}
            {{/if}}

        </p>
        
        
        
         
         
         {{/ifEquals}}
         <!--
        {{#if showIAMMsg}}
            Your existing users will lose access since your purchase is less than your active count - Please re-provison the users at your location
        {{/if}}
        -->
        <div class="messagingSection-{{itemID}}-Error" style="display: none"></div>
        <div class="messagingSection-{{itemID}}-Info alert-dismissible" style="display: none"><button type="button" class="close cc_close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&#215;</span></button></div>
       {{/ifEquals}}
        
<!-- Icons Start -->
            <div class="CMI-Cart-Icons" style="color: teal">
  
        <!-- Juhi Changes - Sept 24 - to hide comments link in cart page -->
                <div class="CMI-Cart-Links CMI-Cart-Icons" style= "padding-right: 10px; display:none">
        <div><span class="CMI-text-icons CMI-Icon-teal" data-wishlistItemId={{itemID}} style="color: teal">:</span></div>
        <div style="padding-top: 3px">
                         {{#ifDisplay 'C.DsplComments'}}
                          <a href="#comments_{{itemID}}" id="commentsLink cc_comments_link" data-toggle="modal"><span style="color: teal">{{pageLabelMap 'CartLineCommentLabel'}}</span></a>
                          {{> cartItemComment}}
                         {{/ifDisplay}}
        </div>
                </div>
                  
                <div class= "CMI-Cart-Icons Cart-Move2Wish" >
        <div>
        <a href="#comments_{{itemID}}" data-wishlistItemId={{itemID}} class="cmi_wishlist_link CMI-Icon-teal" id="commentsLink">
        </a>
        </div>
                </div>
        
                <div class="CMI-Cart-Icons">                    
        
                        <div class="delete-links"><button type="button" id="removeItemButtonId" class="btn-link cc_remove_item_button cmi_delete_link " data-dismiss="modal" aria-hidden="true" data-id="{{itemID}}" ><span class ="icon-TrashcanBound" style=" font-size: 13px; color: teal">&nbsp;{{pageLabelMap 'Action_Delete'}}</span></button>   <!-- removeItemButton --> 
                        
                </div>
        </div>
                        
            </div>     
       
     
      {{#ifEquals nonCartUpdate true}}
       <!-- <div>
            <span>{{pageLabelMap 'QuantityNotToUpdateMessage' this.mockProduct.name}} </span>
        </div> -->
      
      {{/ifEquals}}
     </div>  
      </div>
        
      
      <div class="col-md-7">
         <div class="col-md-2"> </div>
             <div class="col-md-2">
               <div class="form-group">
                <!--- {{#ifEquals this.mockProduct.ProductType 'Bundle'}}              
              {{#ifEquals this.mockProduct.groupName 'FluidWatch'}}
                 <div class="input-group cc_input_group">
                  <input id="entry_{{itemID}}" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7"/>
                   <button style="padding-left: 0px;padding-top: 21px;padding-bottom:0px" class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" ><span class ="icon-UnknownDelay" style=" font-size: 13px; color: teal" data-id="{{itemID}}">&nbsp;{{pageLabelMap 'Update'}}</span></button>  
                 </div>
                {{/ifEquals}}
                {{/ifEquals}}--->
                 
               {{#ifEquals this.mockProduct.ProductType 'Bundle'}}
               
               {{#ifEquals this.mockProduct.groupName 'FluidWatch'}}
                 <div class="input-group cc_input_group">
                  <input id="entry_{{itemID}}" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7"/>
                   <button style="padding-left: 0px;padding-top: 21px;padding-bottom:0px" class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" ><span class ="icon-UnknownDelay" style=" font-size: 13px; color: teal" data-id="{{itemID}}">&nbsp;{{pageLabelMap 'Update'}}</span></button>  
                 </div>
               
          {{else}} 
                 <div class="input-group cc_input_group">
                 <input id="entry_{{itemID}}" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7" disabled='true'/>
               
                 </div>
            {{/ifEquals}}
              {{else}}
                
                  {{#ifEquals nonCartUpdate true}}
                      <div class="input-group cc_input_group">
                  
                      <input id="entry_{{itemID}}" style="width: 80%;" type="text" name="qty"  value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7" disabled='true'/>
                     </div>
                {{else}}  
                {{#ifEquals OSMSWisCPGProduct true}}
                      <div class="input-group cc_input_group">
                  
                      <input id="entry_{{itemID}}" style="width: 80%;" type="text" name="qty"  value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7" disabled='true'/>
                     </div>
                {{else}}                
                 {{#ifEquals OSMSWProductLinkR.SKU 'QSOLK-00045'}}
                  <div class="input-group cc_input_group">
                      <input id="subcQty" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7" disabled='true'/>
                      <!--<button style="padding-left: 0px;padding-top: 21px;padding-bottom:0px" class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" ><span class ="icon-UnknownDelay" style=" font-size: 13px; color: teal" data-id="{{itemID}}">&nbsp;{{pageLabelMap 'Update'}}</span></button>  -->
                 </div>
                 {{else}}     
                 {{#ifEquals OSMSWProductLinkR.SKU 'QSOL-FLT-0000007'}}
                  <div class="input-group cc_input_group">
                      <input id="subcQty" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7" disabled='true'/>
                      <!--<button style="padding-left: 0px;padding-top: 21px;padding-bottom:0px" class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" ><span class ="icon-UnknownDelay" style=" font-size: 13px; color: teal" data-id="{{itemID}}">&nbsp;{{pageLabelMap 'Update'}}</span></button>  -->
                 </div>
                 {{else}}               
                 {{#ifEquals OSMSWProductLinkR.SKU 'QSOLK-00045-1'}}
                  <div class="input-group cc_input_group">
                      <input id="subcQty" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7" disabled='true'/>
                     <!-- <button style="padding-left: 0px;padding-top: 21px;padding-bottom:0px" class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" ><span class ="icon-UnknownDelay" style=" font-size: 13px; color: teal" data-id="{{itemID}}">&nbsp;{{pageLabelMap 'Update'}}</span></button>  -->
                 </div>
                 {{else}}                  
                 {{#ifEquals OSMSWProductLinkR.SKU 'QSOLK-001'}}
                  <div class="input-group cc_input_group">
                      <input id="subcQty" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7" disabled='true'/>
                     <!-- <button style="padding-left: 0px;padding-top: 21px;padding-bottom:0px" class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" ><span class ="icon-UnknownDelay" style=" font-size: 13px; color: teal" data-id="{{itemID}}">&nbsp;{{pageLabelMap 'Update'}}</span></button>  -->
                 </div>
                 {{else}}                  
                 {{#ifEquals OSMSWProductLinkR.SKU 'QSOLK-001-1'}}
                  <div class="input-group cc_input_group">
                      <input id="subcQty" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7" disabled='true'/>
                      <!--<button style="padding-left: 0px;padding-top: 21px;padding-bottom:0px" class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" ><span class ="icon-UnknownDelay" style=" font-size: 13px; color: teal" data-id="{{itemID}}">&nbsp;{{pageLabelMap 'Update'}}</span></button>  -->
                 </div>
                 {{else}}                  
                  
                  <div class="input-group cc_input_group">
                      <input id="entry_{{itemID}}" style="width: 80%;" type="text" name="qty" value="{{quantity}}" class="input-text entry plus_minus form-control input-sm cc_entry" maxlength="7"  />
                      <button style="padding-left: 0px;padding-top: 21px;padding-bottom:0px" class="btn-link btn-sm updateCartButton cc_update_cart_button" name="" type="button" ><span class ="icon-UnknownDelay" style=" font-size: 13px; color: teal" data-id="{{itemID}}">&nbsp;{{pageLabelMap 'Update'}}</span></button>  
                 </div>
                 {{/ifEquals}}
                 {{/ifEquals}}
                 {{/ifEquals}}
                 {{/ifEquals}}
                 {{/ifEquals}}
                 {{/ifEquals}}
                 {{/ifEquals}}
                 {{/ifEquals}}
                </div>
            
             </div>
        <!-- MP-133 Code Start -->
             <!-- MP-372 Code Start -->
             <div class="col-md-2">
        		{{#ifNotEquals this.mockProduct.groupName 'FluidWatch' }}
                 {{#ifEquals displayName '99 Year'}}
                    
                 {{else}}
             <!-- MP-430 Code Start -->
                 {{#ifEquals this.isRenew false}}
                 {{#if this.subscriptionExpiryDate}}
                   {{#if this.withCoTerm}}
                        {{date this.subscriptionExpiryDate}}
                    {{else}}
                        {{reqdate this.requestDate this.displayName}} 
                   {{/if}}
                     {{else}}
                        {{reqdate this.requestDate this.displayName}} 
                       {{/if}}
                        {{else}}
                         {{date this.OSMRenewSubscriptionEndDate}} 
                        {{/ifEquals}}
        <!-- MP-430 Code End -->
                 {{/ifEquals}}
        		{{/ifNotEquals}}
             </div> 
           <!-- MP-372 Code End --> 
             <!-- MP-133 Code End -->    
                   
             <div class="col-md-2" style="{{#if @first}}padding-left:12px;{{else}}padding-right:40px{{/if}}">  
                        {{#if proratedPrice}}                      
                        <p class="price cc_price">                          
                          <span class="cc_value">{{{price proratedPrice}}}</span>
                        </p>
                        {{else}}
                        <p class="price cc_price">                          
                            <span class="cc_value">{{{price price}}}</span>
                        </p>
                        {{/if}}
             </div>
             {{#ifEquals mockProduct.groupName 'DA'}}
             <div class="col-md-2">
                          {{billingFrequency}}
             </div>
             {{else}}
             <div class="col-md-2">
                          
             </div>
             {{/ifEquals}}
              
                <div class="col-md-2" style="{{#if @first}}padding-left:12px;{{else}}padding-left:20px;{{/if}}">
                     <span class="price cc_price">{{price this.proratedSubamount}}</span>
                </div>
              
          <div class="col-md-6 cartItemCouponSection">
            <div id='Coupon_{{mockProduct.sfid}}'></div>
          </div>
      </div>
     
    </div>
     
  </div>
     
       

   
     <!-- <hr> -->
     {{#if lastChildItem}}
      
      <div class="row" style="text-align:right; padding-right:55px">
      
        <p><B>Subtotal for {{parentName}}&nbsp; ${{subtotalAmount}}</B></p>
      
      </div>
      <!-- <hr> -->
      {{/if}}
    {{/ifEquals}}
   {{/with}}
   


<div class="modal fade cc_modal cc_myaccount_orders_modal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="CancelMod">
    <div class="modal-dialog" role="document">
     <div class="modal-content cc_modal_content" style="border-radius:1px;border:1px black;">
      <div class="modal-body cc_modal_body">
        <p class="cc_cancel_prompt">An Add-on Package can only be purchased along with a Guidanz Base Package </p>
      </div>
      <div class="modal-footer">
       <input type="button" id="modalCartItem" class="btn btn-secondary"  value="Ok"/>
      </div>
     </div>
    </div>
   </div>
   
   <!-- Added for MAR-1196 -->
   <div class="modal fade cc_modal cc_myaccount_orders_modal" id="ShowWarningMsgID" tabindex="-1" role="dialog" aria-labelledby="CancelMod">
        <div class="modal-dialog" role="document">
            <div class="modal-content cc_modal_content" style="border-radius:1px;border:1px black;">
                <div class="modal-header" style="color: #fff;background-color: black;border-color: black;">
                    <h4 class="modal-title cc_modal_title" id="CartRfqLabel">Shopping Cart</h4>
                </div>
                <div class="modal-body cc_modal_body">
                    <b>{!$Label.OSM_Cart_Page_Warning_Msg}</b>
                </div>
                <div class="modal-footer">
                    <input type="button" class="closeModal btn btn-default cc_add_coupon ProcessPaymentBtn" id="hideModelOnCancel2" style="background-color: #0f4f77;" data-dismiss="modal" value="Ok" />
                    <!-- button type="button" class="btn CMI-DA-Packages " data-dismiss="modal" aria-label="Close" >Close</button -->
                </div>
            </div>
        </div>
    </div>
   <!-- Commented as MAR-1196
   <div class="modal fade cc_modal cc_myaccount_orders_modal" id="ShowWarningMsgID" tabindex="-1" role="dialog" aria-labelledby="CancelMod">
    <div class="modal-dialog" role="document">
     <div class="modal-content cc_modal_content">
      <div class="modal-body cc_modal_body">
         <b>{!$Label.OSM_Cart_Page_Warning_Msg}</b>
      </div>
      <div class="modal-footer">
      <button type="button" class="btn ProcessPaymentBtn"  aria-label="Ok" >{{pageLabelMap 'Ok'}}</button> 
      </div>
     </div>
    </div>
   </div> 
    -->            
                
                
        <div id="IAMWarning" class="modal fade cc_modal cc_cart_rfq_modal" role="dialog">
            <div class="modal-dialog" style="margin-left: 32%;" role="document">
                <div class="modal-content cc_modal_content" style="width: 60rem;border-radius:1px;border:1px black;">

                    <div class="modal-header CMI-DA-Packages cc_modal_header bgc">
                        <button type="button" class="close cc_close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&#215;</span>
                        </button>
                        <h4 class="modal-title cc_modal_title" id="CartRfqLabel"></h4>
                    </div>
                        Your existing users will lose access since your purchase is less than your active count - Please re-provison the users at your location.
                <!-- <div class="modal-body cc_modal_body">-->
                    <div class="messagingSection-FreeTrial-Error messagingSection-Error" style="display: none">
                        <div class="alert alert-danger" id="ErrorMsgDenger"></div>
                    </div>
                    
                    <div class="modal-footer">
                       
                        <button type="button" class="btn ProcessPaymentBtn" style="background-color: #0f4f77;" aria-label="Ok" >{{pageLabelMap 'Ok'}}</button>
                    </div>
                </div>
            </div>
        </div>

<!---<div id="ShowWarningMsgID" class="modal fade cc_modal cc_cart_rfq_modal" role="dialog">
          < <div class="modal-dialog" style="margin-left: 32%;" role="document">
                <div class="modal-content cc_modal_content" style="width: 60rem;">

                    <div class="modal-header CMI-DA-Packages cc_modal_header bgc">
                        <button type="button" class="close cc_close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&#215;</span>
                        </button>
                        <h4 class="modal-title cc_modal_title" id="CartRfqLabel"></h4>
                    </div> 
                        You can only pay for this transaction via credit card as there are both Fluidwatch and service tool products in the cart.
               
                    <div class="messagingSection-FreeTrial-Error messagingSection-Error" style="display: none">
                        <div class="alert alert-danger" id="ErrorMsgDenger"></div>
                    </div>
                    
                    <div class="modal-footer">
                       
                        <button type="button" class="btn ProcessPaymentBtn"  aria-label="Ok" >{{pageLabelMap 'Ok'}}</button>
                    </div>
                </div>
            </div> 
        </div> ---->
     
                        
                                                  
  </script> 

 
       <!--<c:OSM_SW_CartIncludeItems />-->
       <c:OSM_SW_Cart_Quote_Comp /> 
<script id="Cart-IncludedItems" type="text/template">
        <div id="included_items{{this.itemID}}" class="modal fade cc_modal cc_cart_included_items_modal" tabindex="-1" role="dialog" aria-hidden="true">
         <div class="modal-dialog" role="document">
          <div class="modal-content cc_modal_content" style="border-radius:1px;border:1px black;">
           <div class="modal-header" style="color: white;background-color: black;font-weight: bold;">
            <!--<button type="button" class="close cc_close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&#215;</span></button>-->
            {{#ifEquals this.pricingType 'external'}}
            
             {{#if extName}}
                {{this.extName}}&#58;&#160;{{pageLabelMap 'CheckOut_IncludedItems'}}
             {{else}}
                {{this.mockProduct.name}}&#58;&#160;{{pageLabelMap 'CheckOut_IncludedItems'}}
             {{/if}}
            {{else}}
                {{this.mockProduct.name}}&#58;&#160;{{pageLabelMap 'CheckOut_IncludedItems'}}
            {{/ifEquals}}
           </div>
           <div class="modal-body cc_modal-body">
            <div class="table-responsive">
             <table class="cart_figures table cc_table cc_included_items">
              <thead class="cc_table_header">
               <th class="cc_name">{{pageLabelMap 'Name'}}</th>
               <th class="cc_qty">{{pageLabelMap 'Qty'}}</th>
              
               {{#ifEquals this.mockProduct.ProductType 'Dynamic Kit'}}
                <th class="cc_total">{{pageLabelMap 'CartInc_Total'}}</th>
               {{/ifEquals}}
               {{#ifEquals this.mockProduct.ProductType 'Kit'}}
                <th class="cc_total">{{pageLabelMap 'CartInc_Total'}}</th>
               {{/ifEquals}}
              </thead>
              <tbody>
              {{#each this.minorLines}}
               <tr>
                <td class="cc_name">
                {{#ifEquals this.pricingType 'external'}}
                 <span class="cc_value cc_name">
                 {{#if extName}}
                  {{this.extName}}
                 {{else}}
                  {{this.mockProduct.name}}
                 {{/if}}
                 </span><br/>
                 <!-- MAR-630 Commented Code start
                 <span class="cc_value cc_sku">
                 {{#if extSKU}}
                  {{this.extSKU}} 
                 {{else}}
                  {{this.mockProduct.sku}}
                 {{/if}}
                 </span>//MAR-630 Commented Code start -->
                {{else}}
                 <span class="cc_value cc_name">{{this.mockProduct.name}}</span><br/>
                
               <!--  <span class="cc_value cc_sku">{{this.mockProduct.sku}}</span> -->
                 
                {{/ifEquals}}
                {{#ifContains this.pricingModifierTypes 'tiered'}}
                 {{#ifNotEquals this.parentProductType 'Bundle'}}
                  <div class="cc_prt_tool_tip_div cc_prt_tool_tip_div_ct" data-toggle="tooltip" title="{{pageLabelMap 'ProductPricingTiers_VolumeHover'}}">
                   <span class="cc_prt_tool_tip_text cc_prt_tool_tip_text_ct">{{pageLabelMap 'ProductPricingTiers_VolumePricingApplied'}}</span>
                  </div>
                 {{/ifNotEquals}}
                {{/ifContains}}
                </td>
                 
                {{#ifGreater this.quantity 998}}
                <td class="cc_qty">Unlimited  {{#contains this.mockProduct.name 'insite'}}licenses{{else}}users{{/contains}}</td>
                {{else}}
                  <td class="cc_qty">{{this.quantity}}  {{#contains this.mockProduct.name 'insite'}}licenses{{else}}users{{/contains}}</td>
        
                {{/ifGreater}}
                {{#ifEquals ../mockProduct.ProductType 'Dynamic Kit'}}
                 <td class="cc_total"><span class="price cc_totalPrice">{{price this.itemTotal}}</span></td>
                {{/ifEquals}}
                {{#ifEquals ../mockProduct.ProductType 'Kit'}}
                 <td class="cc_total"><span class="price cc_totalPrice">{{price this.itemTotal}}</span></td>
                {{/ifEquals}}
               </tr>
              {{/each}}
              </tbody>
             </table>
            </div>
           </div>
            <div class="modal-footer">
                <button type="button" class=" cc_close btn btn-default btn-sm cc_checkout_btn" style="background-color: #0f4f77;" data-dismiss="modal" aria-label="Close">Close</button>
              </div>
          </div>
         </div>
        </div>
    </script>       
<script type="text/javascript">
//MAR-353
function numberWithCommas(amount) {
        console.log('amount ',amount);
        return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
Handlebars.registerHelper("math", function(lvalue, operator, rvalue, options) {
    lvalue = parseFloat(lvalue);
    rvalue = parseFloat(rvalue);
        
    return {
        "+": lvalue + rvalue,
        "-": lvalue - rvalue,
        "*": lvalue * rvalue,
        "/": lvalue / rvalue,
        "%": lvalue % rvalue
    }[operator];
});
        
        var responseFromCtrl;
        var cartPageDetailView;
        var cartLineItemParent = new Array();
        var cartLineItemChilds=new Array();
        var renderProperty=false;
        var subtotal;
        var Total;
        var cartLineItemModel =  new Array();
        var cartModelChildNames=new Array();
        // var coupons = new Map();
        // coupons = ;
        
        
    jQuery(function($)
    {
                CCRZ.subsc = _.extend(CCRZ.subsc||{});
                CCRZ.subsc.cartRemoteActions = _.extend({
                className : 'OSM_SW_Cart_Wishlist_Comp_Ctrl',
                moveCartItemToWishlistAction : function(wishlistItemId,callback){
                    this.invokeCtx('handleMoveToWishlist',wishlistItemId,function(resp){
                            callback(resp);
                        },
                        {
                        buffer : false, // this call will be executed by itself
                        nmsp : false // defines that this is a call to a subscriber class
                        }); // end invokeCtx call
                }
                },CCRZ.RemoteInvocation);
                
                
                CCRZ.subsc.cartRemoteActions2 = _.extend({
                className : 'OSM_SW_CartPg_Ctrl',
                callOneBMS : function(hasCouponBoolean,callback){
                    var myobject=new Object();
                    myobject.hasCoupon=hasCouponBoolean;
                    var myString = JSON.stringify(myobject);
                    this.invokeContainerLoadingCtx($('body'),'callOneBMS',function(resp){
                            callback(resp);
                        },
                        {
                        buffer : false, // this call will be executed by itself
                        nmsp : false // defines that this is a call to a subscriber class
                        }); // end invokeCtx call
                }
                },CCRZ.RemoteInvocation);
                
                 CCRZ.subsc.cartRemoteActions3 = _.extend({
                className : 'OSM_SW_CartPg_Ctrl',
                cartItemDetails : function(callback){
                    this.invokeCtx('cartItemDetails',function(resp){
                            callback(resp);
                        },
                        {
                        buffer : false, // this call will be executed by itself
                        nmsp : false // defines that this is a call to a subscriber class
                        }); // end invokeCtx call
                }
                },CCRZ.RemoteInvocation);
                
                CCRZ.subsc.cartRemoteActions4 = _.extend({
                className : 'OSM_SW_CartPg_Ctrl',
                cartItemDetailsSubsc : function(callback){
                    this.invokeContainerLoadingCtx($('body'),'cartItemDetailsSubsc',function(resp){
                            callback(resp);
                        },
                        {
                        buffer : false, // this call will be executed by itself
                        nmsp : false // defines that this is a call to a subscriber class
                        }); // end invokeCtx call
                }
                },CCRZ.RemoteInvocation);
                
                CCRZ.subsc.cartRemoteActions5 = _.extend({
                className : 'OSM_SW_CartPg_Ctrl',
                ShowcartItemValidationsMsg : function(callback){
                    this.invokeContainerLoadingCtx($('body'),'ShowcartItemValidationsMsg',function(resp){
                            callback(resp);
                        },
                        {
                        buffer : false, // this call will be executed by itself
                        nmsp : false // defines that this is a call to a subscriber class
                        }); // end invokeCtx call
                }
                },CCRZ.RemoteInvocation);
                
                CCRZ.subsc.cartRemoteActions6 = _.extend({
                className : 'OSM_SW_CartPg_Ctrl',
                ShowWarningMsgPaymentOrder : function(callback){
                    this.invokeContainerLoadingCtx($('body'),'ShowWarningMsgPaymentOrder',function(resp){
                            callback(resp);
                        },
                        {
                        buffer : false, // this call will be executed by itself
                        nmsp : false // defines that this is a call to a subscriber class
                        }); // end invokeCtx call
                }
                },CCRZ.RemoteInvocation);


                 
              CCRZ.pubSub.on('view:CartDetailView:refresh', function(cartDetailView){
                
                var deleteButtonView=CCRZ.cartDetailView;
                CCRZ.cartDetailModel.attributes.coupons = JSON.parse('{!couponToProdMap}');
                console.log('coupons on cart %o',CCRZ.cartDetailModel.attributes.coupons);
                var cpMap = CCRZ.cartDetailModel.attributes.coupons;
                var couponsString = '';
                Object.keys(cpMap).forEach(function(key,index){
                  console.log(cpMap[key]);
                  couponsString += cpMap[key]+' ';             
                })
                sessionStorage['appliedCoupon'] = couponsString;
                setupAddOnProducts();

                var cartitems = cartDetailView.model.get('cartItems');
                if(cpMap){
                  cartitems.forEach(function(cartitem){
                    if("undefined" !== typeof(cpMap[cartitem.attributes.mockProduct.sfid]))
                    {
                      $('#Coupon_'+cartitem.attributes.mockProduct.sfid).empty();
                      $('#Coupon_'+cartitem.attributes.mockProduct.sfid).append("<span><b>"+cpMap[cartitem.attributes.mockProduct.sfid]+'</b> applied | <a href="#" class="removeCoupon" data-id="'+cpMap[cartitem.attributes.mockProduct.sfid]+'">'+CCRZ.pagevars.pageLabels.Cart_Coupon_removeCode+'</a></span><br/><span class style="float:right;padding-right: 40px;"><font color="red">-$'+cartitem.attributes.proratedCouponDiscount.toFixed(2)+'</font></span>'+'<hr>');
                    }
                  });
                }

                
                var v = cartDetailView;
                var viewPrototype = Object.getPrototypeOf(cartDetailView);
                if (viewPrototype != null) { 
                  viewPrototype.addCoupon = function(event){
                    var view = cartDetailView;
                    console.log('apply coupon extended');
                    OSM_SW_CartPg_Ctrl.preApplyCoupon(CCRZ.pagevars.remoteContext,function(response){
                        console.log('preapplycoupon %o',response);
                        v.model.attributes.proratedCIPricing = response.data.CIIdtoPriceMapping;
                        OSM_SW_CartPg_Ctrl.applyCouponValidation($('#addCouponId').val(),CCRZ.pagevars.remoteContext, function(response){
                            console.log('validation Result %o',response);
                            var couponCode = '';
                            if(response.success)
                            {
                              couponCode = $('#addCouponId').val();
                              OSM_SW_CartPg_Ctrl.OSMApplyCoupon(CCRZ.pagevars.remoteContext,v.model.attributes.proratedCIPricing,couponCode,v.params.skipPricing,function(response){

                                console.log('OSMApplyCoupon %o', response);

                                if(response.success && !response.data.couponExist){
                                   window.location.reload();
                                }else {
                                  $('.couponMessagingSection-Error').empty();
                                  //$('.couponMessagingSection-Error').append('<b style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;"><span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span><span>&nbsp;'+CCRZ.pagevars.pageLabels.Cart_Coupon_On_Cart+'</span></b>');
                                  $('.couponMessagingSection-Error').append('<span class="icon-Warning" style="color:red; font-size:18px; vertical-align: middle;padding: 2px;"></span>&nbsp;'+CCRZ.pagevars.pageLabels.Cart_Coupon_On_Cart);
                                  $('.couponMessagingSection-Error').css("display","block");
                                }
                              });
                            }
                            else
                            {
                                couponCode = 'INVALID';
                                $('.couponMessagingSection-Error').empty();
                                //$('.couponMessagingSection-Error').append('<b style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;"><span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span><span>&nbsp;'+CCRZ.pagevars.pageLabels.Cart_Coupon_Invalid+'</span></b>');
                                $('.couponMessagingSection-Error').append('<span class="icon-Warning" style="color:red; font-size:18px; vertical-align: middle;padding: 2px;"></span>&nbsp;'+CCRZ.pagevars.pageLabels.Cart_Coupon_Invalid);
                                $('.couponMessagingSection-Error').css("display","block");
                            }


                            
                            
                        });
                    });

                  };
                }
                $(".loadingContainer").hide();
                
                cartDetailView.moveCartItemToWishlistAction = function(event){
                
                    $(".loadingContainer").show();
                    
                    
                    var objLink = $(event.target);
                    var wishlistItemId = objLink.data("wishlistitemid");
                    var objLinkParent = $(event.currentTarget);
                    var parentElement = objLink.parents(".cart_item");
                    parentElement.fadeOut(2500);
                     
     
                    var v = this;
                        CCRZ.subsc.cartRemoteActions.moveCartItemToWishlistAction(wishlistItemId,function(resp)
                        {
                        
                            if(resp && resp.success)
                            {
                             CCRZ.pubSub.trigger("action:CartDetailView:refresh",cartDetailView);
                             CCRZ.pubSub.trigger("action:MyWishListView:refresh",CCRZ.WishListViewCMI);
                             CCRZ.pubSub.trigger("action:MyWishListView:refresh",CCRZ.QuoteListViewCMI);                             
                                
                            }
                        });
                        
                        
                        
                        
                    }   
                    
                    cartDetailView.processCheckOut = function(event){
                        if(CCRZ.cartDetailModel.attributes.showIAMMsg)
                        {
                            $("#IAMWarning").modal('show');
                        }
                        if(CCRZ.cartDetailModel.attributes.ShowWarningMsg)
                        {                         
                            $("#ShowWarningMsgID").modal('show');                           
                        }
                        else
                        {
                            cartDetailView.callOneBMS(event);
                        }
                    }
                    
                    //cartDetailView.processCheckOut = function(event){
                       // if(CCRZ.cartDetailModel.attributes.ShowWarningMsg)
                      //  {
                           // $("#ShowWarningMsgId").modal('show');
                       // }
                       // else
                      //  {
                        //    cartDetailView.callOneBMS(event);
                       // }
                   // }
                    
                    
                    cartDetailView.callOneBMS = function(event){
                
                        $("#IAMWarning").modal('hide');
                        $("#ShowWarningMsgId").modal('hide');
                        var thisValue = this;
                        var hasCouponBoolean=CCRZ.cartDetailView.model.attributes.hasCoupon;
                        console.log('hascoupon>>>>'+hasCouponBoolean);
                        
                        CCRZ.subsc.cartRemoteActions2.callOneBMS(hasCouponBoolean,function(resp)
                        {
                            console.log('OneBMS call %o',resp);
                            if(resp && resp.success)
                            {
                                console.log("OneBMS call done");
                                
                            }
                            thisValue.goToCheckout();
                        }); 
                         
                    }
                 
                 var parentElement;
                 var cartItemId;
                 cartDetailView.removeItemCustom = function(event){
                    console.log(event);
                    
                    var objLink = $(event.currentTarget);
                        parentElement = objLink.parents(".cart_item");
                        cartItemId = objLink.data("id");
                    
                    console.log(cartDetailView);
                    
                    
                    var isShowPopup = false;
                    
                    if(cartDetailView != undefined)
                    {
                        if(cartDetailView.model != undefined)
                        {
                            if(cartDetailView.model.attributes != undefined)
                            {
                                if(cartDetailView.model.attributes.cartItems != undefined)
                                {
                                    if(cartDetailView.model.attributes.cartItems.models != undefined)
                                    {
                                        for(var count = 0 ; count < cartDetailView.model.attributes.cartItems.models.length ; count++)
                                        {
                                            if(cartDetailView.model.attributes.cartItems.models[count].attributes.sfid == cartItemId)
                                            {
                                                if(cartDetailView.model.attributes.cartItems.models[count].attributes.productType == "Bundle")
                                                {
                                                  
                                                    if(cartDetailView.model.attributes.cartItems.models[count].attributes.subtotalAmount != undefined)
                                                    {
                                                        isShowPopup = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    
                    if(isShowPopup)
                    {
                        $('#exampleModal').modal('show');
                        
                    }
                    else
                    {
                        parentElement.fadeOut(2500);
                        var view = this;
                        console.log('reach outside');
                         view.model.removeCartItem(cartItemId, this.params.skipPricing, function(response){
                          // view.model.removeCartItem(cartItemId, this.params.skipPricing, function(response){
                          console.log('removeCartItem response %o',response)
                          CCRZ.headerView.update();
                          CCRZ.pubSub.trigger("action:CartDetailView:refresh",cartDetailView);
                          view.render();
                          window.location.reload();
                         });
                         
                    }
                    
                    
                    
                 }
                 
                 cartDetailView.modalCartItemRemove = function(event){
                    console.log(event);
                    $('#exampleModal').modal('hide');
                    console.log(this);
                    
                        var view = this;
                         parentElement.fadeOut(2500);
                         
                         view.model.removeCartItem(cartItemId, this.params.skipPricing, function(response){
                          console.log('removeCartItem 2 response %o',response)
                          CCRZ.pubSub.trigger("action:CartDetailView:refresh",cartDetailView);
                          view.render();
                          window.location.reload();
                         });
                 }
                 cartDetailView.reloadWindowOnCouponRemove = function(event){
                    console.log(event);
                    window.location.reload();
                 }
                cartDetailView.events['click .cmi_wishlist_link'] = 'moveCartItemToWishlistAction';
                cartDetailView.events['click #ChectOutBtn2'] = 'processCheckOut';
                cartDetailView.events['click .ProcessPaymentBtn'] = 'callOneBMS';
                cartDetailView.events['click #removeItemButtonId'] = 'removeItemCustom';
                cartDetailView.events['click #modalCartItem'] = 'modalCartItemRemove';
                cartDetailView.events['click .cc_clear_coupon'] = 'reloadWindowOnCouponRemove';
                cartDetailView.delegateEvents();
                
                // Coupon Code POC


                });

              
// Discount and total price
            CCRZ.pubSub.once('view:CartDetailView:refresh', function(view){
                var cartitems = view.model.get('cartItems');
                var totalOriginalPrice = 0;
                var totalDiscount = 0;
                getCouponCode();
                cartitems.forEach(function(cartitem){
                  console.log('cartitem.attributes.proratedSubamount '+cartitem.attributes.proratedSubamount);
                  totalOriginalPrice += cartitem.attributes.proratedSubamount;
                  if(cartitem.attributes.proratedCouponDiscount){
                    totalDiscount += cartitem.attributes.proratedCouponDiscount;
                  }
                  cartitem.attributes.totalOriginalTotal = cartitem.attributes.price * cartitem.attributes.quantity;
                });
               
                view.model.attributes.cartitems = cartitems;
                               
                // code added by sharad to get existing subscription for IAM
                CCRZ.cartDetailModel.attributes.showIAMMsg = false;
                
                CCRZ.subsc.cartRemoteActions4.cartItemDetailsSubsc(function(response)
                {
                    console.log('method to get msg');
                    console.log(response);
                    if(response.success)
                    {
                        if(response.data != undefined && response.data.showIAMProvisionMsg != undefined)
                        {
                            CCRZ.cartDetailModel.attributes.showIAMMsg = response.data.showIAMProvisionMsg;
                        }
                        if(response.data != undefined && response.data.GOMSUser != undefined)
                        {
                             CCRZ.cartDetailModel.attributes.GOMSUser = response.data.GOMSUser;
                             $('#GOMSPriceMsg').show();
                        }
                        else
                        {
                            CCRZ.cartDetailModel.attributes.GOMSUser=false;
                        }
                         
                    }
                
                });
                // sharad code end
                CCRZ.cartDetailModel.attributes.ShowcartItemValidationsMsg1 =false;
                CCRZ.cartDetailModel.attributes.ShowcartItemValidationsMsg2 =false;
                            
                 CCRZ.subsc.cartRemoteActions5.ShowcartItemValidationsMsg(function(response)
                {
                    console.log('method to get msg');
                    console.log(response);
                    if(response.success)
                    {
                        if(response.data != undefined && response.data.ShowcartItemValidationsMsg1 != undefined)
                        {
                             CCRZ.cartDetailModel.attributes.ShowcartItemValidationsMsg1 = response.data.ShowcartItemValidationsMsg1;
                             $('#50sg').show();
                            
                        }
                        if(response.data != undefined && response.data.ShowcartItemValidationsMsg2 != undefined)
                        {
                             CCRZ.cartDetailModel.attributes.ShowcartItemValidationsMsg2 = response.data.ShowcartItemValidationsMsg2;
                             $('#25sg').show();
                             
                        }
                         if(response.data != undefined && response.data.showMsg1 != undefined)
                        {
                             CCRZ.cartDetailModel.attributes.showMsg1 = response.data.showMsg1;
                            
                        }
                         if(response.data != undefined && response.data.prodname1 != undefined)
                        {
                             CCRZ.cartDetailModel.attributes.prodname1 = response.data.prodname1;
                             console.log('response.data.prodname1 %o',response.data);
                             $('#productname1').text(response.data.prodname1)
                             $('#50sg').show();
                            
                        }
                         if(response.data != undefined && response.data.prodname2 != undefined)
                        {
                             CCRZ.cartDetailModel.attributes.prodname2 = response.data.prodname2;
                              $('#productname2').text(response.data.prodname2)
                              $('#25sg').show();
                              
                              console.log('response.data.prodname2 %o',response.data);
                            
                        }
                         if(response.data != undefined && response.data.prodquantity  != undefined)
                        {
                              CCRZ.cartDetailModel.attributes.prodquantity  = response.data.prodquantity ;
                              console.log('response.data.prodquantity %o',response.data);
                            
                        }
                        if(response.data != undefined && response.data.qty2 != undefined)
                        {
                             CCRZ.cartDetailModel.attributes.qty2 = response.data.qty2;
                             console.log('response.data.qty2 %o',response.data);
                             $('#qty2').text(response.data.qty2)
                             $('#50sg').show();
                            
                        }
                        
                       else
                       {
                            CCRZ.cartDetailModel.attributes.ShowcartItemValidationsMsg1 =false;
                            CCRZ.cartDetailModel.attributes.ShowcartItemValidationsMsg2 =false;
                       }
                       
                    }
                    
                
                });
                
                
                 CCRZ.subsc.cartRemoteActions6.ShowWarningMsgPaymentOrder(function(response) 
                {
                    console.log('method to get msg');
                    console.log(response);
                   if(response != null){             // modified by swetha 
                    if(response.success)
                    {
                        if(response.data != undefined && response.data.ShowWarningMsg != undefined)
                        {
                             CCRZ.cartDetailModel.attributes.ShowWarningMsg = response.data.ShowWarningMsg;
                              $('#51sg').show();
                        }
                        else
                        {
                            CCRZ.cartDetailModel.attributes.ShowWarningMsg=false;
                       }
                       
                      }   
                    }
                
                });
                
                sessionStorage['totalOriginalPrice']= totalOriginalPrice.toFixed(2);
                sessionStorage['totalDiscount']= totalDiscount.toFixed(2);
                sessionStorage['totalProratedPrice'] = view.model.attributes.sumProratedPriceAfterDiscount.toFixed(2);
                if(totalOriginalPrice !== view.model.attributes.totalAmount)
                {
                  $('#totalPriceLabel').empty();
                  $('#totalPriceLabel').append('Original Price: ');
                  $('#totalPriceValue').empty();
                  $('#totalPriceValue').append(totalOriginalPrice.toFixed(2));

                  
                }
                if(totalDiscount !== 0)
                {
                  $('#totalDiscountLabel').empty();
                  $('#totalDiscountLabel').append('Discount: ');
                  $('#totalDiscountValue').empty();
                  $('#totalDiscountValue').append('<font color="red">-$'+totalDiscount.toFixed(2)+'</font>');
                  
                }
                var viewPrototype = Object.getPrototypeOf(view);

                viewPrototype.events = _.extend(viewPrototype.events, {  
                    'click .removeCoupon':'removeCoupon',
                    'click .updateCartButton' : 'saveCartNew',
                });
                  
                viewPrototype.goToCheckout = function(event){
                  var view = this;
                  if (view.params.hasChanged) {

                    if(CCRZ.pagevars.pageConfig.isTrue('c.noqty') && CCRZ.pagevars.pageConfig.isTrue('c.vernoqty')){
                    //we need to popup the conf dialog
                    //find any items in the model with quantity 0
                    var items = view.model.get('cartItems');
                    var zeroValues = items.filter(function(item){return ( item.get('quantity') === 0 || item.get('quantity') === '0'); });

                    //if we found an 0 quantites, then open the modal
                      if(zeroValues.length > 0){
                        //popup the modal
                        this.openRemoveModal( event, zeroValues, true);
                        //else just go ahead and save the changes to the model
                      }else{
                        var ciToQtyMap = new Map();
                        var cis = CCRZ.cartDetailModel.attributes.cartItems;
                        cis.forEach(function(ci){
                          ciToQtyMap[ci.attributes.itemID] = $('#entry_'+ci.attributes.itemID).val()
                        });
                        OSM_SW_CartPg_Ctrl.customUpdateCart(CCRZ.pagevars.remoteContext,ciToQtyMap,function(response){
                          //MP-573 start
                        console.log('call 1');
                         if(response.success && response.data.allCIUpdateAllow){
                              view.saveAndCheckout(event);
                          }
                          else if(!response.data.allCIUpdateAllow){
                             $('.quaPopup').empty();
                             if(response.data.subQuanMsgList!=undefined)
                             {
                                 for(i=0;i<response.data.subQuanMsgList.length;i++)
                                 {
                                     if(response.data.subQuanMsgList[i].showSubPopup)
                                      {
                                         $('.quaPopup').append('<div  style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;">'+'<span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span> &nbsp;' +'You currently have'+'&nbsp;' +response.data.subQuanMsgList[i].cartItemQuan+ '&nbsp;'+'number of subscriptions that you are trying to renew. Please enter a quantity less than or equal to'+ '&nbsp;'+response.data.subQuanMsgList[i].SubQuan+ '&nbsp;'+'in order to proceed .'+'&nbsp;'+'</div><br/>');
                                         $('.quaPopup').css("display","block");
                                       
                                      }
                                 }
                             }
                         
                        }
                        });
                        //MP-573 end
                      }
                    }else{
                        var ciToQtyMap = new Map();
                        var cis = CCRZ.cartDetailModel.attributes.cartItems;
                        cis.forEach(function(ci){
                          ciToQtyMap[ci.attributes.itemID] = $('#entry_'+ci.attributes.itemID).val()
                        });
                        OSM_SW_CartPg_Ctrl.customUpdateCart(CCRZ.pagevars.remoteContext,ciToQtyMap,function(response){
                          //MP-573 start
                             console.log('call 2');
                             if(response.success && response.data.allCIUpdateAllow){
                                  view.saveAndCheckout(event);
                              }
                              else if(!response.data.allCIUpdateAllow){
                                 $('.quaPopup').empty();
                                 if(response.data.subQuanMsgList!=undefined)
                                 {
                                     for(i=0;i<response.data.subQuanMsgList.length;i++)
                                     {
                                         if(response.data.subQuanMsgList[i].showSubPopup)
                                          {
                                            $('.quaPopup').append('<div  style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;">'+'<span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span> &nbsp;' +'You currently have'+'&nbsp;' +response.data.subQuanMsgList[i].cartItemQuan+ '&nbsp;'+'number of subscriptions that you are trying to renew. Please enter a quantity less than or equal to'+ '&nbsp;'+response.data.subQuanMsgList[i].SubQuan+ '&nbsp;'+'in order to proceed .'+'&nbsp;'+'</div><br/>');
                                            $('.quaPopup').css("display","block");
                                           
                                          }
                                     }
                                 }
                             
                            }
                         //MP-573 end
                        });
                    }
                  }
                  else {
                    if(view.model.attributes.allowCheckout && !view.model.attributes.preventCheckout) {
                    //MP-573 start
                    var ciToQtyMap = new Map();
                        var cis = CCRZ.cartDetailModel.attributes.cartItems;
                        cis.forEach(function(ci){
                          ciToQtyMap[ci.attributes.itemID] = $('#entry_'+ci.attributes.itemID).val()
                        });
                     OSM_SW_CartPg_Ctrl.customUpdateCart(CCRZ.pagevars.remoteContext,ciToQtyMap,function(response){
                          
                             console.log('call 3');
                             if(response.success && response.data.allCIUpdateAllow){
                                    view.model.saveAndProcess(true, view.params.skipPricing, function(response) {
                                    if (response.success) {
                                      view.determineCOFlow(event);
                                    }
                                    });
                              }
                              else if(!response.data.allCIUpdateAllow){
                                 $('.quaPopup').empty();
                                 if(response.data.subQuanMsgList!=undefined)
                                 {
                                     for(i=0;i<response.data.subQuanMsgList.length;i++)
                                     {
                                         if(response.data.subQuanMsgList[i].showSubPopup)
                                          {
                                            $('.quaPopup').append('<div  style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;">'+'<span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span> &nbsp;' +'You currently have'+'&nbsp;' +response.data.subQuanMsgList[i].cartItemQuan+ '&nbsp;'+'number of subscriptions that you are trying to renew. Please enter a quantity less than or equal to'+ '&nbsp;'+response.data.subQuanMsgList[i].SubQuan+ '&nbsp;'+'in order to proceed .'+'&nbsp;'+'</div><br/>');
                                            $('.quaPopup').css("display","block");
                                           
                                          }
                                     }
                                 }
                             
                            }
                         //MP-573 end
                        });
                    }
                  }
                
                };
                viewPrototype.saveAndCheckout= function(event){
                      var view = this;
                            view.model.saveAndProcess(true, view.params.skipPricing, function(response) {
                              console.log("saveAndProcess %o",response);
                              if (response.success) {
                              view.determineCOFlow(event);
                              }else {
                              //re-render view
                                CCRZ.pubSub.trigger('cartChange', response.data.sfid);
                                //reset that a change has been made
                                view.params.hasChanged = false;
                                view.render();
                              }

                            });
                };

                viewPrototype.updateQuantity = function(citoQtyMap,doReload){
                  console.log('updateQuantity %o',citoQtyMap);

                  OSM_SW_CartPg_Ctrl.customUpdateCart(CCRZ.pagevars.remoteContext,citoQtyMap,function(response){
                    console.log('response %o',response);
                    if(response.success && response.data.allCIUpdateAllow){
                      if(doReload){
                        window.location.reload();
                      }
                    }else if(!response.data.allCIUpdateAllow){
                      //MP-573 start 
                     console.log('subQuanMsgList'+response.data.subQuanMsgList);
                     $('.quaPopup').empty();
                     if(response.data.subQuanMsgList!=undefined)
                     {
                         for(i=0;i<response.data.subQuanMsgList.length;i++)
                         {
                             if(response.data.subQuanMsgList[i].showSubPopup)
                              {
                               $('.quaPopup').append('<div  style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;">'+'<span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span> &nbsp;' +'You currently have'+'&nbsp;' +response.data.subQuanMsgList[i].cartItemQuan+ '&nbsp;'+'number of subscriptions that you are trying to renew. Please enter a quantity less than or equal to'+ '&nbsp;'+response.data.subQuanMsgList[i].SubQuan+ '&nbsp;'+'in order to proceed .'+'&nbsp;'+'</div><br/>');
                               $('.quaPopup').css("display","block");
                               
                              }
                         }
                     }
                     
                      if(response.data.couponValidMsg)
                      {
                          $('.couponInfoSection-Error').empty();
                          //$('.cart-messagingSection-Error-text').empty();
                          //$('.cart-messagingSection-Error-text').append('<b style="background-color: palegoldenrod;padding: 10px;border: solid 2px #ffae42;"><span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span><span>'+CCRZ.pagevars.pageLabels.Cart_Coupon_Overflow_message+'</span></b>');
                          //$('.cart-messagingSection-Error-text').append('<span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span>&nbsp;'+CCRZ.pagevars.pageLabels.Cart_Coupon_Overflow_message);
                          $('.couponInfoSection-Error').append('<span class="icon-Info" style="color:#ffae42; font-size:13px; background-color:palegoldenrod"></span>&nbsp;'+CCRZ.pagevars.pageLabels.Cart_Coupon_Overflow_message);
                          $('.couponInfoSection-Error').css("display","block");
                      }
                      //MP-573 end
                      // CCRZ.pubSub.trigger("pageMessage", response.data.error);
                    }
                  });

                };


                viewPrototype.saveCartNew = function(event){
                  console.log('Test saveCartNew');
                  var objLink = $(event.target);
                  console.log('object %o',objLink);
                  var itemID = objLink.data("id");
                  console.log('object %o',itemID);
                     var qty = $('#entry_'+itemID).val();
                     console.log('qty'+qty);
                  var ciToQtyMap = new Map();
                  ciToQtyMap[itemID] = qty;
                  if(qty && itemID){
                   this.updateQuantity(ciToQtyMap,true);
                  } else{
                     var cis = CCRZ.cartDetailModel.attributes.cartItems;
                    cis.forEach(function(ci){
                       ciToQtyMap[ci.attributes.itemID] = $('#entry_'+ci.attributes.itemID).val()
                    });
                    this.updateQuantity(ciToQtyMap,true);
                  }
                };

                viewPrototype.removeCouponCall = function(couponId){
                    OSM_SW_CartPg_Ctrl.OSMDeleteCoupon(CCRZ.pagevars.remoteContext,couponId,function(response){
                      console.log(response);
                      window.location.reload();
                    });
                };
                viewPrototype.removeCoupon = function(event){
                    var objLink = $(event.target);
                    var couponId = objLink.data("id");
                    console.log('Coupon id:'+couponId);
                    view.removeCouponCall(couponId);
                };
                view.render();
                view.delegateEvents();

            });   






            function setupAddOnProducts()
             {
                var parentItemList=new Array();
                var childItemList=new Array();
                var listToSort=new Array();
                var view=CCRZ.cartDetailView;
                if(CCRZ.cartDetailModel.attributes.cartItems!=undefined)
                {
                listToSort=CCRZ.cartDetailModel.attributes.cartItems.models;
                listToSort.sort(compare);
                }
                console.log(listToSort.sort(compare));
               
                //seprating childs and parent items for Add on products
                if(CCRZ.cartDetailModel!=undefined && CCRZ.cartDetailModel.attributes!=undefined && CCRZ.cartDetailModel.attributes.cartItems!=undefined && CCRZ.cartDetailModel.attributes.cartItems.models!=undefined)
                {
                    for(i=0;i<CCRZ.cartDetailModel.attributes.cartItems.models.length;i++)
                    {
                        if(CCRZ.cartDetailModel.attributes.cartItems.models[i].attributes.OSMSWAddOnProductOf!=undefined)
                        {
                            childItemList.push(CCRZ.cartDetailModel.attributes.cartItems.models[i]);
                        }
                        else
                        {
                            parentItemList.push(CCRZ.cartDetailModel.attributes.cartItems.models[i]);
                        }
                        
                    }
                } 
                if(CCRZ.cartDetailModel.attributes.cartItems!=undefined)
                {
                listToSort=CCRZ.cartDetailModel.attributes.cartItems.models;
                listToSort.sort(compare);
                }
                console.log(listToSort.sort(compare));
                
                //counting subtotal amount 
                for(i=0;i<parentItemList.length;i++)
                {
                    var subtotalAmount=0;
                    var parentSubAmount=0;
                    for(j=0;j<childItemList.length;j++)
                    {
                        
                        if(parentItemList[i].attributes.sfid==childItemList[j].attributes.OSMSWAddOnProductOf)
                        {
                            var parentStartingIndex=i;
                            console.log('value of parentIndex>>>'+parentStartingIndex);
                            console.log('childItemList[j].attributes.itemTotal-->>>'+childItemList[j].attributes.proratedSubamount);
                            subtotalAmount=subtotalAmount+childItemList[j].attributes.proratedSubamount;
                            parentSubAmount=parentItemList[i].attributes.itemTotal;
                            console.log('subtotalAmount' + subtotalAmount);
                            console.log('parentSubAmount'+parentSubAmount);
                            parentItemList[i].attributes.subtotalAmount=subtotalAmount;
                            childItemList[j].attributes.ChildItem=true;
                            if(j+1 ==childItemList.length)
                            {
                                
                                CCRZ.cartDetailModel.attributes.cartItems.models[parentStartingIndex+j+1].attributes.lastChildItem=true;
                               
                                if(parentSubAmount!=undefined)
                                {
                                    var finalAmount=parentItemList[i].attributes.subtotalAmount+ parentSubAmount;
                                    CCRZ.cartDetailModel.attributes.cartItems.models[parentStartingIndex+j+1].attributes.subtotalAmount=numberWithCommas(finalAmount.toFixed(2));
                                    CCRZ.cartDetailModel.attributes.cartItems.models[parentStartingIndex+j+1].attributes.parentName=parentItemList[i].attributes.mockProduct.sfdcName;
                                    console.log('finalAmount>>>....'+finalAmount);
                                    console.log(parentStartingIndex+j+1);                  
                                }
                            }
                        }
                        
                    }
                    
                }
               
                
                
                if(!renderProperty)
                {
                     renderProperty=true;
                     view.render();
                } 
            }  
            function compare(a, b) {
              
              const sfdcNameA = a.attributes.sfdcName;
              const sfdcNameB = b.attributes.sfdcName;

              let comparison = 0;
              if (sfdcNameA > sfdcNameB) {
                comparison = 1;
              } else if (sfdcNameA < sfdcNameB) {
                comparison = -1;
              }
              return comparison;
            }
            function getCouponCode(){
            
            OSM_SW_CartPg_Ctrl.getCouponCode(CCRZ.pagevars.remoteContext,function(response){
                        //  console.log('testingCoupun',response);
                        if(response.success)
                        {
                         console.log('coupon code>>>>>'+response.data.CouponCode);
                         console.log('coupon code insite>>>>>'+response.data.CouponCodeINSITE);
                         console.log('coupon code qsol>>>>>'+response.data.CouponCodeQSOL);
                          if(response.data.CouponCode !=undefined)
                          {
                              $("#coupon_code").text(response.data.CouponCode);
                          }
                          if(response.data.CouponCodeINSITE !=undefined)
                          {
                              $("#coupon_code_INSITE").text(response.data.CouponCodeINSITE);
                          }
                          if(response.data.CouponCodeQSOL !=undefined)
                          {
                              $("#coupon_code_QSOL").text(response.data.CouponCodeQSOL);
                          }
                        }
                         
                    });
            }
            
                
    });
    
    
    Handlebars.registerHelper('date', function(milsec) {
                    if(milsec  != "" && milsec != undefined)
                    {
                        var params = Array.prototype.slice.call(arguments, 1);
                        var thisDate = new Date(milsec);
                        var dateToStr = thisDate.toUTCString().split(' ');
                        var datefinal = dateToStr[1] + ' ' + dateToStr[2]+' '+dateToStr[3];

                    return datefinal;
                    }
                    else 
                        return "";

                }); 
      //code start for Mp_531 by swetha
Handlebars.registerHelper('reqdate', function(milsec,duration) {
    if(milsec  != "" && milsec != undefined)
    {
                        var reqDate = new Date(milsec);
                        var year= reqDate.getFullYear();
                        var month = new Date(reqDate).getMonth();
                        var day   = new Date(reqDate).getDate();
                        var datefinal=reqDate;
                        const split_string = duration.split("");
                        var term = parseInt(split_string[0]);
                        if(duration.trim().includes("Year")){
                              datefinal  = new Date(year + term, month, day);
                        }else if(duration.trim().includes("Month")){ 
                            if(month+1 == 1){
                                if(reqDate.getDate() === 29){
                                   datefinal.setDate(reqDate.getDate()+ 28); 
                                }else{
                      datefinal.setDate(reqDate.getDate()+ 27);
                                }
                            }else{
                                datefinal = new Date(year, month+term, day);
                            }
                        }else if(duration.trim().includes("Quarter")){
                            datefinal  = new Date(year, month+(term*3), day);
                        }else if(duration.trim().includes("Week")){
                              datefinal.setDate(reqDate.getDate() + term * 7);   
                        } 
                        
        
        var datefinalmill = datefinal.getTime();
    var thisDate = new Date(datefinalmill);
        var dateToStr = thisDate.toUTCString().split(' ');
        var datefinalconvert = dateToStr[1] + ' ' + dateToStr[2]+' '+dateToStr[3];
        
    return datefinalconvert;
    }
    else
        return "";

}); //code ended for Mp_531
           
    
                
    
 </script>
  
    <style>
        .panel-heading {
    border-bottom: unset!important;
        }
        .cc_checkout {
    margin-top: 20px;
     padding-right: unset !important; 
}
        .cc_action_totals {
    padding-right: 0 !important; 
}
 .ProcessPaymentBtn{
            background-color: teal;
            color: white;
        }
    </style>
</apex:page>